<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
  <title>Centroid Engineering Solutions</title>
  <link rel="icon" type="image/jpeg" href="static/ces_logo.png">
  <link rel="stylesheet" href="../static/res_style.css">
  <link rel="stylesheet"
    href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
  <!-- <script src="https://kit.fontawesome.com/f8e1a90484.js" crossorigin="anonymous"></script> -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@6.5.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

</head>

<body>

  <input type="checkbox" id="menu-toggle">

  <div class="sidebar">

    <div class="side-header">
      <h3>C<span>entroid</span></h3>
    </div>

    <div class="side-content">

      <div class="profile">
        <div class="profile-img bg-img" style="background-image: url(../static/1.png)"></div>
        <h4>{{user['name']}}</h4>
        <small>{{department_code}}</small>
      </div>

      <div class="side-menu">
        <ul>

          {% if department_code == 1000 %}
          <li>
            <a href="/admin">
              <span class="fa-solid fa-user-tie"></span>
              <small>Admin</small>
            </a>
          </li>
          {% endif %}

          {% if user_access['Accounts'] == 'On' %}
          <li>
            <a href="/accounts">
              <span class="fa-solid fa-file-invoice-dollar"></span>
              <small>Accounts</small>
            </a>
          </li>
          {% endif %}
          {% if user_access['toggleEnquiry'] == 'On' %}
          <li>
            <a href="/admin_enquiry">
              <span class="fa-solid fa-handshake"></span>
              <small>Leads</small>
            </a>
          </li>
          {% endif %}
          {% if user_access['toggleHR'] == 'On' %}
          <li>
            <a href="/hr">
              <span class="fa-solid fa-user-plus"></span>
              <small>HR</small>
            </a>
          </li>
          {% endif %}
          {% if user_access['togglePlanner'] == 'On' %}
          <li>
            <a href="/planner">
              <span class="fa-solid fa-calendar-check"></span>
              <small>Planner</small>
            </a>
          </li>
          {% endif %}
          {% if user_access['toggleProfile'] == 'On' %}
          <li>
            <a href="/profile">
              <span class="fa-solid fa-user"></span>
              <small>Profile</small>
            </a>
          </li>
          {% endif %}
          {% if user_access['toggleProjects'] == 'On' %}
          <li>
            <a href="/projects" class="active">
              <span class="fa-solid fa-chart-simple"></span>
              <small>Project</small>
            </a>
          </li>
          {% endif %}
          {% if user_access['togglePurchase'] == 'On' %}
          <li>
            <a href="/purchase">
              <span class="fa-solid fa-cart-shopping"></span>
              <small>Purchase</small>
            </a>
          </li>
          {% endif %}

          {% if user_access['toggleResources'] == 'On' %}
          <li>
            <a href="/resources">
              <span class="fa-solid fa-recycle"></span>
              <small>Resources</small>
            </a>
          </li>
          {% endif %}

          {% if department_code == 1000 %}
          <li>
            <a href="/settings">
              <span class="fa-solid fa-gears"></span>
              <small>Settings</small>
            </a>
          </li>
          {% endif %}

          <li>
            <a href="{{ url_for('logout') }}">
              <span class="fa-solid fa-right-from-bracket"></span>
              <small>Log Out</small>
            </a>
          </li>
        </ul>
      </div>

    </div>

  </div>

  <div class="main-content">

    <div class="page-content" style="background-color: white;">

      <div id="pageLoader">
        <div class="loader"></div>
        <script>
          window.addEventListener("load", function () {
            document.getElementById("pageLoader").style.display = "none";
          });
        </script>

        <style>
          #pageLoader {
            position: fixed;
            width: 100vw;
            height: 100vh;
            background: white;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
          }

          .loader {
            border: 8px solid #f3f3f3;
            /* Light grey */
            border-top: 8px solid #3498db;
            /* Blue */
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
          }

          @keyframes spin {
            0% {
              transform: rotate(0deg);
            }

            100% {
              transform: rotate(360deg);
            }
          }
        </style>

      </div>


      <div class="page-header" style="background-color: white;">

        <nav class="navbar1">

          <ul id="menuList1" class="navitems1">

            {% if user_access['toggleDashboard'] == 'On' %}
            <li class="active">
              <a href="{{ url_for('projects') }}" class="link">
                <i class="fa-solid fa-chart-line" style="margin-right: 5px;"></i> Dashboard
              </a>
            </li>
            {% endif %}

            {% if user_access['toggleProjectStatus'] == 'On' %}
            <li>
              <a href="{{ url_for('prj_status') }}" class="link">
                <i class="fa-solid fa-clipboard-check" style="margin-right: 5px;"></i> Status
              </a>
            </li>
            {% endif %}

            {% if user_access['toggleHoursEdit'] == 'On' %}
            <li>
              <a href="{{ url_for('hours_edit') }}" class="link">
                <i class="fa-solid fa-clock-rotate-left" style="margin-right: 5px;"></i> Hours Edit
              </a>
            </li>
            {% endif %}

            {% if user_access['toggleMaterialReceipt'] == 'On' %}
            <li><a href="{{ url_for('Material_Receipt') }}" class="link"><i class="fa-solid fa-industry"></i>
                Material Receipt</a></li>
            {% endif %}

            {% if user_access['toggleHoursView'] == 'On' %}
            <li>
              <a href="{{ url_for('hrs_view') }}" class="link">
                <i class="fa-solid fa-clock" style="margin-right: 5px;"></i> Hours View
              </a>
            </li>
            {% endif %}

          </ul>

          <div class="menu-icon">
            <i class="fa-solid fa-bars" onclick="toggleMenu()"></i>
          </div>

          <script>
            let menuList1 = document.getElementById("menuList1");
            menuList1.style.maxHeight = "0px";

            function toggleMenu1() {
              if (menuList1.style.maxHeight == "0px") {
                menuList1.style.maxHeight = "300px";
              } else {
                menuList1.style.maxHeight = "0px";
              }
            }
          </script>

        </nav>

        <div class="line"></div>

      </div>

      <div class="search_container">
        <h3 style="color: #004274;">Project's (<span id="projectCount">0</span>)</h3>
        <input type="text" id="searchInput" placeholder="Search.....üîç" onkeyup="filterTable()">

        <span class="span_tag status-open">Open : <span id="OpenCount"> </span></span>
        <span class="span_tag status-design">Design : <span id="DesignCount"> </span></span>
        <span class="span_tag status-install">Install : <span id="InstallCount"></span></span>
        <span class="span_tag status-testing">Testing : <span id="TestingCount"></span></span>
      </div>

      {% if user_access['toggleDashboard'] == 'On' %}
      <div class="table-responsive" style="background-color: white;">

        <table class="table" width="100%" id="projectTable">

          <thead>
            <tr>
              <th style="text-align: center;"><i class="fa fa-bell"></th>
              {% if department_code == 1000 %}
              <th style="text-align: center;">$</th>
              {% endif %}

              <th style="text-align: center;">Edit</th>
              <th style="text-align: center;"><i class="fa fa-chart-line"></i></th>

              <th style="text-align: center;">Proj</th>
              <th style="text-align: center;">R</th>
              <th style="text-align: center;">M</th>
              <th style="text-align: center;">S</th>
              <th style="text-align: center;">O</th>
              <th style="text-align: left;">PO Number</th>
              <th style="text-align: left;">Client</th>
              <th style="text-align: left;">Name</th>
              <th style="text-align: center; cursor: pointer;" onclick="sortTableByDate(12)">
                Start <i class="fa fa-sort" id="startSortIcon"></i>
              </th>
              <th style="text-align: center; cursor: pointer;" onclick="sortTableByDate(13)">
                End <i class="fa fa-sort" id="endSortIcon"></i>
              </th>

              <th style="text-align: left;">PM</th>
              <th style="text-align: center;">Team</th>
              <th style="text-align: center;">Status</th>
              <th style="text-align: left;">Type</th>
              {% if department_code == 1000 %}
              <th style="text-align: center;">Del</th>
              {% endif %}
            </tr>
          </thead>

          <tbody style="background-color: white;">
            {% for pro in allpro %}

            <tr>

              <td style="text-align: center;">
                <a href="#" class="notification" onmouseover="showMessages({{ pro.id }})"
                  onmouseout="hideMessages({{ pro.id }})">
                  <i class="fa {{ 'fa-bell' if pro.alerts|length == 0 else 'fa-solid fa-bell fa-shake' }}"
                    style="color: {{ 'green' if pro.alerts|length == 0 else 'inherit' }};"></i>
                </a>
              </td>

              <!-- Notification Popup (Initially hidden) -->
              <div class="popup-overlay" id="messages-{{ pro.id }}" style="display: none;">
                <div class="popup-container">
                  <button class="close-btn" id="closePopupPO" onclick="closePopup({{ pro.id }})">X</button>
                  <h2 style=" justify-content: center; align-items: center;">Alerts</h2>

                  {% for alert in pro.alerts %}
                  <div class="alert-overdue-deliveries">
                    {{ alert }}
                  </div>
                  {% endfor %}
                </div>
              </div>

              <script>
                // Show the popup when hovering over the bell icon
                function showMessages(proId) {
                  const messageBox = document.getElementById(`messages-${proId}`);
                  messageBox.style.display = "flex";  // Show the popup
                }

                // Hide the popup when the mouse leaves the bell icon (and not when clicking the close button)
                function hideMessages(proId) {
                  const messageBox = document.getElementById(`messages-${proId}`);
                  if (!messageBox.contains(event.relatedTarget)) {  // Check if the mouse has left the bell icon
                    messageBox.style.display = "none";  // Hide the popup
                  }
                }

                // Function to close the popup explicitly (not triggered by mouse leaving)
                function closePopup(proId) {
                  const messageBox = document.getElementById(`messages-${proId}`);
                  messageBox.style.display = "none";  // Hide the popup
                }
              </script>


              {% if department_code == 1000 %}
              <td style="text-align: center;">

                <a href="{{ url_for('generate_graph', project_id=pro['id']) }}">
                  <span style="background-color:   {% if pro['margin'] >= 15  %}
                                                          rgb(154,246,42) /* Green */
                                                      {% elif pro['margin'] >= 0 and pro['margin'] <= 15 %}
                                                          rgb(255,255,102) /* Yellow */
                                                      {% else %}
                                                          rgb(255,69,0) /* Red */
                                                      {% endif %};
                                                      padding: 5px; 
                                                      border-radius: 5px; 
                                                      font-size: 14px; 
                                                      color: 
                                                      {% if pro['margin'] >= 0 %}
                                                          rgb(0, 0, 0) /* Black */
                                                      {% else %}
                                                          rgb(255, 255, 255) /* White */
                                                      {% endif %}; 
                                                      min-width: 35px; 
                                                      display: inline-block; 
                                                      text-align: center; 
                                                  ">
                    {{ pro['margin'] }}
                  </span>
                </a>

              </td>
              {% endif %}

              {% if user and pro and user_access and (
              (user['name'] == pro.get('pm') and user_access.get('toggleEditPM') == 'On')
              or user_access.get('toggleEditAllProjects') == 'On')
              %}
              <td style="text-align: center;">
                <a href="{{ url_for('admin_project_edit', proid=pro['id']) }}">
                  <span class="icon">
                    <span class="fa-solid fa-pen-to-square edit-icon"></span>
                  </span>
                </a>
              </td>
              {% else %}

              <td> </td>
              {% endif %}

              <td style="text-align: center;">
                <span class="icon" onclick="openprojectview('{{ pro['id'] }}')" style="cursor: pointer;">
                  <span class="fa fa-chart-line" style="font-size: 1.10em; color: rgb(22, 154, 206);"></span>
                </span>
              </td>


              <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ionicons@5.5.2/dist/css/ionicons.min.css" />

              <td style="text-align: center;">
                {% if user_access.get('toggleProjectDetails') == 'On' %}
                <a href="/project_pr?project_id={{ pro['id'] }}">{{ pro['id'] }}</a>
                {% else %}
                <a>{{ pro['id'] }}</a>
                {% endif %}
              </td>


              <td style="text-align: center;" style="position: relative">
                <span style="background-color: 
                                      {% if pro['resource'] >= 0 and pro['resource'] <= 80 %}
                                          rgb(154,246,42) /* Green */
                                      {% elif pro['resource'] >= 81 and pro['resource'] <= 90 %}
                                          rgb(255,255,102) /* Yellow */
                                      {% elif pro['resource'] >= 91 and pro['resource'] <= 100 %}
                                          rgb(139, 69, 19) /* Brown */
                                      {% else %}
                                          rgb(255,69,0) /* Red */
                                      {% endif %};
                                      padding: 5px; 
                                      border-radius: 5px; 
                                      font-size: 14px; 
                                      color: 
                                      {% if pro['resource'] >= 0 and pro['resource'] <= 80 %}
                                          rgb(0, 0, 0)
                                      {% elif pro['resource'] >= 81 and pro['resource'] <= 90 %}
                                          rgb(0, 0, 0)
                                      {% elif pro['resource'] >= 91 and pro['resource'] <= 100 %}
                                          rgb(255, 255, 255)
                                      {% else %}
                                          rgb(255, 255, 255)
                                      {% endif %}; 
                                      min-width: 35px; display: inline-block; text-align: center;"
                  class="resource-value" data-chart="true">
                  {{ pro['resource'] }}
                </span>
              </td>

              <td style="text-align: center;">
                <span style="background-color: 
                                    {% if pro['material'] >= 0 and pro['material'] <= 80 %}
                                        rgb(154,246,42) /* Green */
                                    {% elif pro['material'] >= 81 and pro['material'] <= 90 %}
                                        rgb(255,255,102) /* Yellow */
                                    {% elif pro['material'] >= 91 and pro['material'] <= 100 %}
                                        rgb(139, 69, 19) /* Brown */
                                    {% else %}
                                        rgb(255,69,0) /* Red */
                                    {% endif %};
                                    padding: 5px; /* Adjust the padding as needed */
                                    border-radius: 5px; /* Optional: Add rounded corners */
                                    font-size: 14px; /* Adjust the font size as needed */
                                    color: 
                                    {% if pro['material'] >= 0 and pro['material'] <= 80 %}
                                        rgb(0, 0, 0)
                                    {% elif pro['material'] >= 81 and pro['material'] <= 90 %}
                                        rgb(0, 0, 0)
                                    {% elif pro['material'] >= 91 and pro['material'] <= 100 %}
                                        rgb(255, 255, 255)
                                    {% else %}
                                        rgb(255, 255, 255)
                                    {% endif %}; 
                                    min-width: 35px; /* Adjust the minimum width as needed */
                                    display: inline-block; /* Ensure the minimum width is applied */
                                    text-align: center; /* Center the text within the span */
                                    ">
                  {{ pro['material'] }}
                </span>
              </td>

              <td style="text-align: center;">
                <span style="background-color: 
                                    {% if pro['sub_contract'] >= 0 and pro['sub_contract'] <= 80 %}
                                        rgb(154,246,42) /* Green */
                                    {% elif pro['sub_contract'] >= 81 and pro['sub_contract'] <= 90 %}
                                        rgb(255,255,102) /* Yellow */
                                    {% elif pro['sub_contract'] >= 91 and pro['sub_contract'] <= 100 %}
                                        rgb(139, 69, 19) /* Brown */
                                    {% else %}
                                        rgb(255,69,0) /* Red */
                                    {% endif %};
                                    padding: 5px; /* Adjust the padding as needed */
                                    border-radius: 5px; /* Optional: Add rounded corners */
                                    font-size: 14px; /* Adjust the font size as needed */
                                    color: 
                                    {% if pro['sub_contract'] >= 0 and pro['sub_contract'] <= 80 %}
                                        rgb(0, 0, 0)
                                    {% elif pro['sub_contract'] >= 81 and pro['sub_contract'] <= 90 %}
                                        rgb(0, 0, 0)
                                    {% elif pro['sub_contract'] >= 91 and pro['sub_contract'] <= 100 %}
                                        rgb(255, 255, 255)
                                    {% else %}
                                        rgb(255, 255, 255)
                                    {% endif %}; 
                                    min-width: 35px; /* Adjust the minimum width as needed */
                                    display: inline-block; /* Ensure the minimum width is applied */
                                    text-align: center; /* Center the text within the span */
                                    ">
                  {{ pro['sub_contract'] }}
                </span>
              </td>

              <td style="text-align: center;">
                <span style="background-color: 
                                    {% if pro['others'] >= 0 and pro['others'] <= 80 %}
                                        rgb(154,246,42) /* Green */
                                    {% elif pro['others'] >= 81 and pro['others'] <= 90 %}
                                        rgb(255,255,102) /* Yellow */
                                    {% elif pro['others'] >= 91 and pro['others'] <= 100 %}
                                        rgb(139, 69, 19) /* Brown */
                                    {% else %}
                                        rgb(255,69,0) /* Red */
                                    {% endif %};
                                    padding: 5px; /* Adjust the padding as needed */
                                    border-radius: 5px; /* Optional: Add rounded corners */
                                    font-size: 14px; /* Adjust the font size as needed */
                                    color: 
                                    {% if pro['others'] >= 0 and pro['others'] <= 80 %}
                                        rgb(0, 0, 0)
                                    {% elif pro['others'] >= 81 and pro['others'] <= 90 %}
                                        rgb(0, 0, 0)
                                    {% elif pro['others'] >= 91 and pro['others'] <= 100 %}
                                        rgb(255, 255, 255)
                                    {% else %}
                                        rgb(255, 255, 255)
                                    {% endif %}; 
                                    min-width: 35px; /* Adjust the minimum width as needed */
                                    display: inline-block; /* Ensure the minimum width is applied */
                                    text-align: center; /* Center the text within the span */
                                    ">
                  {{ pro['others'] }}
                </span>
              </td>

              <td style="text-align: left;" class="text-center supplierName">{{ pro['po_number'][:15] }}{% if
                pro['po_number']|length > 15 %}...{% endif %}</td>
              <td style="text-align: left;" class="text-left">{{ pro['client'][:20] }}</td>

              <td style="text-align: left;" class="text-center supplierName">{{ pro['project_name'][:25] }}{% if
                pro['project_name']|length > 25 %}...{% endif %}</td>
              <td style="text-align: center;" class="text-left start-time">{{ pro['start_time'] }} </td>
              <td style="text-align: center;" class="text-left end-time">{{ pro['end_time'] }}</td>
              <td style="text-align: left;" class="text-left">{{ pro['pm'] }}</td>

              <style>
                .members-container {
                  display: flex;
                  flex-direction: row;
                  align-items: center;
                }

                .member-circle {
                  width: 30px;
                  /* Adjust size as needed */
                  height: 30px;
                  /* Adjust size as needed */
                  border-radius: 50%;
                  background-color: #004b5d;
                  /* Background color for circles */
                  color: whitesmoke;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-weight: bold;
                  font-size: 14px;
                  /* Adjust font size as needed */
                  margin-top: -10px;
                  /* Adjust spacing between circles */
                }
              </style>

              <style>
                .dropdown-container {
                  position: relative;
                  display: inline-block;
                }

                .dropdown-menu {
                  position: absolute;
                  background-color: #89a6db;
                  min-width: 160px;
                  box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
                  z-index: 1;
                  border-radius: 5px;
                  font-weight: bold;
                }

                .dropdown-item {
                  padding: 10px 15px;
                  border-bottom: 1px solid #ddd;
                  cursor: pointer;
                  color: black;
                }

                .dropdown-item:last-child {
                  border-bottom: none;
                }

                .dropdown-item:hover {
                  background-color: white;
                  color: black;
                  font-weight: bold;
                }
              </style>

              <script>
                function toggleDropdown(iconElement) {
                  // Get all dropdown menus
                  const allDropdowns =
                    document.getElementsByClassName("dropdown-menu");

                  // Close all dropdowns except the clicked one
                  for (let i = 0; i < allDropdowns.length; i++) {
                    if (
                      allDropdowns[i] !== iconElement.nextElementSibling
                    ) {
                      allDropdowns[i].style.display = "none";
                    }
                  }

                  // Toggle the clicked dropdown
                  const dropdownMenu = iconElement.nextElementSibling;
                  const isDisplayed =
                    dropdownMenu.style.display === "block";
                  dropdownMenu.style.display = isDisplayed
                    ? "none"
                    : "block";
                }

                // Optional: Close the dropdown if clicked outside of it
                window.onclick = function (event) {
                  if (!event.target.matches(".fa-circle-chevron-down")) {
                    const dropdowns =
                      document.getElementsByClassName("dropdown-menu");
                    for (let i = 0; i < dropdowns.length; i++) {
                      dropdowns[i].style.display = "none";
                    }
                  }
                };
              </script>

              <td class="text-left" style="text-align: center;">
                <div class="dropdown-container">
                  <!-- Chevron Icon that toggles the dropdown -->
                  <i class="fa-sharp fa-solid fa-circle-chevron-down" style="color: #034443; cursor: pointer"
                    onclick="toggleDropdown(this)"></i>
                  <!-- Dropdown with team members -->
                  <div class="dropdown-menu" style="display: none">
                    {% if pro['project_members'] %} {% for member in
                    pro['project_members'].split(',') %}
                    <div class="dropdown-item">{{ member.strip() }}</div>
                    {% endfor %} {% else %}
                    <div class="dropdown-item">N/A</div>
                    {% endif %}
                  </div>
                </div>
              </td>

              <td class="text-left" style="font-weight: bold;  text-align: center;">
                <span style="color: 
                      {% if pro['status'] == 'Open' %}
                          blue;
                      {% elif pro['status'] == 'Design' %}
                          purple;
                      {% elif pro['status'] == 'Install' %}
                          darkorange; /* Updated color for Install */
                      {% elif pro['status'] == 'Testing' %}
                          goldenrod; /* Updated color for Testing */
                      {% elif pro['status'] == 'Closed' %}
                          green;
                      {% endif %};
                      background-color: 
                      {% if pro['status'] == 'Open' %}
                          #e0f7fa; /* Light blue background */
                      {% elif pro['status'] == 'Design' %}
                          #f3e5f5; /* Light purple background */
                      {% elif pro['status'] == 'Install' %}
                          #ffcc80; /* Updated light orange background for Install */
                      {% elif pro['status'] == 'Testing' %}
                          #fff59d; /* Updated light yellow background for Testing */
                      {% elif pro['status'] == 'Closed' %}
                          #c8e6c9; /* Light green background */
                      {% endif %};
                      padding: 2px 8px; 
                      border-radius: 8px; 
                      display: inline-block;
                  ">
                  {{ pro['status'] }}
                </span>
              </td>


              <td class="text-left" style="text-align: left;">{{ pro['type'] }}</td>

              {% if department_code == 1000 %}
              <td style="text-align: center;">
                <a href="{{ url_for('deletepro', proid=pro['id']) }}"
                  onclick="return confirm('Are you sure you want to delete this Project Permanently?');">
                  <span class="icon">
                    <span class="fa-solid fa-trash" style="color: red"></span>
                  </span>
                </a>
              </td>
              {% endif %}

            </tr>

            {% endfor %}
          </tbody>

        </table>

        <script>
          // Tracks sorting direction for each column
          let sortDirections = {
            12: 'asc',  // Start Date column (zero-based index 12)
            13: 'asc'   // End Date column (zero-based index 13)
          };

          // Parses DD/MM/YY into a Date object (supports cross-century)
          function parseDDMMYY(dateStr) {
            const parts = dateStr.split('/');
            if (parts.length !== 3) return new Date('Invalid');

            const day = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10) - 1;
            let year = parseInt(parts[2], 10);

            // Handle year logic: assume <50 ‚Üí 2000s, otherwise 1900s
            if (year < 50) {
              year += 2000;
            } else {
              year += 1900;
            }

            return new Date(year, month, day);
          }

          // Sorts the table by date for the given column index
          function sortTableByDate(colIndex) {
            const table = document.getElementById('projectTable');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            const direction = sortDirections[colIndex] === 'asc' ? 1 : -1;

            rows.sort((a, b) => {
              const aDate = parseDDMMYY(a.cells[colIndex].innerText.trim());
              const bDate = parseDDMMYY(b.cells[colIndex].innerText.trim());

              const aInvalid = isNaN(aDate.getTime());
              const bInvalid = isNaN(bDate.getTime());

              // Both invalid - keep relative order
              if (aInvalid && bInvalid) return 0;
              // Only a is invalid - a goes after b
              if (aInvalid) return 1;
              // Only b is invalid - b goes after a
              if (bInvalid) return -1;

              // Both valid - compare normally
              return (aDate - bDate) * direction;
            });

            // Append sorted rows back to the tbody
            rows.forEach(row => tbody.appendChild(row));

            // Toggle the sorting direction for next click
            sortDirections[colIndex] = sortDirections[colIndex] === 'asc' ? 'desc' : 'asc';

            // Update sort icons
            updateSortIcons(colIndex, sortDirections[colIndex]);
          }

          // Updates the sort icon next to the column header
          function updateSortIcons(activeIndex, direction) {
            // Reset both icons
            document.getElementById('startSortIcon').className = 'fa fa-sort';
            document.getElementById('endSortIcon').className = 'fa fa-sort';

            // Set active icon
            const iconId = activeIndex === 12 ? 'startSortIcon' : 'endSortIcon';
            document.getElementById(iconId).className = direction === 'asc' ? 'fa fa-sort-up' : 'fa fa-sort-down';
          }
        </script>




        <script>
          // Function to format a date string as 'day/month/year' with digits only
          function formatDate(dateString) {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) {
              // Return an empty string for invalid dates
              return "";
            }

            const day = date.getDate().toString().padStart(2, "0");
            const month = (date.getMonth() + 1)
              .toString()
              .padStart(2, "0"); // Adding 1 because months are zero-based
            const year = date.getFullYear().toString().slice(-2);

            return `${day}/${month}/${year}`;
          }

          // Call the formatDate function for each date element when the page loads
          document.addEventListener("DOMContentLoaded", function () {
            const start_time_elements =
              document.querySelectorAll(".start-time");
            const end_time_elements =
              document.querySelectorAll(".end-time");

            start_time_elements.forEach(function (element) {
              element.textContent = formatDate(element.textContent);
            });

            end_time_elements.forEach(function (element) {
              element.textContent = formatDate(element.textContent);
            });
          });
        </script>

        <style>
          .notification {
            background-color: white;
            color: red;
            text-decoration: none;
            position: relative;
            display: inline-block;
          }

          .notification:hover {
            background: white;
            color: black;
          }

          .notification i {
            font-size: 18px;
            /* Adjust the size of the bell icon */
          }

          .popup-overlay {
            position: absolute;
            top: 300px;
            /* Adjust the position of the pop-up relative to the icon */
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.2);
            /* Glassmorphism background */
            backdrop-filter: blur(10px);
            /* Add blur for glassmorphism effect */
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.2);
            /* Stronger shadow for pop-up effect */
            padding: 15px;
            width: 550px;
            /* Adjust the width for a more spacious pop-up */
            border-radius: 12px;
            /* Rounded corners for a smooth effect */
            z-index: 1000;
            display: none;

            /* Add a popping animation */
          }

          .popup-container h2 {
            justify-content: space-between;
            text-align: center;
            color: black;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            /* Add text shadow */
          }


          /* Animation for the pop-up effect */
          @keyframes pop-up {
            0% {
              transform: translateX(-50%) scale(0.8);
              /* Start with a small size */
              opacity: 0;
            }

            100% {
              transform: translateX(-50%) scale(1);
              /* End with the original size */
              opacity: 1;
            }
          }

          .alert-overdue-deliveries {
            background-color: #eeb8bc;
            color: #721c24;
            border-left: 5px solid #df4656;
            padding: 8px;
            margin-bottom: 8px;
            border-radius: 8px;
            /* Rounded corners for alert box */
          }

          .notification .fa-bell {
            cursor: pointer;
          }

          .close-btn {
            background: transparent;
            border: none;
            font-size: 18px;
            color: red;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 10px;
          }

          .close-btn:hover {
            color: #721c24;
            /* Change color on hover */
          }
        </style>


      </div>
      {% endif %}


      <div id="paymentModal" class="modal" style="display: none;">

        <div class="modal-content">

          <div class="modal-header">

            <div class="header-top">
              <h2> <span id="Project">XXXX - MF10W # PLC Migration</span></h2>
              <span class="close" onclick="closeModal()">&times;</span>
            </div>

            <div class="project-info-header">

              <div class="header-info-item">
                <div class="header-info-label">Client</div>
                <div class="header-info-value" id="prj_clainet"></div>
              </div>
              <div class="header-info-item">
                <div class="header-info-label">Project Manager</div>
                <div class="header-info-value" id="prj_pm"></div>
              </div>
              <div class="header-info-item">
                <div class="header-info-label">Team Size</div>
                <div class="header-info-value" id="prj_team"></div>
              </div>

              <div class="header-info-item">
                <div class="header-info-label">PO Value</div>
                <div class="header-info-value" id="prj_povalue"></div>
              </div>

              <div class="header-info-item">
                <div class="header-info-label">Start Date</div>
                <div class="header-info-value" id="prj_startdate"></div>
              </div>

              <div class="header-info-item">
                <div class="header-info-label">End Date</div>
                <div class="header-info-value" id="prj_enddate"></div>
              </div>

              <div class="header-info-item">
                <div class="header-info-label">Status</div>
                <div class="header-info-value">
                  <span class="status-badge status-active" id="prj_status"></span>
                </div>
              </div>

            </div>

          </div>

          <div class="summary-grid">

            <!-- Financial Overview Card -->
            <div class="info-card financial-info">
              <div class="card-header">
                <div class="card-icon">üí∞</div>
                <div class="card-title">Financial Overview</div>
              </div>
              <div class="info-row">
                <span class="info-label">Budget:</span>
                <span class="info-value positive">$ XX,XXX,XXX.XX</span>
              </div>

              <div class="info-row">
                <span class="info-label">Actual Spent:</span>
                <span class="info-value neutral">$ XX,XXX,XXX.XX</span>
              </div>
              <div class="info-row">
                <span class="info-label">Balance:</span>
                <span class="info-value  ">$ XX,XXX,XXX.XX</span>
              </div>


              <div class="progress-bar">
                <div class="progress-fill" style="width: 84%"></div>
              </div>
              <small style="color: #7f8c8d; margin-top: 5px; display: block;">84% Budget Utilized</small>
            </div>

            <!-- Manpower Card -->
            <div class="info-card manpower-info">
              <div class="card-header">
                <div class="card-icon">üë•</div>
                <div class="card-title">Manpower Allocation</div>
              </div>
              <div class="info-row">
                <span class="info-label">Budget Hours:</span>
                <span class="info-value positive">XX,XXX.XX hrs</span>
              </div>
              <div class="info-row">
                <span class="info-label">Actual Hours:</span>
                <span class="info-value ">XX,XXX.XX hrs</span>
              </div>
              <div class="info-row">
                <span class="info-label">Balance:</span>
                <span class="info-value ">XX,XXX.XX hrs</span>
              </div>

              <div class="progress-bar">
                <div class="progress-fill" style="width: 85%"></div>
              </div>
              <small style="color: #7f8c8d; margin-top: 5px; display: block;">85% Hours Utilized</small>
            </div>

            <!-- Timesheet  Card -->
            <div class="info-card financial-info">

              <div class="card-header">
                <div class="card-icon">‚åõ</div>
                <div class="card-title">Timesheet Log</div>
              </div>

              <!-- Timesheet Table -->
              <div class="timesheet-table scroll-minimal"
                style="margin-top: 15px; max-height: 180px; min-height: 80px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 6px;">
                <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                  <thead style="background-color: #f3f4f6; position: sticky; top: 0;">
                    <tr>
                      <th style="padding: 8px; text-align: left; border-bottom: 1px solid #ddd;">Employee</th>
                      <th style="padding: 8px; text-align: right; border-bottom: 1px solid #ddd;">Hours</th>
                    </tr>
                  </thead>
                  <tbody id="timesheetTableBody">
                    <!-- Sample rows (you can populate with JS) -->


                  </tbody>
                </table>
              </div>


            </div>

            <!-- Suppliers Card -->
            <div class="info-card manpower-info">
              <div class="card-header">
                <div class="card-icon">üíÅ‚Äç‚ôÇÔ∏è</div>
                <div class="card-title">Suppliers</div>
              </div>
              <div class="timesheet-table scroll-minimal"
                style="margin-top: 15px; max-height: 180px; min-height: 80px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 6px;">
                <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                  <thead style="background-color: #f3f4f6; position: sticky; top: 0;">
                    <tr>
                      <th style="padding: 8px; text-align: left; border-bottom: 1px solid #ddd;">Suppliers</th>
                      <th style="padding: 8px; text-align: right; border-bottom: 1px solid #ddd;">Count</th>
                    </tr>
                  </thead>
                  <tbody id="supplersbody">
                    <!-- Sample rows (you can populate with JS) -->

                  </tbody>
                </table>
              </div>
            </div>

            <!-- Material  Card -->
            <div class="info-card financial-info">
              <div class="card-header">
                <div class="card-icon">üöö</div>
                <div class="card-title">Material</div>
              </div>

              <div class="timesheet-table scroll-minimal"
                style="margin-top: 15px; max-height: 180px; min-height: 80px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 6px;">
                <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                  <thead style="background-color: #f3f4f6; position: sticky; top: 0;">
                    <tr>
                      <th style="padding: 8px; text-align: left; border-bottom: 1px solid #ddd;">Type</th>
                      <th style="padding: 8px; text-align: right; border-bottom: 1px solid #ddd;">Budget</th>
                      <th style="padding: 8px; text-align: right; border-bottom: 1px solid #ddd;">Actual</th>
                      <th style="padding: 8px; text-align: right; border-bottom: 1px solid #ddd;">Balance</th>
                    </tr>
                  </thead>
                  <tbody id="materialbody">
                    <!-- Sample rows (you can populate with JS) -->

                  </tbody>
                </table>
              </div>

            </div>

          </div>

          <div class="navigation-tabs">
            <ul class="tab-list">
              <li class="tab-item">
                <button class="tab-button active" onclick="showTab('Purchase')">
                  üÖøÔ∏è Purchase
                </button>
              </li>
              <li class="tab-item">
                <button class="tab-button" onclick="showTab('timesheet')">
                  ‚åö Hours Spent
                </button>
              </li>
              <li class="tab-item">
                <button class="tab-button" onclick="showTab('pr')">
                  üìã PR's
                  <span class="tab-badge" id="prBadge"></span>
                </button>
              </li>
              <li class="tab-item">
                <button class="tab-button" onclick="showTab('po')">
                  üìÑ PO's
                  <span class="tab-badge" id="poBadge"></span>
                </button>
              </li>
              <li class="tab-item">
                <button class="tab-button" onclick="showTab('payments')">
                  üí≥ Payment Requests
                  <span class="tab-badge" id="paymentsBadge"></span>
                </button>
              </li>
              <li class="tab-item">
                <button class="tab-button" onclick="showTab('do')">
                  üì¶ DO's
                  <span class="tab-badge" id="doBadge"></span>
                </button>
              </li>
              <li class="tab-item">
                <button class="tab-button" onclick="showTab('claims')">
                  ‚öñÔ∏è Claims
                  <span class="tab-badge" id="claimsBadge"></span>
                </button>
              </li>

            </ul>
          </div>

          <div class="tab-content">

            <!-- Purchase Tab -->
            <div id="Purchase" class="content-section">

              <div class="chart-container">
                <canvas id="purchaseBarChart"></canvas>
              </div>


            </div>

            <!-- timesheet Tab -->
            <div id="timesheet" class="content-section active">


              <div class="chart-container">
                <canvas id="manpowerBarChart"></canvas>

              </div>
            </div>

            <!-- PR's Tab -->
            <div id="pr" class="content-section">

              <div style="max-height: 325px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 10px;">
                <table class="table table-bordered" style="width: 100%; border-collapse: collapse; text-align: left;">
                  <thead style="background-color: #f3f4f6; position: sticky; top: 0; z-index: 1;">
                    <tr>
                      <th style="text-align: center;">S/N</th>

                      <th style="text-align: left;">PR NO</th>
                      <th style="text-align: center;">PR Date</th>
                      <th style="text-align: left;">Supplier</th>
                      <th style="text-align: left;">Requested By</th>
                      <th style="text-align: left;">Terms</th>
                      <th style="text-align: right;">Amount(S$)</th>
                      <th style="text-align: right;">GST(S$)</th>
                      <th style="text-align: right;">Total(S$)</th>
                      <th style="text-align: left;">Approved By</th>
                      <th style="text-align: center;">Status</th>
                    </tr>
                  </thead>
                  <tbody id="prTableBody">

                  </tbody>

                  <tfoot>
                    <tr>
                      <td colspan="5" style="text-align:left; font-weight:bold;"></td>
                      <td style="text-align:left; font-weight:bold;">Totals:</td>
                      <td id="pr_totalAmount" style="text-align: right;">45</td>
                      <td id="pr_totalGST" style="text-align: right;">45</td>
                      <td id="pr_overallTotal" style="text-align: right;">45</td>
                      <td></td>
                      <td></td>
                    </tr>
                  </tfoot>
                </table>
              </div>

            </div>

            <!-- PO's Tab -->
            <div id="po" class="content-section">
              <div style="max-height: 325px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 10px;">
                <table class="table table-bordered" style="width: 100%; border-collapse: collapse; text-align: left;">
                  <thead style="background-color: #f3f4f6; position: sticky; top: 0; z-index: 1;">
                    <tr>
                      <th style="text-align: center;">S/N</th>

                      <th>PO NO</th>
                      <th>PR Ref</th>
                      <th>Supplier</th>
                      <th style="text-align: center;">PO Date</th>
                      <th style="text-align: left;">Lead Time</th>
                      <th style="text-align: right">Amount (S$)</th>
                      <th style="text-align: right">GST (S$)</th>
                      <th style="text-align: right">Total (S$)</th>
                      <th style="text-align: left;">Requested By</th>
                      <th style="text-align: left;">Approved By</th>
                      <th style="text-align: left;">Issued By</th>
                      <th style="text-align: center;">PO Status</th>
                      <th style="text-align: center;">DO Status</th>
                      <th style="text-align: center;">Payment</th>
                    </tr>
                  </thead>
                  <tbody id="poTableBody">

                  </tbody>

                  <tfoot>
                    <tr>
                      <td colspan="5" style="text-align:left; font-weight:bold;"></td>
                      <td style="text-align:left; font-weight:bold;">Totals:</td>
                      <td id="po_totalAmount" style="text-align: right;">45</td>
                      <td id="po_totalGST" style="text-align: right;">45</td>
                      <td id="po_overallTotal" style="text-align: right;">45</td>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>

            <!-- DO's Tab -->
            <div id="do" class="content-section">
              <div style="max-height: 325px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 10px;">
                <table class="table table-bordered" style="width: 100%; border-collapse: collapse; text-align: left;">
                  <thead style="background-color: #f3f4f6; position: sticky; top: 0; z-index: 1;">
                    <tr>
                      <th style="text-align: center;">S/N</th>
                      <th style="text-align: center;">DO Date</th>
                      <th style="text-align: center;">DO NO</th>
                      <th style="text-align: left;">Created By</th>
                      <th style="text-align: left;">Client</th>
                      <th style="text-align: left;">Delivery</th>
                      <th style="text-align: left;">Attn</th>
                    </tr>
                  </thead>
                  <tbody id="doTableBody">

                  </tbody>
                </table>
              </div>
            </div>

            <!-- Claims Tab -->
            <div id="claims" class="content-section">
              <div style="max-height: 325px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 10px;">
                <table class="table table-bordered" style="width: 100%; border-collapse: collapse; text-align: left;">

                  <thead style="background-color: #f3f4f6; position: sticky; top: 0; z-index: 1;">
                    <tr>
                      <th style="text-align: center;">S/N</th>
                      <th style="text-align: center;">Claim ID</th>
                      <th style="text-align: left;">Claim By</th>
                      <th style="text-align: left;">Supplier</th>
                      <th style="text-align: left;">Category</th>
                      <th style="text-align: left;">Sub Category</th>
                      <th style="text-align: left;">Itemname</th>
                      <th style="text-align: right;">Amount(S$)</th>
                      <th style="text-align: right;">GST(S$)</th>
                      <th style="text-align: right;">Total(S$)</th>
                    </tr>
                  </thead>
                  <tbody id="claimTableBody">

                  </tbody>

                  <tfoot>
                    <tr>
                      <td colspan="6" style="text-align:left; font-weight:bold;"></td>
                      <td style="text-align:left; font-weight:bold;">Totals:</td>
                      <td id="claim_totalAmount" style="text-align: right;">45</td>
                      <td id="claim_totalGST" style="text-align: right;">45</td>
                      <td id="claim_overallTotal" style="text-align: right;">45</td>

                    </tr>
                  </tfoot>

                </table>
              </div>
            </div>

            <!-- Payment Requests Tab -->
            <div id="payments" class="content-section">
              <div style="max-height: 325px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 10px;">
                <table class="table table-bordered" style="width: 100%; border-collapse: collapse; text-align: left;">
                  <thead style="background-color: #f3f4f6; position: sticky; top: 0; z-index: 1;">
                    <tr>
                      <th style="text-align: center;">S/N</th>
                      <th style="text-align: center;">Request No</th>
                      <th style="text-align: left;">PO NO</th>
                      <th style="text-align: left;">Supplier</th>
                      <th style="text-align: center;">Req On</th>
                      <th style="text-align: left;">RequestBy</th>
                      <th style="text-align: center;">Inv Date</th>
                      <th style="text-align: right;">Amount</th>
                      <th style="text-align: right;">GST</th>
                      <th style="text-align: right;">Total</th>
                      <th style="text-align: center;">DueDate</th>
                      <th style="text-align: left;">Paid On</th>
                      <th style="text-align: right;">Balance</th>
                      <th style="text-align: center;">Status</th>
                    </tr>
                  </thead>
                  <tbody id="payTableBody">

                  </tbody>

                  <tfoot>
                    <tr>
                      <td colspan="6" style="text-align:right; font-weight:bold;"></td>
                      <td style="text-align:left; font-weight:bold;">Totals:</td>
                      <td id="pay_totalAmount" style="text-align: right;">45</td>
                      <td id="pay_totalGST" style="text-align: right;">45</td>
                      <td id="pay_overallTotal" style="text-align: right;">45</td>
                      <td></td>
                      <td></td>
                      <td id="pay_balance" style="text-align: right;"></td>
                      <td></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>

          </div>

        </div>

      </div>

      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


      <script>
        function showTab(tabName) {
          // Hide all content sections
          const sections = document.querySelectorAll('.content-section');
          sections.forEach(section => {
            section.classList.remove('active');
          });

          // Remove active class from all buttons
          const buttons = document.querySelectorAll('.tab-button');
          buttons.forEach(button => {
            button.classList.remove('active');
          });

          // Show selected content section
          document.getElementById(tabName).classList.add('active');

          // Add active class to clicked button
          event.target.classList.add('active');
        }

        function closeModal() {
          document.getElementById('paymentModal').style.display = 'none';
        }

        function generateReport() {
          alert('Generating comprehensive project report...');
        }

        function editProject() {
          alert('Opening project edit form...');
        }

        function viewDocuments() {
          alert('Opening document management system...');
        }



        // Animate progress bars on load
        window.onload = function () {
          const progressBars = document.querySelectorAll('.progress-fill');
          progressBars.forEach(bar => {
            const width = bar.style.width;
            bar.style.width = '0%';
            setTimeout(() => {
              bar.style.width = width;
            }, 500);
          });
        }
      </script>

      <script>

        function populateTimesheetTable(employeeCosts) {
          const tbody = document.getElementById('timesheetTableBody');
          tbody.innerHTML = ''; // Clear existing rows

          employeeCosts.forEach(emp => {
            const tr = document.createElement('tr');

            const tdName = document.createElement('td');
            tdName.style.padding = '8px';
            tdName.style.textAlign = 'left';
            tdName.textContent = emp.employeeID || 'Unknown';

            const tdHours = document.createElement('td');
            tdHours.style.padding = '8px';
            tdHours.style.textAlign = 'right';
            // Format hours with 2 decimals
            tdHours.textContent = emp.employee_total_cost ? emp.employee_total_cost.toFixed(2) : '0.00';

            tr.appendChild(tdName);
            tr.appendChild(tdHours);
            tbody.appendChild(tr);
          });
        }

        function populateSuppliersTable(suppliers) {
          const tbody = document.getElementById('supplersbody');
          tbody.innerHTML = ''; // Clear existing rows

          suppliers.forEach(supp => {
            const tr = document.createElement('tr');

            const tdName = document.createElement('td');
            tdName.style.padding = '8px';
            tdName.style.textAlign = 'left';
            tdName.textContent = supp.Supplier_Name || 'Unknown';

            const tdCount = document.createElement('td');
            tdCount.style.padding = '8px';
            tdCount.style.textAlign = 'right';
            tdCount.textContent = supp.po_count || '0';

            tr.appendChild(tdName);
            tr.appendChild(tdCount);
            tbody.appendChild(tr);
          });
        }

        let purchaseBarChartInstance = null;
        let manpowerBarChartInstance = null;

        function plotDoubleBarChart(canvasId, data, labelActual, labelBudget, xAxisTitle) {
          if (!Array.isArray(data)) {
            console.error(`plotDoubleBarChart error: data is not an array for canvasId=${canvasId}`, data);
            return; // prevent further errors
          }

          const ctx = document.getElementById(canvasId).getContext('2d');

          // Destroy existing chart instances
          if (canvasId === 'purchaseBarChart' && purchaseBarChartInstance !== null) {
            purchaseBarChartInstance.destroy();
            purchaseBarChartInstance = null;
          }
          if (canvasId === 'manpowerBarChart' && manpowerBarChartInstance !== null) {
            manpowerBarChartInstance.destroy();
            manpowerBarChartInstance = null;
          }

          const labels = data.map(item => (item.department_code || item.code || "").toString());
          const actualData = data.map(item => item.actual ?? item.actuals ?? 0);
          const budgetData = data.map(item => item.budget ?? 0);

          const chartConfig = {
            type: 'bar',
            data: {
              labels: labels,
              datasets: [
                {
                  label: labelActual,
                  data: actualData,
                  backgroundColor: 'rgba(54, 162, 235, 0.7)',
                  borderColor: 'rgba(54, 162, 235, 1)',
                  borderWidth: 1,
                  borderRadius: 5,
                  barThickness: 20,
                },
                {
                  label: labelBudget,
                  data: budgetData,
                  backgroundColor: 'rgba(255, 99, 132, 0.7)',
                  borderColor: 'rgba(255, 99, 132, 1)',
                  borderWidth: 1,
                  borderRadius: 5,
                  barThickness: 20,
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              interaction: {
                mode: 'index',
                intersect: false,
              },
              plugins: {
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      return `${context.dataset.label}: $${context.raw.toLocaleString(undefined, { minimumFractionDigits: 2 })}`;
                    }
                  }
                }
              },
              scales: {
                x: {
                  title: { display: true, text: xAxisTitle },
                  ticks: { font: { size: 10 } },
                  grid: { display: false }
                },
                y: {
                  beginAtZero: true,
                  title: { display: true, text: 'Amount ($)' },
                  ticks: {
                    callback: value => '$' + value.toLocaleString()
                  },
                  grid: {
                    borderDash: [3, 3]
                  }
                }
              }
            }
          };

          // Assign the chart instance
          if (canvasId === 'purchaseBarChart') {
            purchaseBarChartInstance = new Chart(ctx, chartConfig);
          } else if (canvasId === 'manpowerBarChart') {
            manpowerBarChartInstance = new Chart(ctx, chartConfig);
          }
        }

        function openprojectview(projectId) {
          fetch(`/get_proj_overview?projectId=${projectId}`)
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                const prj = data.project_details;
                const prData = data.pr_data;
                const poData = data.po_data;
                const doData = data.do_data;
                const claim_items = data.claimed_items;
                const paymentData = data.payment_data;
                const financial = data.project_financials.find(item => item.label === "Project Budget");
                const manpower = data.project_financials.find(item => item.label === "Manpower Budget");
                console.log(".......manpower..........", manpower);
                const purchaseData = data.final_combined_list || [];
                const manpowerData = data.manpower_summary || [];

                plotDoubleBarChart('purchaseBarChart', purchaseData, 'Actual', 'Budget', 'Department Code');
                plotDoubleBarChart('manpowerBarChart', manpowerData, 'Actual', 'Budget', 'Cost Center Code');

                populateTimesheetTable(data.employee_costs);
                populateSuppliersTable(data.supplier_counts);


                // Helper function to format numbers as currency or hours
                function formatCurrency(value) {
                  return `$${value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                }
                function formatHours(value) {
                  const num = Number(value);
                  return isNaN(num) ? '0.00' : num.toLocaleString(undefined, { minimumFractionDigits: 2 });
                }


                // Calculate utilization percentage (handle zero budgets gracefully)
                function utilizationPercent(actual, budget) {
                  if (budget === 0) return 0;
                  return Math.min(100, (actual / budget) * 100);
                }

                // Update Financial Overview
                document.querySelector(".financial-info .info-row:nth-child(2) .info-value").textContent = formatCurrency(financial.budget);
                document.querySelector(".financial-info .info-row:nth-child(3) .info-value").textContent = formatCurrency(financial.actual);
                document.querySelector(".financial-info .info-row:nth-child(4) .info-value").textContent = formatCurrency(financial.balance);

                const financialPercent = utilizationPercent(financial.actual, financial.budget);
                document.querySelector(".financial-info .progress-fill").style.width = financialPercent + "%";
                document.querySelector(".financial-info small").textContent = `${financialPercent.toFixed(0)}% Budget Utilized`;

                // Update Manpower Allocation
                document.querySelector(".manpower-info .info-row:nth-child(2) .info-value").textContent = formatHours(manpower.budget);
                document.querySelector(".manpower-info .info-row:nth-child(3) .info-value").textContent = formatHours(manpower.actuals);
                document.querySelector(".manpower-info .info-row:nth-child(4) .info-value").textContent = formatHours(manpower.balance);

                const manpowerPercent = utilizationPercent(manpower.actuals, manpower.budget);
                console.log(".manpowerPercent..........", manpowerPercent);
                document.querySelector(".manpower-info .progress-fill").style.width = manpowerPercent + "%";
                document.querySelector(".manpower-info small").textContent = `${manpowerPercent.toFixed(0)}% Hours Utilized`;

                // Show modal
                document.getElementById("paymentModal").style.display = "block";
                document.getElementById("Project").textContent = `${prj.id} - ${prj.project_name}`;



                if (prj) {
                  document.getElementById("prj_clainet").textContent = prj.client || '';
                  document.getElementById("prj_pm").textContent = prj.pm || '';
                  document.getElementById("prj_team").textContent = `${(prj.project_members || '').split(',').filter(Boolean).length} Members`;

                  document.getElementById("prj_povalue").textContent = prj.po_value
                    ? `$ ${Number(prj.po_value).toLocaleString('en-SG', { minimumFractionDigits: 0 })}`
                    : '$ 0';
                  document.getElementById("prj_startdate").textContent = formatDate(prj.start_time);
                  document.getElementById("prj_enddate").textContent = formatDate(prj.end_time);

                  const statusEl = document.getElementById("prj_status");
                  if (statusEl) {
                    statusEl.textContent = prj.status || 'N/A';

                    // Optional: Update badge color
                    statusEl.classList.remove("status-Design", "status-Install", "status-Testing", "status-Open");
                    if (prj.status === "Open") {
                      statusEl.classList.add("status-Open");
                    } else if (prj.status === "Design") {
                      statusEl.classList.add("status-Design");
                    } else if (prj.status === "Install") {
                      statusEl.classList.add("status-Install");
                    } else if (prj.status === "Testing") {
                      statusEl.classList.add("status-Testing");
                    }
                  }
                }

                const prTableBody = document.getElementById("prTableBody");
                if (prTableBody) {
                  prTableBody.innerHTML = '';

                  let pr_totalAmount = 0;
                  let pr_totalGST = 0;
                  let pr_totalTotal = 0;

                  prData.forEach((pr, index) => {
                    const amount = parseFloat(pr.amount) || 0;
                    const gst = parseFloat(pr.GST) || 0;
                    const total = parseFloat(pr.total) || 0;

                    pr_totalAmount += amount;
                    pr_totalGST += gst;
                    pr_totalTotal += total;

                    const row = document.createElement("tr");
                    row.innerHTML = `
                      <td style="text-align: center;">${index + 1}</td>

                        <td style="text-align: left;">${pr.PR_no}</td>
                        <td style="text-align: center;">${pr.PR_Date || ''}</td>
                        <td style="text-align: left;">${pr.Supplier_Name || ''}</td>
                        <td style="text-align: left;">${pr.created_by || ''}</td>
                        <td style="text-align: left;">${pr.Payment_Terms || ''}</td>
                        <td style="text-align: right;">${amount.toLocaleString('en-SG', { minimumFractionDigits: 2 })}</td>
                        <td style="text-align: right;">${gst.toLocaleString('en-SG', { minimumFractionDigits: 2 })}</td>
                        <td style="text-align: right;">${total.toLocaleString('en-SG', { minimumFractionDigits: 2 })}</td>
                        <td style="text-align: left;">${pr.approved_by || ''}</td>
                        <td style="text-align: center;">${pr.status || ''}</td>
                      `;
                    prTableBody.appendChild(row);
                  });

                  // ‚úÖ Update the PR count badge
                  document.getElementById("prBadge").textContent = prData.length;
                  // Update totals in the footer
                  const footerTotalAmount = document.getElementById("pr_totalAmount");
                  const footerTotalGST = document.getElementById("pr_totalGST");
                  const footerOverallTotal = document.getElementById("pr_overallTotal");

                  if (footerTotalAmount) {
                    footerTotalAmount.textContent = pr_totalAmount.toLocaleString('en-SG', { minimumFractionDigits: 2 });
                  }

                  if (footerTotalGST) {
                    footerTotalGST.textContent = pr_totalGST.toLocaleString('en-SG', { minimumFractionDigits: 2 });
                  }

                  if (footerOverallTotal) {
                    footerOverallTotal.textContent = pr_totalTotal.toLocaleString('en-SG', { minimumFractionDigits: 2 });
                  }

                }

                const poTableBody = document.getElementById("poTableBody");
                if (poTableBody) {
                  poTableBody.innerHTML = '';

                  let po_totalAmount = 0;
                  let po_totalGST = 0;
                  let po_totalTotal = 0;

                  poData.forEach((po, index) => {
                    const amount = parseFloat(po.amount) || 0;
                    const gst = parseFloat(po.GST) || 0;
                    const total = parseFloat(po.total) || 0;

                    po_totalAmount += amount;
                    po_totalGST += gst;
                    po_totalTotal += total;

                    const row = document.createElement("tr");
                    row.innerHTML = `
                      <td style="text-align: center;">${index + 1}</td>

                      <td style="text-align: left;">${po.PO_no || ''}</td>
                      <td style="text-align: left;">
                        ${(po.PR_no_ref || '').split('-').slice(-1)[0].trim()
                      }
                      </td>

                      <td style="text-align: left;">${po.Supplier_Name || ''}</td>
                      <td style="text-align: center;">${po.PO_Date || ''}</td>
                      <td style="text-align: left;">${po.leat_time || ''}</td>
                      <td style="text-align: right;">${amount.toLocaleString('en-SG', { minimumFractionDigits: 2 })}</td>
                      <td style="text-align: right;">${gst.toLocaleString('en-SG', { minimumFractionDigits: 2 })}</td>
                      <td style="text-align: right;">${total.toLocaleString('en-SG', { minimumFractionDigits: 2 })}</td>
                      <td style="text-align: left;">${po.created_by || ''}</td>
                      <td style="text-align: left;">${po.approved_by || ''}</td>
                      <td style="text-align: left;">${po.PO_Issued_by || ''}</td>
                      <td style="text-align: center;">${po.status || ''}</td>
                      <td style="text-align: center;">${po.do_staus || ''}</td>
                      <td style="text-align: center;">${po.payment_status || ''}</td>
                    `;
                    poTableBody.appendChild(row);
                  });
                  document.getElementById("poBadge").textContent = poData.length;


                  // Update totals in the footer
                  const footerTotalAmount = document.getElementById("po_totalAmount");
                  const footerTotalGST = document.getElementById("po_totalGST");
                  const footerOverallTotal = document.getElementById("po_overallTotal");

                  if (footerTotalAmount) {
                    footerTotalAmount.textContent = po_totalAmount.toLocaleString('en-SG', { minimumFractionDigits: 2 });
                  }
                  if (footerTotalGST) {
                    footerTotalGST.textContent = po_totalGST.toLocaleString('en-SG', { minimumFractionDigits: 2 });
                  }
                  if (footerOverallTotal) {
                    footerOverallTotal.textContent = po_totalTotal.toLocaleString('en-SG', { minimumFractionDigits: 2 });
                  }
                }

                const doTableBody = document.getElementById("doTableBody");
                if (doTableBody) {
                  doTableBody.innerHTML = '';

                  doData.forEach((doEntry, index) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                      <td style="text-align: center;">${index + 1}</td>
                      <td style="text-align: center;">${doEntry.do_date || ''}</td>
                      <td style="text-align: center;">${doEntry.do_number || ''}</td>
                      <td style="text-align: left;">${doEntry.created_by || ''}</td>
                      <td style="text-align: left;">${doEntry.client || ''}</td>
                      <td style="text-align: left;">${doEntry.delivery || ''}</td>
                      <td style="text-align: left;">${doEntry.Attn || ''}</td>
                    `;
                    doTableBody.appendChild(row);
                  });

                  // Update DO count badge if it exists
                  const doBadge = document.getElementById("doBadge");
                  if (doBadge) {
                    doBadge.textContent = doData.length;
                  }
                }

                const claimTableBody = document.getElementById("claimTableBody");
                if (claimTableBody) {
                  claimTableBody.innerHTML = '';

                  let claim_totalAmount = 0;
                  let claim_totalGST = 0;
                  let claim_totalTotal = 0;

                  claim_items.forEach((claim, index) => {
                    const amount = parseFloat(claim.amount) || 0;
                    const gst = parseFloat(claim.gst) || 0;
                    const total = parseFloat(claim.total) || 0;

                    claim_totalAmount += amount;
                    claim_totalGST += gst;
                    claim_totalTotal += total;

                    const row = document.createElement("tr");
                    row.innerHTML = `
                      <td style="text-align: center;">${index + 1}</td>
                      <td style="text-align: center;">${claim.claim_no || ''}</td>
                      <td style="text-align: left;">${claim.claim_by || ''}</td>
                      <td style="text-align: left;">${claim.vendor || ''}</td>
                      <td style="text-align: left;">${claim.Category || ''}</td>
                      <td style="text-align: left;">${claim.Sub_Category || ''}</td>
                      <td style="text-align: left;">${claim.itemname || ''}</td>
                      <td style="text-align: right;">${amount.toLocaleString('en-SG', { minimumFractionDigits: 2 })}</td>
                      <td style="text-align: right;">${gst.toLocaleString('en-SG', { minimumFractionDigits: 2 })}</td>
                      <td style="text-align: right;">${total.toLocaleString('en-SG', { minimumFractionDigits: 2 })}</td>
                    `;
                    claimTableBody.appendChild(row);
                  });

                  // Update totals in the footer
                  const footerAmount = document.getElementById("claim_totalAmount");
                  const footerGST = document.getElementById("claim_totalGST");
                  const footerTotal = document.getElementById("claim_overallTotal");

                  if (footerAmount) {
                    footerAmount.textContent = claim_totalAmount.toLocaleString('en-SG', { minimumFractionDigits: 2 });
                  }
                  if (footerGST) {
                    footerGST.textContent = claim_totalGST.toLocaleString('en-SG', { minimumFractionDigits: 2 });
                  }
                  if (footerTotal) {
                    footerTotal.textContent = claim_totalTotal.toLocaleString('en-SG', { minimumFractionDigits: 2 });
                  }
                  // Update claimsBadge count badge if it exists
                  const claimsBadge = document.getElementById("claimsBadge");
                  if (claimsBadge) {
                    claimsBadge.textContent = claim_items.length;
                  }
                }

                function formatDate(dateStr) {
                  if (!dateStr) return '';
                  const date = new Date(dateStr);
                  if (isNaN(date)) return '';
                  const day = String(date.getDate()).padStart(2, '0');
                  const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are 0-based
                  const year = String(date.getFullYear()).slice(-2);
                  return `${day}/${month}/${year}`;
                }

                const payTableBody = document.getElementById("payTableBody");
                if (payTableBody && Array.isArray(paymentData)) {
                  payTableBody.innerHTML = '';

                  let pay_totalAmount = 0;
                  let pay_totalGST = 0;
                  let pay_totalTotal = 0;
                  let pay_balanceTotal = 0;

                  paymentData.forEach((payment, index) => {
                    const amount = parseFloat(payment.amount) || 0;
                    const gst = parseFloat(payment.gst_value) || 0;
                    const total = parseFloat(payment.overall_total_amount) || 0;
                    const balance = parseFloat(payment.balence) || 0;

                    pay_totalAmount += amount;
                    pay_totalGST += gst;
                    pay_totalTotal += total;
                    pay_balanceTotal += balance;


                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td style="text-align: center;">${index + 1}</td>
                        <td style="text-align: center;">${payment.pay_number || ''}</td>
                        <td style="text-align: left;">${payment.po_number || ''}</td>
                        <td style="text-align: left;">${payment.supplier_name || ''}</td>
                        <td style="text-align: center;">${formatDate(payment.pay_date)}</td>
                        <td style="text-align: left;">${payment.created_by || ''}</td>
                        <td style="text-align: center;">${formatDate(payment.Invoice_date) || ''}</td>
                        <td style="text-align: right;">${amount.toLocaleString('en-SG', { minimumFractionDigits: 2 })}</td>
                        <td style="text-align: right;">${gst.toLocaleString('en-SG', { minimumFractionDigits: 2 })}</td>
                        <td style="text-align: right;">${total.toLocaleString('en-SG', { minimumFractionDigits: 2 })}</td>
                        <td style="text-align: center;">${payment.due_date || ''}</td>
                        <td style="text-align: left;">${formatDate(payment.paid_date) || ''}</td>
                        <td style="text-align: right;">${balance.toLocaleString('en-SG', { minimumFractionDigits: 2 })}</td>
                        <td style="text-align: center;">${payment.status || ''}</td>
                      `;
                    payTableBody.appendChild(row);
                  });

                  // Update totals in footer
                  document.getElementById("pay_totalAmount").textContent = pay_totalAmount.toLocaleString('en-SG', { minimumFractionDigits: 2 });
                  document.getElementById("pay_totalGST").textContent = pay_totalGST.toLocaleString('en-SG', { minimumFractionDigits: 2 });
                  document.getElementById("pay_overallTotal").textContent = pay_totalTotal.toLocaleString('en-SG', { minimumFractionDigits: 2 });
                  document.getElementById("pay_balance").textContent = pay_balanceTotal.toLocaleString('en-SG', { minimumFractionDigits: 2 });


                  // Update claimsBadge count badge if it exists
                  const paymentsBadge = document.getElementById("paymentsBadge");
                  if (paymentsBadge) {
                    paymentsBadge.textContent = paymentData.length;
                  }

                }

                const categorySummary = data.category_summary || [];  // You should pass this from backend

                // Clear old rows if any
                const materialBody = document.getElementById("materialbody");
                materialBody.innerHTML = "";

                // Populate rows dynamically
                categorySummary.forEach(item => {
                  const row = document.createElement("tr");

                  row.innerHTML = `
                      <td style="padding: 8px; border-bottom: 1px solid #ddd;">${item.label}</td>
                      <td style="padding: 8px; text-align: right; border-bottom: 1px solid #ddd;">${item.budget.toLocaleString(undefined, { minimumFractionDigits: 2 })}</td>
                      <td style="padding: 8px; text-align: right; border-bottom: 1px solid #ddd;">${item.actual.toLocaleString(undefined, { minimumFractionDigits: 2 })}</td>
                      <td style="padding: 8px; text-align: right; border-bottom: 1px solid #ddd;">${item.balance.toLocaleString(undefined, { minimumFractionDigits: 2 })}</td>
                    `;

                  materialBody.appendChild(row);
                });


              } else {
                alert('Project details not found!');
              }
            })
            .catch(error => console.error('Error fetching project details:', error));
        }

        function closeModal() {
          document.getElementById("paymentModal").style.display = "none";
          if (purchaseBarChartInstance) {
            purchaseBarChartInstance.destroy();
            purchaseBarChartInstance = null;
          }
        }

        // Optional: close modal on outside click
        window.onclick = function (event) {
          const modal = document.getElementById("paymentModal");
          if (event.target === modal) {
            modal.style.display = "none";
          }
        };

      </script>



    </div>

  </div>



  <style>
    .chart-container {
      position: relative;
      height: 60vh;
      /* 60% of viewport height */
      max-height: 300px;
      /* Optional cap */
      width: 100%;
    }


    /* Minimal Scrollbar */
    .scroll-minimal::-webkit-scrollbar {
      width: 6px;
      background: transparent;
    }

    .scroll-minimal::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.15);
      /* Subtle dark thumb */
      border-radius: 4px;
    }

    .scroll-minimal::-webkit-scrollbar-track {
      background: transparent;
    }

    /* For Firefox */
    .scroll-minimal {
      scrollbar-width: thin;
      scrollbar-color: rgba(0, 0, 0, 0.15) transparent;
    }

    .scroll-light-thumb::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
    }

    tfoot {
      position: sticky;
      bottom: 0;
      background-image: linear-gradient(to right, #d8e5f1, #d0e3f7);
      color: #333;
      z-index: 1;
    }

    .modal {
      display: block;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: linear-gradient(145deg, #ffffff, #f0f0f0);
      margin: 1% auto;
      padding: 0;
      border-radius: 20px;
      width: 95%;
      max-width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
      animation: modalSlideIn 0.4s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }

      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-header {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
      padding: 15px 15px;
      border-radius: 20px 20px 0 0;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .modal-header h2 {
      font-size: 28px;
      font-weight: 600;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      transition: all 0.3s ease;
      cursor: default;
    }

    .modal-header h2:hover {
      color: #dfd688;
      /* Optional: a soft blue accent */
      text-shadow: 0 3px 6px rgba(0, 0, 0, 0.6);
      transform: scale(1.03);
    }


    .project-info-header {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 10px;
    }

    .header-info-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 12px 16px;
      border-radius: 10px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
      cursor: default;
    }

    .header-info-item:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.4);
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    }


    .header-info-label {
      font-size: 12px;
      opacity: 0.8;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .header-info-value {
      font-size: 16px;
      font-weight: 600;
    }

    .close {
      color: white;
      float: right;
      font-size: 35px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      padding: 5px 10px;
      border-radius: 50%;
    }

    .close:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: rotate(90deg);
    }

    .navigation-tabs {
      background: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
      padding: 0;
      margin: 0;
    }

    .tab-list {
      display: flex;
      list-style: none;
      margin: 0;
      padding: 0;
      overflow-x: auto;
    }

    .tab-item {
      flex: 1;
      min-width: 150px;
    }

    .tab-button {
      width: 100%;
      background: none;
      border: none;
      padding: 9px 10px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      color: #6c757d;
      transition: all 0.3s ease;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .tab-button:hover {
      background: rgba(79, 172, 254, 0.1);
      color: #4facfe;
    }

    .tab-button.active {
      color: #4facfe;
      background: white;
    }

    .tab-button.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #4facfe, #00f2fe);
    }

    .tab-badge {
      background: #e9ecef;
      color: #495057;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      min-width: 20px;
      text-align: center;
    }

    .tab-button.active .tab-badge {
      background: #4facfe;
      color: white;
    }

    .tab-content {
      padding: 10px;
      min-height: 350px;
    }

    .content-section {
      display: none;
    }

    .content-section.active {
      display: block;
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 10px;
      padding: 10px;
    }

    .project-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }

    .info-card {
      background: linear-gradient(145deg, #ffffff, #f8f9fa);
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }

    .info-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
    }

    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }

    .card-icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      font-size: 24px;
      color: white;
    }

    .project-info .card-icon {
      background: linear-gradient(135deg, #667eea, #764ba2);
    }

    .financial-info .card-icon {
      background: linear-gradient(135deg, #f093fb, #f5576c);
    }

    .manpower-info .card-icon {
      background: linear-gradient(135deg, #4facfe, #00f2fe);
    }

    .documents-info .card-icon {
      background: linear-gradient(135deg, #43e97b, #38f9d7);
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      color: #2c3e50;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #ecf0f1;
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .info-label {
      font-weight: 500;
      color: #34495e;
      font-size: 14px;
    }

    .info-value {
      font-weight: 600;
      color: #2c3e50;
      font-size: 15px;
    }

    .amount {
      font-family: 'Courier New', monospace;
      font-weight: bold;
    }

    .positive {
      color: #27ae60;
    }

    .negative {
      color: #e74c3c;
    }

    .neutral {
      color: #f39c12;
    }

    .status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }


    .status-Design {
      background-color: #10b981;
    }

    /* Green */
    .status-Install {
      background-color: #facc15;
    }

    /* Yellow */
    .status-Testing {
      background-color: #3b82f6;
    }

    /* Blue */
    .status-Open {
      background-color: orangered;
    }

    /* Blue */

    .status-active {
      background: #d5f4e6;
      color: #27ae60;
    }

    .status-pending {
      background: #fef9e7;
      color: #f39c12;
    }

    .status-completed {
      background: #e8f4f8;
      color: #3498db;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #ecf0f1;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 8px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4facfe, #00f2fe);
      border-radius: 4px;
      transition: width 0.6s ease;
    }

    .document-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .doc-item {
      background: linear-gradient(145deg, #f8f9fa, #e9ecef);
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .doc-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .doc-count {
      font-size: 24px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 5px;
    }

    .doc-label {
      font-size: 12px;
      color: #7f8c8d;
      text-transform: uppercase;
      font-weight: 600;
    }

    .btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      margin: 10px 5px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    @media (max-width: 768px) {
      .modal-content {
        width: 98%;
        margin: 1% auto;
      }

      .project-overview {
        grid-template-columns: 1fr;
      }

      .modal-header {
        padding: 20px;
      }

      .modal-header h2 {
        font-size: 22px;
      }
    }
  </style>

  <script>
    function filterTable() {
      let input = document.getElementById("searchInput").value.toLowerCase().trim();
      let keywords = input.split(",").map(k => k.trim()).filter(k => k !== "");

      let table = document.getElementById("projectTable");
      let tr = table.getElementsByTagName("tr");

      for (let i = 1; i < tr.length; i++) {
        let shouldShow = true;
        let searchableColumns = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]; // Adjust as needed

        // Combine text content from all searchable columns
        let combinedText = "";
        for (let j = 0; j < searchableColumns.length; j++) {
          let td = tr[i].getElementsByTagName("td")[searchableColumns[j]];
          if (td) {
            combinedText += " " + td.textContent.toLowerCase().trim();
          }
        }

        // Check if all keywords are present
        shouldShow = keywords.every(keyword => combinedText.includes(keyword));
        tr[i].style.display = shouldShow ? "" : "none";
      }

      updateCounts();
    }

    function updateCounts() {
      let tr = document.getElementById("projectTable").getElementsByTagName("tr");
      let totalVisible = 0;
      let statusCounts = {
        Open: 0,
        Design: 0,
        Install: 0,
        Testing: 0
      };

      for (let i = 1; i < tr.length; i++) {
        if (tr[i].style.display !== "none") {
          totalVisible++;

          let statusCell = tr[i].getElementsByTagName("td")[16]; // Assuming status is at column index 6 (adjust if needed)
          if (statusCell) {
            let statusText = statusCell.textContent.trim();
            if (statusCounts.hasOwnProperty(statusText)) {
              statusCounts[statusText]++;
            }
          }
        }
      }

      document.getElementById("projectCount").textContent = totalVisible;
      document.getElementById("OpenCount").textContent = statusCounts.Open;
      document.getElementById("DesignCount").textContent = statusCounts.Design;
      document.getElementById("InstallCount").textContent = statusCounts.Install;
      document.getElementById("TestingCount").textContent = statusCounts.Testing;
    }

    window.onload = function () {
      filterTable();  // Run filter logic (even with empty input) to trigger initial count update
    };
  </script>

  <style>
    .status-open {
      color: #007bff;
      /* Blue */
      font-weight: bold;
    }

    .status-design {
      color: #28a745;
      /* Green */
      font-weight: bold;
    }

    .status-install {
      color: #554002;
      /* Yellow/Orange */
      font-weight: bold;
    }

    .status-testing {
      color: #dc3545;
      /* Red */
      font-weight: bold;
    }

    .span_tag {
      font-size: 14px;
      font-weight: bold;
      padding: 5px 8px;
      border: 1px solid #004b5d;
      border-radius: 5px;
      background-color: #f1f8ff;
      text-align: center;
      margin-right: 10px;
    }



    .search_container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      padding: 10px;
    }


    #projectTable {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 10px;
    }


    #searchInput {
      width: 40%;
      padding: 2px;
      margin: auto;
      display: block;
      border: 2px solid #ccc;
      border-radius: 5px;
      /* Rounded corners */
      outline: none;
      transition: all 0.3s ease-in-out;
      text-align: center;
      font-size: 16px;
    }

    #searchInput:hover {
      background-color: #f0f0f0;
    }

    #searchInput:focus {
      border-color: #004b5d;
      box-shadow: 0 0 8px rgba(0, 123, 255, 0.5);
    }
  </style>

  <style>
    #projectTable {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 10px;
    }


    #searchInput {
      width: 30%;
      padding: 2px;
      margin: auto;
      display: block;
      border: 2px solid #ccc;
      border-radius: 5px;
      /* Rounded corners */
      outline: none;
      transition: all 0.3s ease-in-out;
      text-align: center;
      font-size: 16px;
    }

    #searchInput:hover {
      background-color: #f0f0f0;
    }

    #searchInput:focus {
      border-color: #004b5d;
      box-shadow: 0 0 8px rgba(0, 123, 255, 0.5);
    }
  </style>



</body>

</html>