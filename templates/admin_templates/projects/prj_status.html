<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <title>Centroid Engineering Solutions</title>
    <link rel="icon" type="image/jpeg" href="static/ces_logo.png">
    <link rel="stylesheet" href="../static/res_style.css">
    <link rel="stylesheet"
        href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
    <!-- <script src="https://kit.fontawesome.com/f8e1a90484.js" crossorigin="anonymous"></script> -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />

</head>

<body>

    <input type="checkbox" id="menu-toggle">

    <div class="sidebar">

        <div class="side-header">
            <h3>C<span>entroid</span></h3>
        </div>

        <div class="side-content">

            <div class="profile">
                <div class="profile-img bg-img" style="background-image: url(../static/1.png)"></div>
                <h4>{{user['name']}}</h4>
                <small>{{department_code}}</small>
            </div>

            <div class="side-menu">
                <ul>

                    {% if department_code == 1000 %}
                    <li>
                        <a href="/admin">
                            <span class="fa-solid fa-user-tie"></span>
                            <small>Admin</small>
                        </a>
                    </li>
                    {% endif %}

                    {% if user_access['Accounts'] == 'On' %}
                    <li>
                        <a href="/accounts">
                            <span class="fa-solid fa-file-invoice-dollar"></span>
                            <small>Accounts</small>
                        </a>
                    </li>
                    {% endif %}
                    {% if user_access['toggleEnquiry'] == 'On' %}
                    <li>
                        <a href="/admin_enquiry">
                            <span class="fa-solid fa-handshake"></span>
                            <small>Leads</small>
                        </a>
                    </li>
                    {% endif %}
                    {% if user_access['toggleHR'] == 'On' %}
                    <li>
                        <a href="/hr">
                            <span class="fa-solid fa-user-plus"></span>
                            <small>HR</small>
                        </a>
                    </li>
                    {% endif %}
                    {% if user_access['togglePlanner'] == 'On' %}
                    <li>
                        <a href="/planner">
                            <span class="fa-solid fa-calendar-check"></span>
                            <small>Planner</small>
                        </a>
                    </li>
                    {% endif %}
                    {% if user_access['toggleProfile'] == 'On' %}
                    <li>
                        <a href="/profile">
                            <span class="fa-solid fa-user"></span>
                            <small>Profile</small>
                        </a>
                    </li>
                    {% endif %}
                    {% if user_access['toggleProjects'] == 'On' %}
                    <li>
                        <a href="/projects" class="active">
                            <span class="fa-solid fa-chart-simple"></span>
                            <small>Project</small>
                        </a>
                    </li>
                    {% endif %}
                    {% if user_access['togglePurchase'] == 'On' %}
                    <li>
                        <a href="/purchase">
                            <span class="fa-solid fa-cart-shopping"></span>
                            <small>Purchase</small>
                        </a>
                    </li>
                    {% endif %}

                    {% if user_access['toggleResources'] == 'On' %}
                    <li>
                        <a href="/resources">
                            <span class="fa-solid fa-recycle"></span>
                            <small>Resources</small>
                        </a>
                    </li>
                    {% endif %}

                    {% if department_code == 1000 %}
                    <li>
                        <a href="/settings">
                            <span class="fa-solid fa-gears"></span>
                            <small>Settings</small>
                        </a>
                    </li>
                    {% endif %}

                    <li>
                        <a href="{{ url_for('logout') }}">
                            <span class="fa-solid fa-right-from-bracket"></span>
                            <small>Log Out</small>
                        </a>
                    </li>
                </ul>
            </div>

        </div>

    </div>

    <div class="main-content">

        <div class="page-content" style="background-color: white;">

            <div class="page-header" style="background-color: white;">

                <nav class="navbar1">

                    <ul id="menuList1" class="navitems1">

                        {% if user_access['toggleDashboard'] == 'On' %}
                        <li>
                            <a href="{{ url_for('projects') }}" class="link">
                                <i class="fa-solid fa-chart-line" style="margin-right: 5px;"></i> Dashboard
                            </a>
                        </li>
                        {% endif %}

                        {% if user_access['toggleProjectStatus'] == 'On' %}
                        <li class="active">
                            <a href="{{ url_for('prj_status') }}" class="link">
                                <i class="fa-solid fa-clipboard-check" style="margin-right: 5px;"></i> Status
                            </a>
                        </li>
                        {% endif %}

                        {% if user_access['toggleHoursEdit'] == 'On' %}
                        <li>
                            <a href="{{ url_for('hours_edit') }}" class="link">
                                <i class="fa-solid fa-clock-rotate-left" style="margin-right: 5px;"></i> Hours Edit
                            </a>
                        </li>
                        {% endif %}

                        {% if user_access['toggleMaterialReceipt'] == 'On' %}
                        <li><a href="{{ url_for('Material_Receipt') }}" class="link"><i
                                    class="fa-solid fa-industry"></i>
                                Material Receipt</a></li>
                        {% endif %}

                        {% if user_access['toggleHoursView'] == 'On' %}
                        <li>
                            <a href="{{ url_for('hrs_view') }}" class="link">
                                <i class="fa-solid fa-clock" style="margin-right: 5px;"></i> Hours View
                            </a>
                        </li>
                        {% endif %}

                    </ul>

                    <div class="menu-icon">
                        <i class="fa-solid fa-bars" onclick="toggleMenu()"></i>
                    </div>

                    <script>
                        let menuList1 = document.getElementById("menuList1");
                        menuList1.style.maxHeight = "0px";

                        function toggleMenu1() {
                            if (menuList1.style.maxHeight == "0px") {
                                menuList1.style.maxHeight = "300px";
                            } else {
                                menuList1.style.maxHeight = "0px";
                            }
                        }
                    </script>

                </nav>

                <div class="line"></div>

            </div>

            <div class="search_container">
                <h3 style="color: #004274;">Project's (<span id="requestCount">0</span>) </h3>

                <input type="text" id="searchInput" placeholder="Search by Project ID, Project Name, DOC......."
                    onkeyup="filterTable()">

            </div>

            <style>
                .span_tag {
                    font-size: 14px;
                    font-weight: bold;
                    color: #004b5d;
                    padding: 5px 8px;
                    border: 1px solid #004b5d;
                    border-radius: 5px;
                    background-color: #f1f8ff;
                    color: #004b5d;
                    text-align: center;
                    margin-right: 10px;
                }

                #totalAmount {
                    color: #28a745;
                    /* Green for amount */
                }

                #totalGST {
                    color: #0c8de2;
                    /* Yellow for GST */
                }

                #overallTotal {
                    color: #dc3545;
                    /* Red for overall total */
                }
            </style>

            <style>
                .search_container {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    width: 100%;
                    padding: 10px;
                }


                #projectTable {
                    width: 100%;
                    border-collapse: separate;
                    border-spacing: 0;
                    border-radius: 10px;
                }


                #searchInput {
                    width: 30%;
                    padding: 2px;
                    margin: auto;
                    display: block;
                    border: 2px solid #ccc;
                    border-radius: 5px;
                    /* Rounded corners */
                    outline: none;
                    transition: all 0.3s ease-in-out;
                    text-align: center;
                    font-size: 16px;
                }

                #searchInput:hover {
                    background-color: #f0f0f0;
                }

                #searchInput:focus {
                    border-color: #004b5d;
                    box-shadow: 0 0 8px rgba(0, 123, 255, 0.5);
                }
            </style>

            <div class="table-responsive" style="background-color: white;">

                <table class="table table-main" width="100%" id="projectTable">

                    <thead style="position: sticky; top: 0;">

                        <!-- Main Headings Row -->
                        <tr style="position: sticky; top: 0; background: linear-gradient(45deg, #2c3e50, #a2bbd3);">
                            <th class="text-center" colspan="3"
                                style="text-align: center; vertical-align: middle; background: linear-gradient(45deg, #2c3e50, #34495e); color: white;">
                                Project Details
                            </th>
                            <th class="text-center" colspan="2"
                                style="text-align: center; vertical-align: middle; background: linear-gradient(45deg, #2c3e50, #34495e); color: white;">
                                Budget
                            </th>
                            <th class="text-center" colspan="2"
                                style="text-align: center; vertical-align: middle; background: linear-gradient(45deg, #2c3e50, #34495e); color: white;">
                                Actuals
                            </th>
                            <th class="text-center" colspan="2"
                                style="text-align: center; vertical-align: middle; background: linear-gradient(45deg, #2c3e50, #34495e); color: white;">
                                Balance
                            </th>
                            <th class="text-center"
                                style="text-align: center; vertical-align: middle; background: linear-gradient(45deg, #2c3e50, #34495e); color: white;">
                                DOC
                            </th>
                        </tr>

                        <!-- Subheadings Row -->
                        <tr>
                            <th class="text-center"
                                style="background: linear-gradient(45deg,#6491df, #1e3c72, #6491df); color: white;">S/N
                            </th>
                            <th class="text-center"
                                style="background: linear-gradient(45deg,#6491df, #1e3c72, #6491df); color: white;">Proj
                                ID</th>
                            <th class="text-center"
                                style="background: linear-gradient(45deg,#6491df, #1e3c72, #6491df); color: white;">
                                Project Name
                            </th>
                            <th class="text-center"
                                style="text-align: center; vertical-align: middle; background: linear-gradient(45deg,#6491df, #1e3c72, #6491df); color: white;">
                                Material
                            </th>
                            <th class="text-center"
                                style="text-align: center; vertical-align: middle; background: linear-gradient(45deg,#6491df, #1e3c72, #6491df); color: white;">
                                Manpower(hr)
                            </th>
                            <th class="text-center"
                                style="text-align: center; vertical-align: middle; background: linear-gradient(45deg,#6491df, #1e3c72, #6491df); color: white;">
                                Material
                            </th>
                            <th class="text-center"
                                style="text-align: center; vertical-align: middle; background: linear-gradient(45deg,#6491df, #1e3c72, #6491df); color: white;">
                                Resources(hr)
                            </th>
                            <th class="text-center"
                                style="text-align: center; vertical-align: middle; background: linear-gradient(45deg,#6491df, #1e3c72, #6491df); color: white;">
                                Material
                            </th>
                            <th class="text-center"
                                style="text-align: center; vertical-align: middle; background: linear-gradient(45deg,#6491df, #1e3c72, #6491df); color: white;">
                                Resources(hr)
                            </th>
                            <th class="text-center"
                                style=" text-align: center; background: linear-gradient(45deg,#6491df, #1e3c72, #6491df); color: white;">
                                DOC
                            </th>
                        </tr>

                    </thead>



                    <tbody>
                        {% if not project_list.empty %}


                        {% for project in project_list %}
                        <tr class="mainRow"
                            style="background: {% if project.material_balance < 0 or project.manpower_balance < 0 %}linear-gradient(45deg, #f8d7da, #f1dede){% endif %};">
                            <td class="text-center">{{ loop.index }}</td>
                            <td class="text-center prjid">{{ project.id }}</td>
                            <td class="text-center prjname">{{ project.project_name }}</td>
                            <td class="text-center">$ {{ '{:,.2f}'.format(project.material_budget) }}</td>
                            <td class="text-center">{{ '{:,.2f}'.format(project.manpower_budget) }} </td>
                            <td class="text-center">$ {{ '{:,.2f}'.format(project.material_actuals) }}</td>
                            <td class="text-center">{{ '{:,.2f}'.format(project.manpower_actuals) }} </td>
                            <td class="text-center">$ {{ '{:,.2f}'.format(project.material_balance) }}</td>
                            <td class="text-center">{{ '{:,.2f}'.format(project.manpower_balance) }} </td>
                            <td class="text-center endtime" style="text-align: center; ">{{ project.end_time }}</td>
                            <!-- <td class="text-center">{{ project.Inv_total }}</td> -->
                        </tr>
                        {% endfor %}

                        {% else %}
                        <tr>
                            <td colspan="15" class="text-center"
                                style="text-align: center; font-size: larger; color: #dc3545;">No Projects Available
                            </td>
                        </tr>
                        {% endif %}

                    </tbody>

                </table>

            </div>

            <!-- Search Table -->
            <script>

                function filterTable() {
                    let input = document.getElementById("searchInput").value.toLowerCase().trim(); // Get search input
                    let rows = document.querySelectorAll(".mainRow");

                    rows.forEach(row => {
                        let prjid = row.querySelector(".prjid") ? row.querySelector(".prjid").textContent.trim().toLowerCase() : '';
                        let prjname = row.querySelector(".prjname") ? row.querySelector(".prjname").textContent.trim().toLowerCase() : '';
                        let endtime = row.querySelector(".endtime") ? row.querySelector(".endtime").textContent.trim().toLowerCase() : '';

                        // If any of the values contain the search input, display the row, else hide it
                        if (prjid.includes(input) || prjname.includes(input) || endtime.includes(input)) {
                            row.style.display = "";
                        } else {
                            row.style.display = "none";
                        }
                    });

                    updateTotals(); // Update the totals after filtering
                }

                function updateTotals() {
                    let requestCount = 0;
                    const rows = document.querySelectorAll("#projectTable tbody tr.mainRow");

                    rows.forEach(row => {
                        if (row.style.display !== "none") { // Only include rows that are not hidden
                            requestCount++;
                        }
                    });

                    document.getElementById("requestCount").textContent = requestCount;
                }

                // Call the function when the page loads
                document.addEventListener("DOMContentLoaded", () => {
                    updateTotals();
                });


            </script>




        </div>

    </div>

    <style>
        thead th {
            position: sticky;
            top: 0;
            z-index: 2;
            /* Ensure it appears above the table body */
        }

        thead th {
            background-color: white;
            box-shadow: 0 2px 2px -2px gray;
            /* Optional: Add shadow for better visibility */
        }

        .table-main th,
        .table-main td {
            border: 0.5px solid #f3f1f1;
            padding: 5px;
            text-align: left;
        }

        .table-main thead th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        th {
            text-align: center;
            vertical-align: middle;
        }
    </style>

</body>

</html>