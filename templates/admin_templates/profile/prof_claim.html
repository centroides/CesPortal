<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <title>Centroid Engineering Solutions</title>
    <link rel="icon" type="image/jpeg" href="static/ces_logo.png">
    <link rel="stylesheet" href="../static/res_style.css">
    <link rel="stylesheet"
        href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
    <!-- <script src="https://kit.fontawesome.com/f8e1a90484.js" crossorigin="anonymous"></script> -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
    <!-- Add jQuery and jQuery UI -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.0/themes/smoothness/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>


</head>

<body>

    <input type="checkbox" id="menu-toggle">

    <div class="sidebar">

        <div class="side-header">
            <h3>C<span>entroid</span></h3>
        </div>

        <div class="side-content">

            <div class="profile">
                <div class="profile-img bg-img" style="background-image: url(../static/1.png)"></div>
                <h4>{{user['name']}}</h4>
                <small>{{department_code}}</small>
            </div>

            <div class="side-menu">
                <ul>

                    {% if department_code == 1000 %}
                    <li>
                        <a href="/admin">
                            <span class="fa-solid fa-user-tie"></span>
                            <small>Admin</small>
                        </a>
                    </li>
                    {% endif %}

                    {% if user_access['Accounts'] == 'On' %}
                    <li>
                        <a href="/accounts">
                            <span class="fa-solid fa-file-invoice-dollar"></span>
                            <small>Accounts</small>
                        </a>
                    </li>
                    {% endif %}
                    {% if user_access['toggleEnquiry'] == 'On' %}
                    <li>
                        <a href="/admin_enquiry">
                            <span class="fa-solid fa-handshake"></span>
                            <small>Leads</small>
                        </a>
                    </li>
                    {% endif %}
                    {% if user_access['toggleHR'] == 'On' %}
                    <li>
                        <a href="/hr">
                            <span class="fa-solid fa-user-plus"></span>
                            <small>HR</small>
                        </a>
                    </li>
                    {% endif %}
                    {% if user_access['togglePlanner'] == 'On' %}
                    <li>
                        <a href="/planner">
                            <span class="fa-solid fa-calendar-check"></span>
                            <small>Planner</small>
                        </a>
                    </li>
                    {% endif %}
                    {% if user_access['toggleProfile'] == 'On' %}
                    <li>
                        <a href="/profile" class="active">
                            <span class="fa-solid fa-user"></span>
                            <small>Profile</small>
                        </a>
                    </li>
                    {% endif %}
                    {% if user_access['toggleProjects'] == 'On' %}
                    <li>
                        <a href="/projects">
                            <span class="fa-solid fa-chart-simple"></span>
                            <small>Project</small>
                        </a>
                    </li>
                    {% endif %}
                    {% if user_access['togglePurchase'] == 'On' %}
                    <li>
                        <a href="/purchase">
                            <span class="fa-solid fa-cart-shopping"></span>
                            <small>Purchase</small>
                        </a>
                    </li>
                    {% endif %}

                    {% if user_access['toggleResources'] == 'On' %}
                    <li>
                        <a href="/resources">
                            <span class="fa-solid fa-recycle"></span>
                            <small>Resources</small>
                        </a>
                    </li>
                    {% endif %}

                    {% if department_code == 1000 %}
                    <li>
                        <a href="/settings">
                            <span class="fa-solid fa-gears"></span>
                            <small>Settings</small>
                        </a>
                    </li>
                    {% endif %}

                    <li>
                        <a href="{{ url_for('logout') }}">
                            <span class="fa-solid fa-right-from-bracket"></span>
                            <small>Log Out</small>
                        </a>
                    </li>
                </ul>
            </div>


        </div>

    </div>

    <div class="main-content">

        <div class="page-content" style="background-color: white;">

            <div class="page-header" style="background-color: white;">

                <nav class="navbar1">

                    <ul id="menuList1" class="navitems1">

                        {% if user_access['toggleAccountHub'] == 'On' %}
                        <li>
                            <a href="{{ url_for('prof_act') }}" class="link">
                                <i class="fa-solid fa-user" style="margin-right: 5px;"></i> Account Info
                            </a>
                        </li>
                        {% endif %}

                        {% if user_access['toggle_prof_TimeSheet'] == 'On' %}
                        <li>
                            <a href="{{ url_for('prof_time') }}" class="link">
                                <i class="fas fa-clock" style="margin-right: 5px;"></i> Time Sheet
                            </a>
                        </li>
                        {% endif %}

                        {% if user_access['toggleProfPurchaseRequest'] == 'On' %}
                        <li>
                            <a href="{{ url_for('prof_pr') }}" class="link">
                                <i class="fa-solid fa-cart-shopping" style="margin-right: 5px;"></i> Purchase Request
                            </a>
                        </li>
                        {% endif %}
                        {% if user_access['toggleProfPurchaseOrder'] == 'On' %}
                        <li>
                            <a href="{{ url_for('prof_po') }}" class="link">
                                <i class="fa-solid fa-file-invoice" style="margin-right: 5px;"></i> Purchase Order
                            </a>
                        </li>
                        {% endif %}
                        {% if user_access['toggleProjectRequest'] == 'On' %}
                        <li>
                            <a href="{{ url_for('prof_prj') }}" class="link">
                                <i class="fa-solid fa-project-diagram" style="margin-right: 5px;"></i> Project Request
                            </a>
                        </li>
                        {% endif %}
                        {% if user_access['togglePaymentRequest'] == 'On' %}
                        <li>
                            <a href="{{ url_for('prof_pay') }}" class="link">
                                <i class="fa-solid fa-hand-holding-dollar" style="margin-right: 5px;"></i> Payment
                                Request
                            </a>
                        </li>
                        {% endif %}
                        {% if user_access['toggle_prof_claims'] == 'On' %}
                        <li class="active">
                            <a href="{{ url_for('prof_claim') }}" class="link">
                                <i class="fa-solid fa-file-alt" style="margin-right: 5px;"></i> Claims
                            </a>
                        </li>
                        {% endif %}
                        {% if user_access['toggleDeliveryOrders'] == 'On' %}
                        <li>
                            <a href="{{ url_for('prof_do') }}" class="link">
                                <i class="fa-solid fa-box" style="margin-right: 5px;"></i> Delivery Order
                            </a>
                        </li>
                        {% endif %}

                        {% if user_access['toggleprofSuppliers'] == 'On' %}
                        <li>
                            <a href="{{ url_for('prof_supplier') }}" class="link">
                                <i class="fa-solid fa-truck" style="margin-right: 5px;"></i> Suppliers
                            </a>
                        </li>
                        {% endif %}

                    </ul>

                    <div class="menu-icon">
                        <i class="fa-solid fa-bars" onclick="toggleMenu()"></i>
                    </div>

                    <script>
                        let menuList1 = document.getElementById("menuList1");
                        menuList1.style.maxHeight = "0px";

                        function toggleMenu1() {
                            if (menuList1.style.maxHeight == "0px") {
                                menuList1.style.maxHeight = "300px";
                            } else {
                                menuList1.style.maxHeight = "0px";
                            }
                        }
                    </script>

                </nav>

                <div class="line"></div>

            </div>

            <div class="search_container">

                <div class="timenav">
                    <link rel="stylesheet"
                        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

                    <ul id="menuList1" class="timebar">

                        {% if user_access['toggle_prof_view_create_Claims'] == 'On' %}
                        <li>
                            <input type="radio" id="subContractRadio" name="sectionRadio"
                                onclick="showSection('Sub_contract'); toggleContainer('Sub_contract')"
                                style="display: none;">
                            <label for="subContractRadio" class="link1"><i class="fa-brands fa-product-hunt fa-beat"
                                    style="margin-right: 5px;"></i>Project</label>
                        </li>
                        {% endif %}

                        {% if user_access['toggle_prof_view_create_Claims'] == 'On' %}
                        <li>
                            <input type="radio" id="addprojectRadio" name="sectionRadio"
                                onclick="showSection('addproject'); toggleContainer('addproject')"
                                style="display: none;">
                            <label for="addprojectRadio" class="link1"> <i class="fa-solid fa-angle-double-up fa-beat"
                                    style="margin-right: 5px;"></i>Overhead </label>
                        </li>
                        {% endif %}
                        {% if user_access['toggle_prof_view_create_Claims'] == 'On' %}
                        <li>
                            <input type="radio" id="adduserRadio" name="sectionRadio"
                                onclick="showSection('adduser'); toggleContainer('adduser')" style="display: none;">
                            <label for="adduserRadio" class="link1"> <i class="fa-solid fa-car fa-beat"
                                    style="margin-right: 5px;"> </i>Vehicle</label>
                        </li>
                        {% endif %}
                        {% if user_access['toggle_prof_view_all_Claims'] == 'On' or
                        user_access['toggle_prof_view_involved_Claims'] == 'On' %}
                        <li>
                            <input type="radio" id="PublicHolidayRadio" name="sectionRadio"
                                onclick="showSection('PublicHoliday'); toggleContainer('PublicHoliday')"
                                style="display: none;">
                            <label for="PublicHolidayRadio" class="link1">
                                <i class="fa-solid fa-money-bill-wave fa-beat" style="margin-right: 5px;"></i>Claims
                                List
                            </label>
                        </li>
                        {% endif %}

                    </ul>

                    <div class="menu-icon1">
                        <i class="fa-solid fa-bars" onclick="toggleMenu1()"></i>
                    </div>

                    <script>
                        function showSection(sectionId) {
                            // Hide all sections
                            var sections = document.querySelectorAll('.addproject, .adduser, .Sub_contract, .Others, .Vehicle, .PublicHoliday');
                            sections.forEach(function (section) {
                                section.style.display = 'none';
                            });

                            // Show the selected section
                            var selectedSection = document.getElementById(sectionId);
                            if (selectedSection) {
                                selectedSection.style.display = 'block';
                            }
                        }

                        function toggleContainer(containerId) {
                            // You can add custom logic here if needed
                            // console.log('Toggling container: ' + containerId);
                        }

                        window.onload = function () {
                            // Set the addproject section to be shown by default


                            // If the 'show' value is provided from the backend, override the default behavior
                            var show = '{{ show }}'; // The value of 'show' from the backend
                            if (show === 'project') {
                                showSection('Sub_contract');
                                document.getElementById('subContractRadio').checked = true;
                            } else if (show === 'overhead') {
                                showSection('addproject');
                                document.getElementById('addprojectRadio').checked = true;
                            } else if (show === 'vehicle') {
                                showSection('adduser');
                                document.getElementById('adduserRadio').checked = true;
                            } else if (show === 'allclaims') {
                                showSection('PublicHoliday');
                                document.getElementById('PublicHolidayRadio').checked = true;
                            }
                        };

                    </script>

                </div>

                <style>
                    .search_container {

                        width: 100%;
                        padding: 10px;
                    }


                    #projectTable {
                        width: 100%;
                        border-collapse: separate;
                        border-spacing: 0;
                        border-radius: 10px;
                    }
                </style>

            </div>

            {% if user_access['toggle_prof_view_create_Claims'] == 'On' %}
            <div class="Sub_contract" id="Sub_contract" style="display: none;"> <!-- project -->

                <form class="p-3" id="pr_expenseForm" method="POST" onsubmit="handleFormSubmit(event)"
                    enctype="multipart/form-data">

                    <div class="table-responsive">

                        <table class="table" id="project_dynamicTable">

                            <thead>
                                <tr>
                                    <th style=" width: 2%; text-align: center;">S/N</th>
                                    <th style="width: 2%;"></th>
                                    <th style=" width: 7%;">Project ID</th>
                                    <th style=" width: 8%; ">Category</th>
                                    <th style=" width: 2%; ">Date</th>
                                    <th style=" width: 12%; ">Supplier Name</th>
                                    <th style=" width: 28%; ">Item Name</th>
                                    <th style=" width: 10%; ">Inv NO</th>
                                    <th style=" width: 2%; ">Curr.</th>
                                    <th style=" width: 4%; ">Rate</th>
                                    <th style=" width: 2%; text-align: center;">GST%</th>
                                    <th style=" width: 5%; ">Amount</th>
                                    <th style=" width: 5%;  ">GST</th>
                                    <th style=" width: 7%; ">Total</th>
                                    <th style=" width: 3%; ">Del</th>
                                </tr>
                            </thead>

                            <tbody>
                                {% for i in range(10) %}
                                <tr>
                                    <td>{{i + 1}}</td>
                                    <td style="display: none;">
                                        <input type="hidden" name="row_index[]" value="{{ i + 1 }}">
                                    </td>


                                    <td style="text-align: center;"><input type="checkbox" class="row-check"
                                            style="text-align: center;"></td>

                                    <td>
                                        <select name="project_id[]" class="project_filed"
                                            style="width: 100%; padding: 5px; overflow: hidden; text-overflow: ellipsis;"
                                            required>
                                            <option value="">Proj ID</option>
                                            {% for project in projects %}
                                            <option value="{{ project[0] }}">
                                                {{ project[0] }} - {{ project[1] }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </td>

                                    <td style="width: 8%;">
                                        <select name="category_subcategory[]" style="padding: 5px; width: 100%;"
                                            required>
                                            <option value="">Select Category</option>
                                            <option value="2001">Mechanical</option>
                                            <option value="2002">Electrical</option>
                                            <option value="2003">Instruments</option>
                                            <option value="2004">PLC, Software, Hardware</option>
                                            <option value="2005">Panel Hardware</option>
                                            <option value="2006">Consumables</option>
                                            <option value="2007">Tools</option>
                                            <option value="2008">Civil</option>
                                            <option value="2009">Computer</option>
                                        </select>
                                    </td>

                                    <td><input type="date" name="purcahse_date[]" required></td>
                                    <td><input type="text" name="Supplier_name[]" class="supplier-input" required></td>
                                    <td><input type="text" name="item_name[]" class="item-name-input" required></td>
                                    <td><input type="text" name="invoice_number[]" required></td>
                                    <td><input type="text" name="currency[]" value="SGD" style="text-align: center;"
                                            required></td>

                                    <td><input type="text" step="any" name="rate[]" style="text-align: center;"
                                            value="1" required></td>

                                    <td><input type="number" step="any" name="gst_percent[]" class="gst_percent"
                                            style="text-align: center;" value="{{gst}}" oninput="pr_calculateRow(this)"
                                            required></td>

                                    <td><input type="number" step="any" name="amount[]" class="amount"
                                            style="text-align: center;" oninput="pr_calculateRow(this)" required></td>

                                    <td><input type="number" step="any" name="gst_value[]" class="gst_value"
                                            oninput="pr_calculateRow(this)" style="text-align: center;" required></td>
                                    <td><input type="number" step="any" name="total[]" class="total"
                                            oninput="pr_calculateRow(this)" style="text-align: center;" required></td>

                                    <td>
                                        <button type="button" class="btn-delete"
                                            style="color: red; background: none; border: none; cursor: pointer;"
                                            onclick="pr_deleteRow(this)">
                                            <ion-icon name="trash" class="fa-solid fa-trash"></ion-icon>
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>

                            <tfoot>

                                <tr>
                                    <td colspan="11" style="text-align: right; font-weight: bold; color: #FF5733;">
                                        Totals : </td>
                                    <td><input type="text" id="footer_total_amount" value="0.00"
                                            style="text-align: center;" readonly></td>
                                    <td><input type="text" id="footer_total_gst" value="0.00"
                                            style="text-align: center;" readonly></td>
                                    <td><input type="text" id="footer_total_final" value="0.00"
                                            style="text-align: center;" readonly></td>
                                    <td><input type="hidden" name="footer_total_amount" id="footer_total_amount_hidden"
                                            value="0.00"></td>
                                    <td><input type="hidden" name="footer_total_gst" id="footer_total_gst_hidden"
                                            value="0.00"></td>
                                    <td><input type="hidden" name="footer_total_final" id="footer_total_final_hidden"
                                            value="0.00"></td>
                                    <td></td>
                                    <td></td>
                                </tr>

                            </tfoot>

                        </table>

                    </div>

                    <div class="button-container1">

                        <div class='flex-item'>
                            <button class="new-enquiry-btn" id="projectaddRowButton">+</button>
                        </div>

                        <div class='flex-item' style="width: 50%;">
                            <input type="text" class="form-control" name="comments"
                                placeholder="Enter your comments here.............." />
                        </div>

                        <div class='flex-item' style="display: none;">
                            <input type="text" class="form-control" name="existingprjcalim" id="existingprjcalim"
                                value="">
                        </div>

                        <div class='flex-item'>

                            <button type="submit" class="new-enquiry-btn" id="generateClaimButton">
                                Generate Claim
                            </button>

                        </div>

                        <style>
                            .form-control::placeholder {
                                text-align: center;
                            }

                            .new-enquiry-btn {
                                background: linear-gradient(45deg, #007AFF, #34AADC, #5856D6, #FF2D55);
                                background-size: 200% 200%;
                                color: white;
                                font-weight: bold;
                                border: none;
                                padding: 8px 12px;
                                border-radius: 5px;
                                cursor: pointer;
                                font-size: 14px;
                                display: flex;
                                align-items: center;
                                transition: all 0.4s ease-in-out;
                                box-shadow: 10px 10px 10px rgba(0, 122, 255, 0.3);
                                /* Soft shadow */
                            }

                            /* Hover effect: Darker Gradient + Glow */
                            .new-enquiry-btn:hover {
                                background: linear-gradient(45deg, #0056A3, #2598C1, #4741C1, #D91D48);
                                background-size: 200% 200%;
                                box-shadow: 0px 6px 12px rgba(0, 86, 179, 0.5);
                                /* Stronger shadow on hover */
                                transform: scale(1.05);
                            }
                        </style>

                        <script>

                            function validateForm() {
                                let isValid = true;
                                let missingFields = [];

                                const projectSelect = document.getElementById('projectSelect');
                                if (projectSelect && projectSelect.value === "") {
                                    missingFields.push("Project ID (overall selection)");
                                }

                                const rows = document.querySelectorAll('#project_dynamicTable tbody tr');

                                rows.forEach((row, index) => {
                                    const rowNumber = index + 1;

                                    const checks = [
                                        { field: row.querySelector('select[name="project_id[]"]'), name: "Project ID" },
                                        { field: row.querySelector('select[name="category_subcategory[]"]'), name: "Category" },
                                        { field: row.querySelector('input[name="purcahse_date[]"]'), name: "Purchase Date" },
                                        { field: row.querySelector('input[name="Supplier_name[]"]'), name: "Supplier Name" },
                                        { field: row.querySelector('input[name="item_name[]"]'), name: "Item Name" },
                                        { field: row.querySelector('input[name="invoice_number[]"]'), name: "Invoice Number" },
                                        { field: row.querySelector('input[name="currency[]"]'), name: "Currency" },
                                        { field: row.querySelector('input[name="rate[]"]'), name: "Rate" },
                                        { field: row.querySelector('input[name="gst_percent[]"]'), name: "GST Percent" },
                                        { field: row.querySelector('input[name="amount[]"]'), name: "Amount" },
                                        { field: row.querySelector('input[name="gst_value[]"]'), name: "GST Value" },
                                        { field: row.querySelector('input[name="total[]"]'), name: "Total" },
                                    ];

                                    checks.forEach(check => {
                                        const field = check.field;
                                        if (!field || (check.type === "file" ? field.files.length === 0 : !field.value.trim())) {
                                            missingFields.push(`Row ${rowNumber}: ${check.name}`);
                                            isValid = false;
                                        }
                                    });
                                });

                                if (!isValid) {
                                    alert("The following fields are missing or invalid:\n\n" + missingFields.join("\n"));
                                }

                                return isValid;
                            }

                            let isProjectClaimSubmitting = false;

                            function handleFormSubmit(event) {
                                event.preventDefault();

                                if (isProjectClaimSubmitting) return; // Prevent double submission
                                isProjectClaimSubmitting = true;

                                const form = document.getElementById('pr_expenseForm');
                                const submitButton = form.querySelector('button[type="submit"]');
                                const originalButtonText = submitButton.innerText;

                                submitButton.disabled = true;
                                submitButton.innerText = 'Generating Claim...';

                                // Run validation
                                if (!validateForm()) {
                                    submitButton.disabled = false;
                                    submitButton.innerText = originalButtonText;
                                    isProjectClaimSubmitting = false;
                                    return;
                                }

                                const formData = new FormData(form);

                                fetch('/project_claim', {
                                    method: 'POST',
                                    body: formData,
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.message) {
                                            alert(data.message);
                                            form.reset();

                                            const rows = document.querySelectorAll('#project_dynamicTable tbody tr');
                                            rows.forEach(row => {
                                                row.querySelectorAll('input').forEach(input => input.value = '');
                                                row.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
                                            });

                                            form.querySelectorAll('input[type="file"]').forEach(input => input.value = '');
                                        } else {
                                            alert('Unexpected response. Please try again.');
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                        alert('An error occurred. Please try again.');
                                    })
                                    .finally(() => {
                                        submitButton.disabled = false;
                                        submitButton.innerText = originalButtonText;

                                        isProjectClaimSubmitting = false;
                                    });
                            }

                        </script>

                    </div>

                </form>

                <script>

                    // Function to delete a row
                    function pr_deleteRow(button) {
                        const row = button.closest('tr');
                        row.remove();
                        updateRowIndices();
                        pr_updateTotalSum(); // Recalculate the total sum after deletion
                    }

                    function updateRowIndices() {
                        var table = document.getElementById('project_dynamicTable').getElementsByTagName('tbody')[0];
                        for (var i = 0; i < table.rows.length; i++) {
                            table.rows[i].cells[0].innerHTML = i + 1;
                        }
                    }

                    document.addEventListener('DOMContentLoaded', function () {
                        // For Supplier Name autocomplete
                        $(document).on('focus', '.supplier-input', function () {
                            if (!$(this).data("autocomplete")) {
                                $(this).autocomplete({
                                    source: function (request, response) {
                                        $.getJSON('/get_vendor_suggestions', { term: request.term }, function (data) {
                                            response(data);

                                        });
                                    }
                                });
                            }
                        });

                        // For Item Name autocomplete
                        $(document).on('focus', '.item-name-input', function () {
                            if (!$(this).data("autocomplete")) {
                                $(this).autocomplete({
                                    source: function (request, response) {
                                        $.getJSON('/get_itemname_suggestions', { term: request.term }, function (data) {
                                            response(data);

                                        });
                                    }
                                });
                            }
                        });
                    });

                    // Function to calculate GST and Total values based on inputs
                    // Function to calculate GST and Total values based on inputs
                    function pr_calculateRow(inputElement) {
                        const row = inputElement.closest('tr');
                        const amountField = row.querySelector('.amount');
                        const gstPercentField = row.querySelector('.gst_percent');
                        const gstValueField = row.querySelector('.gst_value');
                        const totalField = row.querySelector('.total');

                        const amount = parseFloat(amountField.value) || 0;
                        const gstPercent = parseFloat(gstPercentField.value) || 0;
                        const gstValue = parseFloat(gstValueField.value) || 0;
                        const total = parseFloat(totalField.value) || 0;

                        if (inputElement.classList.contains('amount') || inputElement.classList.contains('gst_percent')) {
                            // If Amount or GST% is updated, calculate GST Value and Total
                            const calculatedGstValue = (amount * gstPercent) / 100;
                            gstValueField.value = calculatedGstValue.toFixed(2);
                            totalField.value = (amount + calculatedGstValue).toFixed(2);
                        } else if (inputElement.classList.contains('gst_value')) {
                            // If GST Value is updated, calculate Amount and Total
                            const calculatedAmount = total - gstValue;
                            amountField.value = calculatedAmount.toFixed(2);
                            gstPercentField.value = ((gstValue / calculatedAmount) * 100).toFixed(2);
                        } else if (inputElement.classList.contains('total')) {
                            // If Total is updated and GST% exists, calculate GST Value and Amount
                            if (gstPercent > 0) {
                                const calculatedAmount = total / (1 + gstPercent / 100);
                                const calculatedGstValue = total - calculatedAmount;
                                amountField.value = calculatedAmount.toFixed(2);
                                gstValueField.value = calculatedGstValue.toFixed(2);
                            } else {
                                // If GST% is not provided, fallback logic (optional)
                                const calculatedAmount = total - gstValue;
                                amountField.value = calculatedAmount.toFixed(2);
                                gstPercentField.value = ((gstValue / calculatedAmount) * 100).toFixed(2);
                            }
                        }

                        pr_updateTotalSum();
                    }


                    // Update total amounts in footer
                    function pr_updateTotalSum() {
                        // console.log(".funtion is called to update the totals")
                        let totalAmount = 0;
                        let totalGst = 0;
                        let totalFinal = 0;

                        const rows = document.querySelectorAll('#project_dynamicTable tbody tr');
                        rows.forEach(row => {
                            const amount = parseFloat(row.querySelector('.amount').value) || 0;
                            const gstValue = parseFloat(row.querySelector('.gst_value').value) || 0;
                            const total = parseFloat(row.querySelector('.total').value) || 0;

                            totalAmount += amount;
                            totalGst += gstValue;
                            totalFinal += total;
                        });

                        // Format numbers in international format (e.g., 1,234.56)
                        document.getElementById('footer_total_amount').value = totalAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        document.getElementById('footer_total_gst').value = totalGst.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        document.getElementById('footer_total_final').value = totalFinal.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                        document.getElementById('footer_total_amount_hidden').value = totalAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        document.getElementById('footer_total_gst_hidden').value = totalGst.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        document.getElementById('footer_total_final_hidden').value = totalFinal.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                    }

                    document.addEventListener('DOMContentLoaded', function () {
                        document.getElementById('projectaddRowButton').addEventListener('click', function (e) {
                            e.preventDefault();
                            const tableBody = document.querySelector('#project_dynamicTable tbody');
                            const selectedRows = tableBody.querySelectorAll('tr');
                            let currentRowCount = tableBody.rows.length;
                            let selected = false;

                            selectedRows.forEach((row, index) => {

                                const checkbox = row.querySelector('.row-check');

                                if (checkbox && checkbox.checked) {
                                    selected = true;

                                    const project_id = row.querySelector('select[name="project_id[]"]').value;
                                    const category = row.querySelector('select[name="category_subcategory[]"]').value;
                                    const purchase_date = row.querySelector('input[name="purcahse_date[]"]').value;
                                    const supplier = row.querySelector('input[name="Supplier_name[]"]').value;
                                    const item_name = row.querySelector('input[name="item_name[]"]').value;
                                    const invoice_number = row.querySelector('input[name="invoice_number[]"]').value;
                                    const currency = row.querySelector('input[name="currency[]"]').value;
                                    const rate = row.querySelector('input[name="rate[]"]').value;
                                    const gst_percent = row.querySelector('input[name="gst_percent[]"]').value;
                                    const amount = row.querySelector('input[name="amount[]"]').value;
                                    const gst_value = row.querySelector('input[name="gst_value[]"]').value;
                                    const total = row.querySelector('input[name="total[]"]').value;
                                    const newRow = document.createElement('tr');
                                    const newRowCount = ++currentRowCount;

                                    newRow.innerHTML = `
                                        <td style="width: 2%;">${newRowCount}</td>

                                        <td style="display: none;">
                                            <input type="hidden" name="row_index[]" value="${newRowCount}">

                                        </td>
                                        <td><input type="checkbox" class="row-check"></td>
                                        <td style="width: 7%;">
                                            <select name="project_id[]" class="project_filed" style="width: 100%; padding: 5px;" required>
                                                <option value="">Proj ID</option>
                                                {% for project in projects %}
                                                <option value="{{ project[0] }}" ${project_id === "{{ project[0] }}" ? "selected" : ""}>
                                                    {{ project[0] }} - {{ project[1] }}
                                                </option>
                                                {% endfor %}
                                            </select>
                                        </td>
                                        <td style="width: 8%;">
                                            <select name="category_subcategory[]" style="padding: 5px; width: 100%;" required>
                                                <option value="">Select Category</option>
                                                <option value="2001" ${category === "2001" ? "selected" : ""}>Mechanical</option>
                                                <option value="2002" ${category === "2002" ? "selected" : ""}>Electrical</option>
                                                <option value="2003" ${category === "2003" ? "selected" : ""}>Instruments</option>
                                                <option value="2004" ${category === "2004" ? "selected" : ""}>PLC, Software, Hardware</option>
                                                <option value="2005" ${category === "2005" ? "selected" : ""}>Panel Hardware</option>
                                                <option value="2006" ${category === "2006" ? "selected" : ""}>Consumables</option>
                                                <option value="2007" ${category === "2007" ? "selected" : ""}>Tools</option>
                                                <option value="2008" ${category === "2008" ? "selected" : ""}>Civil</option>
                                                <option value="2009" ${category === "2009" ? "selected" : ""}>Computer</option>
                                            </select>
                                        </td>
                                        <td><input type="date" name="purcahse_date[]" value="${purchase_date}" required></td>
                                        <td><input type="text" name="Supplier_name[]" value="${supplier}" required></td>
                                        <td><input type="text" name="item_name[]" value="${item_name}" required></td>
                                        <td><input type="text" name="invoice_number[]" ></td>
                                        <td><input type="text" name="currency[]" value="${currency}" style="text-align: center;" required></td>
                                        <td><input type="number" step="any" name="rate[]" value="${rate}" style="text-align: center;" required></td>
                                        <td><input type="number" step="any" name="gst_percent[]" class="gst_percent" value="{{gst}}" style="text-align: center;" oninput="pr_calculateRow(this)" required></td>
                                        <td><input type="number" step="any" name="amount[]" class="amount"  style="text-align: center;" oninput="pr_calculateRow(this)" required></td>
                                        <td><input type="number" step="any" name="gst_value[]" class="gst_value"  style="text-align: center;" oninput="pr_calculateRow(this)" required></td>
                                        <td><input type="number" step="any" name="total[]" class="total"  style="text-align: center;" oninput="pr_calculateRow(this)" required></td>

                                        <td>
                                            <button type="button" class="btn-delete" style="color: red; background: none; border: none; cursor: pointer;" onclick="pr_deleteRow(this)">
                                                <ion-icon name="trash" class="fa-solid fa-trash"></ion-icon>
                                            </button>
                                        </td>
                                    `;

                                    tableBody.appendChild(newRow);
                                    pr_updateTotalSum();
                                }

                            });


                            if (!selected) {
                                const newRow = document.createElement('tr');
                                const newRowCount = currentRowCount + 1;

                                newRow.innerHTML = `
                                    <td style="width: 2%;">${newRowCount}</td>
                                    <td style="display: none;">
                                        <input type="hidden" name="row_index[]" value="${newRowCount}">

                                    </td>
                                    <td><input type="checkbox" class="row-check"></td>
                                    <td style="width: 7%;">
                                        <select name="project_id[]" class="project_filed" style="width: 100%; padding: 5px;" required>
                                            <option value="">Proj ID</option>
                                            {% for project in projects %}
                                            <option value="{{ project[0] }}">
                                                {{ project[0] }} - {{ project[1] }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                    <td style="width: 8%;">
                                        <select name="category_subcategory[]" style="padding: 5px; width: 100%;" required>
                                            <option value="">Select Category</option>
                                            <option value="2001">Mechanical</option>
                                            <option value="2002">Electrical</option>
                                            <option value="2003">Instruments</option>
                                            <option value="2004">PLC, Software, Hardware</option>
                                            <option value="2005">Panel Hardware</option>
                                            <option value="2006">Consumables</option>
                                            <option value="2007">Tools</option>
                                            <option value="2008">Civil</option>
                                            <option value="2009">Computer</option>
                                        </select>
                                    </td>
                                    <td><input type="date" name="purcahse_date[]" required></td>
                                    <td>    <input type="text" name="Supplier_name[]" class="supplier-input" required></td>
                                    <td><input type="text" name="item_name[]" class="item-name-input" required></td>
                                    <td><input type="text" name="invoice_number[]"></td>
                                    <td><input type="text" name="currency[]" value="SGD" style="text-align: center;" required></td>
                                    <td><input type="number" step="any" name="rate[]" value="1" style="text-align: center;" required></td>
                                    <td><input type="number" step="any" name="gst_percent[]" class="gst_percent" value="{{gst}}" style="text-align: center;" oninput="pr_calculateRow(this)" required></td>
                                    <td><input type="number" step="any" name="amount[]" class="amount" style="text-align: center;" oninput="pr_calculateRow(this)" required></td>
                                    <td><input type="number" step="any" name="gst_value[]" class="gst_value" style="text-align: center;" oninput="pr_calculateRow(this)" required></td>
                                    <td><input type="number" step="any" name="total[]" class="total" style="text-align: center;" oninput="pr_calculateRow(this)" required></td>
                                    


                                    <td>
                                        <button type="button" class="btn-delete" style="color: red; background: none; border: none; cursor: pointer;" onclick="pr_deleteRow(this)">
                                            <ion-icon name="trash" class="fa-solid fa-trash"></ion-icon>
                                        </button>
                                    </td>
                                `;

                                tableBody.appendChild(newRow);
                            }
                        });
                    });

                </script>

            </div>
            {% endif %}

            <div class="addproject" id="addproject" style="display: none;"> <!-- Ocerhead -->

                <form class="p-3" id="ov_expenseForm" method="POST" onsubmit="handleFormoverheadSubmit(event)"
                    enctype="multipart/form-data">

                    <div class="table-responsive">

                        <table class="table" id="overhead_dynamicTable">

                            <thead>
                                <tr>
                                    <th style=" width: 2%; text-align: center;">S/N</th>
                                    <th style="width: 2%;"></th>
                                    <th style=" width: 8%; ">Category</th>
                                    <th style=" width: 2%; ">Date</th>
                                    <th style=" width: 13%; ">Supplier Name</th>
                                    <th style=" width: 30%; ">Item Name</th>
                                    <th style=" width: 10%; ">Inv NO</th>
                                    <th style=" width: 2%; ">Curr.</th>
                                    <th style=" width: 3%; ">Rate</th>
                                    <th style=" width: 2%; text-align: center;">GST%</th>
                                    <th style=" width: 5%; ">Amount</th>
                                    <th style=" width: 5%;  ">GST</th>
                                    <th style=" width: 7%; ">Total</th>
                                    <th style=" width: 3%; ">Del</th>
                                </tr>
                            </thead>

                            <tbody>

                                {% for i in range(10) %}
                                <tr>
                                    <td>{{i + 1}}</td>
                                    <td style="display: none;">
                                        <input type="hidden" name="ov_row_index[]" value="{{ i + 1 }}">
                                    </td>
                                    <td style="text-align: center;"><input type="checkbox" class="ov-row-check"
                                            style="text-align: center;"></td>

                                    <td style="width: 8%;">
                                        <select name="ov_category_subcategory[]" style="padding: 5px; width: 100%;"
                                            required>
                                            <option value="">Select Category</option>

                                            <optgroup label="Admin">
                                                <option value="500 - Admin-Pantry">Pantry</option>
                                                <option value="500 - Admin-PPE">PPE</option>
                                                <option value="500 - Admin-Food">Food</option>
                                                <option value="500 - Admin-Entertainment">Entertainment</option>
                                                <option value="500 - Admin-Travel">Travel</option>
                                                <option value="500 - Admin-Book Keeping">Book Keeping</option>
                                                <option value="500 - Admin-Accounts">Accounts</option>
                                                <option value="500 - Admin-Others">Others</option>
                                            </optgroup>

                                            <optgroup label="Asset">
                                                <option value="501 - Asset-Computer">Computer</option>
                                                <option value="501 - Asset-Monitor">Monitor</option>
                                                <option value="501 - Asset-Printer">Printer</option>
                                                <option value="501 - Asset-Aircon">Aircon</option>
                                                <option value="501 - Asset-Tools">Tools</option>
                                                <option value="501 - Asset-Furniture">Furniture</option>
                                                <option value="501 - Asset-Equipment">Equipment</option>
                                                <option value="501 - Asset-Instrument">Instrument</option>
                                                <option value="501 - Asset-Refrigerator">Refrigerator</option>
                                            </optgroup>

                                            <optgroup label="Property">
                                                <option value="502 - Property-Tax">Tax</option>
                                                <option value="502 - Property-Loan">Loan</option>
                                            </optgroup>

                                            <optgroup label="Insurance">
                                                <option value="503 - Insurance-FWMI">FWMI</option>
                                                <option value="503 - Insurance-Public Liab">Public Liab</option>
                                                <option value="503 - Insurance-Bond">Bond</option>
                                                <option value="503 - Insurance-Permits">Permits</option>
                                                <option value="503 - Insurance-Medical">Medical</option>
                                            </optgroup>

                                            <optgroup label="Subscription">
                                                <option value="504 - Subscription-MS Office">MS Office</option>
                                                <option value="504 - Subscription-MS Project">MS Project</option>
                                                <option value="504 - Subscription-Avetta">Avetta</option>
                                                <option value="504 - Subscription-Adobe">Adobe</option>
                                                <option value="504 - Subscription-Website">Website</option>
                                                <option value="504 - Subscription-Anydesk">Anydesk</option>
                                            </optgroup>

                                            <optgroup label="raining">
                                                <option value="505 - Training-General">General</option>
                                            </optgroup>

                                            <optgroup label="Medical">
                                                <option value="506 - Medical-Regular">Regular</option>
                                            </optgroup>



                                            <optgroup label="Housing">
                                                <option value="508 - Housing-Rent">Rent</option>
                                                <option value="508 - Housing-Internet">Internet</option>
                                                <option value="508 - Housing-Phone">Phone</option>
                                                <option value="508 - Housing-SP Power">SP Power</option>
                                                <option value="508 - Housing-Gas">Gas</option>
                                                <option value="508 - Housing-Printer">Printer</option>
                                                <option value="508 - Housing-Others">Others</option>
                                            </optgroup>

                                            <optgroup label="Certification">
                                                <option value="509 - Certification-ISO">ISO</option>
                                                <option value="509 - Certification-Calibration">Calibration</option>
                                                <option value="509 - Certification-Aspri">Aspri</option>
                                                <option value="509 - Certification-BCA">BCA</option>
                                                <option value="509 - Certification-Others">Others</option>
                                            </optgroup>
                                        </select>
                                    </td>


                                    <td><input type="date" name="ov_purchase_date[]" required></td>
                                    <td><input type="text" name="ov_Supplier_name[]" class="supplier-input" required>
                                    </td>
                                    <td><input type="text" name="ov_item_name[]" class="item-name-input" required></td>
                                    <td><input type="text" name="ov_invoice_number[]" required></td>
                                    <td><input type="text" name="ov_currency[]" value="SGD" style="text-align: center;"
                                            required></td>
                                    <td><input type="text" step="any" name="ov_rate[]" style="text-align: center;"
                                            value="1" required></td>

                                    <td><input type="text" step="any" name="ov_gst_percent[]" value="{{gst}}"
                                            class="ov-gst-percent" oninput="calculateGST(this)"
                                            style="text-align: center;" required></td>

                                    <td><input type="text" step="any" name="ov_amount[]" class="ov-amount"
                                            oninput="calculateGST(this)" style="text-align: center;" required></td>


                                    <td><input type="text" step="any" name="ov_gst_value[]" class="ov-gst-value"
                                            oninput="calculateGST(this)" style="text-align: center;" required></td>

                                    <td><input type="text" step="any" name="ov_total[]" style="text-align: center;"
                                            class="ov-total" oninput="calculateGST(this)" required></td>

                                    <td>

                                        <button type="button" class="btn-delete"
                                            style="color: red; background: none;  border: none; cursor: pointer;"
                                            onclick="ov_deleteRow(this)">
                                            <ion-icon name="trash" class="fa-solid fa-trash"></ion-icon>
                                        </button>

                                    </td>

                                </tr>
                                {% endfor %}

                            </tbody>

                            <tfoot>
                                <tr>
                                    <td colspan="10" style="text-align: right; font-weight: bold; color: #FF5733;">
                                        Totals : </td>
                                    <td><input type="text" id="ov_footer_total_amount" value="0.00"
                                            style="text-align: center;" readonly></td>
                                    <td><input type="text" id="ov_footer_total_gst" value="0.00"
                                            style="text-align: center;" readonly></td>
                                    <td><input type="text" id="ov_footer_total_final" value="0.00"
                                            style="text-align: center;" readonly></td>
                                    <td><input type="hidden" name="ov_footer_total_amount"
                                            id="ov_footer_total_amount_hidden" value="0.00"></td>
                                    <td><input type="hidden" name="ov_footer_total_gst" id="ov_footer_total_gst_hidden"
                                            value="0.00"></td>
                                    <td><input type="hidden" name="ov_footer_total_final"
                                            id="ov_footer_total_final_hidden" value="0.00"></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </tfoot>

                        </table>

                    </div>

                    <div class="button-container1">

                        <div class='flex-item'>
                            <button class="new-enquiry-btn" id="overheadaddRowButton">+</button>
                        </div>

                        <div class='flex-item' style="width: 50%;">
                            <input type="text" class="form-control" name="ov_comments"
                                placeholder="Enter your comments here.............." />
                        </div>

                        <div class='flex-item' style="display: none;">
                            <input type="text" class="form-control" name="existingovercalim" id="existingovercalim"
                                value="">
                        </div>

                        <div class='flex-item'>

                            <button type="submit" class="new-enquiry-btn" id="generateClaimButtonover">
                                Generate Claim
                            </button>

                        </div>

                    </div>

                </form>

                <script>

                    function ov_deleteRow(button) {
                        const row = button.closest('tr');
                        row.remove();
                        ovupdateRowIndices();
                        ov_updateOverallTotal(); // Recalculate the total sum after deletion
                    }

                    function ovupdateRowIndices() {
                        var table = document.getElementById('overhead_dynamicTable').getElementsByTagName('tbody')[0];
                        for (var i = 0; i < table.rows.length; i++) {
                            table.rows[i].cells[0].innerHTML = i + 1;
                        }
                    }

                    function validateoverheadForm() {
                        let isValid = true;
                        let missingFields = [];


                        const rows = document.querySelectorAll('#overhead_dynamicTable tbody tr');

                        rows.forEach((row, index) => {
                            const rowNumber = index + 1;

                            const checks = [

                                { ov_field: row.querySelector('select[name="ov_category_subcategory[]"]'), name: "Category" },
                                { ov_field: row.querySelector('input[name="ov_purchase_date[]"]'), name: "Purchase Date" },
                                { ov_field: row.querySelector('input[name="ov_Supplier_name[]"]'), name: "Supplier Name" },
                                { ov_field: row.querySelector('input[name="ov_item_name[]"]'), name: "Item Name" },
                                { ov_field: row.querySelector('input[name="ov_invoice_number[]"]'), name: "Invoice Number" },
                                { ov_field: row.querySelector('input[name="ov_currency[]"]'), name: "Currency" },
                                { ov_field: row.querySelector('input[name="ov_rate[]"]'), name: "Rate" },
                                { ov_field: row.querySelector('input[name="ov_gst_percent[]"]'), name: "GST Percent" },
                                { ov_field: row.querySelector('input[name="ov_amount[]"]'), name: "Amount" },
                                { ov_field: row.querySelector('input[name="ov_gst_value[]"]'), name: "GST Value" },
                                { ov_field: row.querySelector('input[name="ov_total[]"]'), name: "Total" },
                            ];

                            checks.forEach(check => {
                                const ov_field = check.ov_field;
                                if (!ov_field || (check.type === "file" ? ov_field.files.length === 0 : !ov_field.value.trim())) {
                                    missingFields.push(`Row ${rowNumber}: ${check.name}`);
                                    isValid = false;
                                }
                            });
                        });

                        if (!isValid) {
                            alert("The following fields are missing or invalid:\n\n" + missingFields.join("\n"));
                        }

                        return isValid;
                    }

                    let isOverheadClaimSubmitting = false;

                    function handleFormoverheadSubmit(event) {
                        event.preventDefault();

                        if (isOverheadClaimSubmitting) return; // Prevent double submission
                        isOverheadClaimSubmitting = true;

                        const form = document.getElementById('ov_expenseForm');
                        const submitButton = form.querySelector('button[type="submit"]');
                        const ovoriginalButtonText = submitButton.innerText;

                        submitButton.disabled = true;
                        submitButton.innerText = 'Generating Claim...';

                        // Run validation
                        if (!validateoverheadForm()) {
                            submitButton.disabled = false;
                            submitButton.innerText = ovoriginalButtonText;
                            isOverheadClaimSubmitting = false;
                            return;
                        }

                        const formData = new FormData(form);

                        fetch('/overhead_claim', {
                            method: 'POST',
                            body: formData,
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.message) {
                                    alert(data.message);
                                    form.reset();

                                    const rows = document.querySelectorAll('#overhead_dynamicTable tbody tr');
                                    rows.forEach(row => {
                                        row.querySelectorAll('input').forEach(input => input.value = '');
                                        row.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
                                    });

                                    form.querySelectorAll('input[type="file"]').forEach(input => input.value = '');
                                } else {
                                    alert('Unexpected response. Please try again.');
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('An error occurred. Please try again.');
                            })
                            .finally(() => {
                                submitButton.disabled = false;
                                submitButton.innerText = ovoriginalButtonText;
                                isOverheadClaimSubmitting = false;
                            });
                    }

                    function calculateGST(input) {
                        const row = input.closest('tr');
                        const amountField = row.querySelector('.ov-amount');
                        const gstPercentField = row.querySelector('.ov-gst-percent');
                        const gstValueField = row.querySelector('.ov-gst-value');
                        const totalField = row.querySelector('.ov-total');

                        let amount = parseFloat(amountField.value) || 0;
                        let gstPercent = gstPercentField.value.trim() === "" ? 9 : parseFloat(gstPercentField.value);
                        let gstValue = parseFloat(gstValueField.value) || 0;
                        let total = parseFloat(totalField.value) || 0;

                        if (input.classList.contains('ov-total')) {
                            total = parseFloat(input.value) || 0;
                            if (gstPercent > 0) {
                                // Calculate amount and GST value from total and GST%
                                amount = total / (1 + gstPercent / 100);
                                gstValue = total - amount;
                                amountField.value = amount.toFixed(2);
                                gstValueField.value = gstValue.toFixed(2);
                            } else if (amount > 0) {
                                // Fallback if no GST% is given, assume GST value = total - amount
                                gstValue = total - amount;
                                gstPercentField.value = ((gstValue / amount) * 100).toFixed(2);
                                gstValueField.value = gstValue.toFixed(2);
                            }
                        } else if (input.classList.contains('ov-gst-percent')) {
                            gstValue = (amount * gstPercent) / 100;
                            gstValueField.value = gstValue.toFixed(2);
                            totalField.value = (amount + gstValue).toFixed(2);
                        } else if (input.classList.contains('ov-gst-value')) {
                            gstValue = parseFloat(input.value) || 0;
                            gstPercentField.value = ((gstValue / amount) * 100).toFixed(2);
                            totalField.value = (amount + gstValue).toFixed(2);
                        } else if (input.classList.contains('ov-amount')) {
                            gstValue = (amount * gstPercent) / 100;
                            gstValueField.value = gstValue.toFixed(2);
                            totalField.value = (amount + gstValue).toFixed(2);
                        }

                        ov_updateOverallTotal();
                    }

                    function ov_updateOverallTotal() {
                        let ov_totalAmount = 0;
                        let ov_totalGst = 0;
                        let ov_totalFinal = 0;
                        const ov_rows = document.querySelectorAll('#overhead_dynamicTable tbody tr');

                        ov_rows.forEach(row => {
                            const ov_amount = parseFloat(row.querySelector('.ov-amount')?.value) || 0;
                            const ov_gstValue = parseFloat(row.querySelector('.ov-gst-value')?.value) || 0;
                            const ov_total = parseFloat(row.querySelector('.ov-total')?.value) || 0;

                            ov_totalAmount += ov_amount;
                            ov_totalGst += ov_gstValue;
                            ov_totalFinal += ov_total;
                        });

                        const formatNumber = num => num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                        document.getElementById('ov_footer_total_amount').value = formatNumber(ov_totalAmount);
                        document.getElementById('ov_footer_total_gst').value = formatNumber(ov_totalGst);
                        document.getElementById('ov_footer_total_final').value = formatNumber(ov_totalFinal);

                        document.getElementById('ov_footer_total_amount_hidden').value = formatNumber(ov_totalAmount);
                        document.getElementById('ov_footer_total_gst_hidden').value = formatNumber(ov_totalGst);
                        document.getElementById('ov_footer_total_final_hidden').value = formatNumber(ov_totalFinal);
                    }


                    document.addEventListener('DOMContentLoaded', function () {
                        document.getElementById('overheadaddRowButton').addEventListener('click', function (e) {
                            e.preventDefault();
                            const tableBody = document.querySelector('#overhead_dynamicTable tbody');
                            const selectedRows = tableBody.querySelectorAll('tr');
                            let currentRowCount = tableBody.rows.length;
                            let selected = false;

                            selectedRows.forEach((row, index) => {

                                const checkbox = row.querySelector('.ov-row-check');

                                if (checkbox && checkbox.checked) {
                                    selected = true;

                                    const ov_category = row.querySelector('select[name="ov_category_subcategory[]"]').value;
                                    const ov_purchase_date = row.querySelector('input[name="ov_purchase_date[]"]').value;
                                    const ov_supplier = row.querySelector('input[name="ov_Supplier_name[]"]').value;
                                    const ov_item_name = row.querySelector('input[name="ov_item_name[]"]').value;
                                    const ov_invoice_number = row.querySelector('input[name="ov_invoice_number[]"]').value;
                                    const ov_currency = row.querySelector('input[name="ov_currency[]"]').value;
                                    const ov_rate = row.querySelector('input[name="ov_rate[]"]').value;
                                    const ov_gst_percent = row.querySelector('input[name="ov_gst_percent[]"]').value;
                                    const ov_amount = row.querySelector('input[name="ov_amount[]"]').value;
                                    const ov_gst_value = row.querySelector('input[name="ov_gst_value[]"]').value;
                                    const ov_total = row.querySelector('input[name="ov_total[]"]').value;
                                    const ov_newRow = document.createElement('tr');
                                    const ov_newRowCount = ++currentRowCount;


                                    ov_newRow.innerHTML = `
                                        <td style="width: 2%;">${ov_newRowCount}</td>

                                        <td style="display: none;">
                                            <input type="hidden" name="ov_row_index[]" value="${ov_newRowCount}">

                                        </td>
                                        <td><input type="checkbox" class="ov-row-check"></td>
   
                                        <td style="width: 8%;">
                                            <select name="ov_category_subcategory[]" style="padding: 5px; width: 100%;" required>
                                                <option value="">Select Category</option>

                                                <optgroup label="Admin">
                                                    <option value="500 - Admin-Pantry" ${ov_category === "500 - Admin-Pantry" ? "selected" : ""}>Pantry</option>
                                                    <option value="500 - Admin-PPE" ${ov_category === "500 - Admin-PPE" ? "selected" : ""}>PPE</option>
                                                    <option value="500 - Admin-Food" ${ov_category === "500 - Admin-Food" ? "selected" : ""}>Food</option>
                                                    <option value="500 - Admin-Entertainment" ${ov_category === "500 - Admin-Entertainment" ? "selected" : ""}>Entertainment</option>
                                                    <option value="500 - Admin-Travel" ${ov_category === "500 - Admin-Travel" ? "selected" : ""}>Travel</option>
                                                    <option value="500 - Admin-Book Keeping" ${ov_category === "500 - Admin-Book Keeping" ? "selected" : ""}>Book Keeping</option>
                                                    <option value="500 - Admin-Accounts" ${ov_category === "500 - Admin-Accounts" ? "selected" : ""}>Accounts</option>
                                                    <option value="500 - Admin-Others" ${ov_category === "500 - Admin-Others" ? "selected" : ""}>Others</option>
                                                </optgroup>

                                                <optgroup label="Asset">
                                                    <option value="501 - Asset-Computer" ${ov_category === "501 - Asset-Computer" ? "selected" : ""}>Computer</option>
                                                    <option value="501 - Asset-Monitor" ${ov_category === "501 - Asset-Monitor" ? "selected" : ""}>Monitor</option>
                                                    <option value="501 - Asset-Printer" ${ov_category === "501 - Asset-Printer" ? "selected" : ""}>Printer</option>
                                                    <option value="501 - Asset-Aircon" ${ov_category === "501 - Asset-Aircon" ? "selected" : ""}>Aircon</option>
                                                    <option value="501 - Asset-Tools" ${ov_category === "501 - Asset-Tools" ? "selected" : ""}>Tools</option>
                                                    <option value="501 - Asset-Furniture" ${ov_category === "501 - Asset-Furniture" ? "selected" : ""}>Furniture</option>
                                                    <option value="501 - Asset-Equipment" ${ov_category === "501 - Asset-Equipment" ? "selected" : ""}>Equipment</option>
                                                    <option value="501 - Asset-Instrument" ${ov_category === "501 - Asset-Instrument" ? "selected" : ""}>Instrument</option>
                                                    <option value="501 - Asset-Refrigerator" ${ov_category === "501 - Asset-Refrigerator" ? "selected" : ""}>Refrigerator</option>
                                                </optgroup>

                                                <optgroup label="Property">
                                                    <option value="502 - Property-Tax" ${ov_category === "502 - Property-Tax" ? "selected" : ""}>Tax</option>
                                                    <option value="502 - Property-Loan" ${ov_category === "502 - Property-Loan" ? "selected" : ""}>Loan</option>
                                                </optgroup>

                                                <optgroup label="Insurance">
                                                    <option value="503 - Insurance-FWMI" ${ov_category === "503 - Insurance-FWMI" ? "selected" : ""}>FWMI</option>
                                                    <option value="503 - Insurance-Public Liab" ${ov_category === "503 - Insurance-Public Liab" ? "selected" : ""}>Public Liab</option>
                                                    <option value="503 - Insurance-Bond" ${ov_category === "503 - Insurance-Bond" ? "selected" : ""}>Bond</option>
                                                    <option value="503 - Insurance-Permits" ${ov_category === "503 - Insurance-Permits" ? "selected" : ""}>Permits</option>
                                                    <option value="503 - Insurance-Medical" ${ov_category === "503 - Insurance-Medical" ? "selected" : ""}>Medical</option>
                                                </optgroup>

                                                <optgroup label="Subscription">
                                                    <option value="504 - Subscription-MS Office" ${ov_category === "504 - Subscription-MS Office" ? "selected" : ""}>MS Office</option>
                                                    <option value="504 - Subscription-MS Project" ${ov_category === "504 - Subscription-MS Project" ? "selected" : ""}>MS Project</option>
                                                    <option value="504 - Subscription-Avetta" ${ov_category === "504 - Subscription-Avetta" ? "selected" : ""}>Avetta</option>
                                                    <option value="504 - Subscription-Adobe" ${ov_category === "504 - Subscription-Adobe" ? "selected" : ""}>Adobe</option>
                                                    <option value="504 - Subscription-Website" ${ov_category === "504 - Subscription-Website" ? "selected" : ""}>Website</option>
                                                    <option value="504 - Subscription-Anydesk" ${ov_category === "504 - Subscription-Anydesk" ? "selected" : ""}>Anydesk</option>
                                                </optgroup>

                                                <optgroup label="Training">
                                                    <option value="505 - Training" ${ov_category === "505 - Training" ? "selected" : ""}>Training</option>
                                                </optgroup>

                                                <optgroup label="Medical">
                                                    <option value="506 - Medical-Regular" ${ov_category === "506 - Medical-Regular" ? "selected" : ""}>Regular</option>
                                                </optgroup>


                                                <optgroup label="Housing">
                                                    <option value="508 - Housing-Rent" ${ov_category === "508 - Housing-Rent" ? "selected" : ""}>Rent</option>
                                                    <option value="508 - Housing-Internet" ${ov_category === "508 - Housing-Internet" ? "selected" : ""}>Internet</option>
                                                    <option value="508 - Housing-Phone" ${ov_category === "508 - Housing-Phone" ? "selected" : ""}>Phone</option>
                                                    <option value="508 - Housing-SP Power" ${ov_category === "508 - Housing-SP Power" ? "selected" : ""}>SP Power</option>
                                                    <option value="508 - Housing-Gas" ${ov_category === "508 - Housing-Gas" ? "selected" : ""}>Gas</option>
                                                    <option value="508 - Housing-Printer" ${ov_category === "508 - Housing-Printer" ? "selected" : ""}>Printer</option>
                                                    <option value="508 - Housing-Others" ${ov_category === "508 - Housing-Others" ? "selected" : ""}>Others</option>
                                                </optgroup>

                                                <optgroup label="Certification">
                                                    <option value="509 - Certification-ISO" ${ov_category === "509 - Certification-ISO" ? "selected" : ""}>ISO</option>
                                                    <option value="509 - Certification-Calibration" ${ov_category === "509 - Certification-Calibration" ? "selected" : ""}>Calibration</option>
                                                    <option value="509 - Certification-Aspri" ${ov_category === "509 - Certification-Aspri" ? "selected" : ""}>Aspri</option>
                                                    <option value="509 - Certification-BCA" ${ov_category === "509 - Certification-BCA" ? "selected" : ""}>BCA</option>
                                                    <option value="509 - Certification-Others" ${ov_category === "509 - Certification-Others" ? "selected" : ""}>Others</option>
                                                </optgroup>
                                            </select>
                                        </td>


                                        <td><input type="date" name="ov_purchase_date[]" value="${ov_purchase_date}" required></td>
                                        <td><input type="text" name="ov_Supplier_name[]" value="${ov_supplier}" required></td>
                                        <td><input type="text" name="ov_item_name[]" value="${ov_item_name}" required></td>
                                        <td><input type="text" name="ov_invoice_number[]" ></td>
                                        <td><input type="text" name="ov_currency[]" value="${ov_currency}" required></td>
                                        <td><input type="text" step="any" name="ov_rate[]" value="${ov_rate}" style="text-align: center;" required></td>

                                    <td><input type="text" step="any" name="ov_gst_percent[]" value="{{gst}}"
                                            class="ov-gst-percent" oninput="calculateGST(this)"
                                            style="text-align: center;" required></td>

                                    <td><input type="text" step="any" name="ov_amount[]" class="ov-amount"
                                            oninput="calculateGST(this)" style="text-align: center;" required></td>


                                    <td><input type="text" step="any" name="ov_gst_value[]" class="ov-gst-value"
                                            oninput="calculateGST(this)" style="text-align: center;" required></td>

                                    <td><input type="text" step="any" name="ov_total[]" style="text-align: center;"
                                            class="ov-total" oninput="calculateGST(this)" required></td>
            
                                        <td>
                                            <button type="button" class="btn-delete" style="color: red; background: none; border: none; cursor: pointer;" onclick="ov_deleteRow(this)">
                                                <ion-icon name="trash" class="fa-solid fa-trash"></ion-icon>
                                            </button>
                                        </td>
                                    `;

                                    tableBody.appendChild(ov_newRow);
                                    ov_updateOverallTotal();
                                }

                            });


                            if (!selected) {
                                const ov_newRow = document.createElement('tr');
                                const ov_newRowCount = currentRowCount + 1;

                                ov_newRow.innerHTML = `
                                    <td style="width: 2%;">${ov_newRowCount}</td>
                                    <td style="display: none;">
                                        <input type="hidden" name="ov_row_index[]" value="${ov_newRowCount}">

                                    </td>
                                    <td><input type="checkbox" class="ov-row-check"></td>

                                    <td style="width: 8%;">
                                        <select name="ov_category_subcategory[]" style="padding: 5px; width: 100%;" required>
                                            <option value="">Select Category</option>

                                            <optgroup label="500 - Admin">
                                                <option value="500 - Admin-Pantry">Pantry</option>
                                                <option value="500 - Admin-PPE">PPE</option>
                                                <option value="500 - Admin-Food">Food</option>
                                                <option value="500 - Admin-Entertainment">Entertainment</option>
                                                <option value="500 - Admin-Travel">Travel</option>
                                                <option value="500 - Admin-Book Keeping">Book Keeping</option>
                                                <option value="500 - Admin-Accounts">Accounts</option>
                                                <option value="500 - Admin-Others">Others</option>
                                            </optgroup>

                                            <optgroup label="501 - Asset">
                                                <option value="501 - Asset-Computer">Computer</option>
                                                <option value="501 - Asset-Monitor">Monitor</option>
                                                <option value="501 - Asset-Printer">Printer</option>
                                                <option value="501 - Asset-Aircon">Aircon</option>
                                                <option value="501 - Asset-Tools">Tools</option>
                                                <option value="501 - Asset-Furniture">Furniture</option>
                                                <option value="501 - Asset-Equipment">Equipment</option>
                                                <option value="501 - Asset-Instrument">Instrument</option>
                                                <option value="501 - Asset-Refrigerator">Refrigerator</option>
                                            </optgroup>

                                            <optgroup label="502 - Property">
                                                <option value="502 - Property-Tax">Tax</option>
                                                <option value="502 - Property-Loan">Loan</option>
                                            </optgroup>

                                            <optgroup label="503 - Insurance">
                                                <option value="503 - Insurance-FWMI">FWMI</option>
                                                <option value="503 - Insurance-Public Liab">Public Liab</option>
                                                <option value="503 - Insurance-Bond">Bond</option>
                                                <option value="503 - Insurance-Permits">Permits</option>
                                                <option value="503 - Insurance-Medical">Medical</option>
                                            </optgroup>

                                            <optgroup label="504 - Subscription">
                                                <option value="504 - Subscription-MS Office">MS Office</option>
                                                <option value="504 - Subscription-MS Project">MS Project</option>
                                                <option value="504 - Subscription-Avetta">Avetta</option>
                                                <option value="504 - Subscription-Adobe">Adobe</option>
                                                <option value="504 - Subscription-Website">Website</option>
                                                <option value="504 - Subscription-Anydesk">Anydesk</option>
                                            </optgroup>

                                            <optgroup label="505 - Training">
                                                <option value="505 - Training-General">General</option>
                                            </optgroup>

                                            <optgroup label="506 - Medical">
                                                <option value="506 - Medical-Regular">Regular</option>
                                            </optgroup>



                                            <optgroup label="508 - Housing">
                                                <option value="508 - Housing-Rent">Rent</option>
                                                <option value="508 - Housing-Internet">Internet</option>
                                                <option value="508 - Housing-Phone">Phone</option>
                                                <option value="508 - Housing-SP Power">SP Power</option>
                                                <option value="508 - Housing-Gas">Gas</option>
                                                <option value="508 - Housing-Printer">Printer</option>
                                                <option value="508 - Housing-Others">Others</option>
                                            </optgroup>

                                            <optgroup label="509 - Certification">
                                                <option value="509 - Certification-ISO">ISO</option>
                                                <option value="509 - Certification-Calibration">Calibration</option>
                                                <option value="509 - Certification-Aspri">Aspri</option>
                                                <option value="509 - Certification-BCA">BCA</option>
                                                <option value="509 - Certification-Others">Others</option>
                                            </optgroup>
                                        </select>
                                    </td>


                                    <td><input type="date" name="ov_purchase_date[]" required></td>
                                    <td><input type="text" name="ov_Supplier_name[]" class="supplier-input" required></td>
                                    <td><input type="text" name="ov_item_name[]" class="item-name-input" required></td>
                                    <td><input type="text" name="ov_invoice_number[]"></td>
                                    <td><input type="text" name="ov_currency[]" value="SGD" required></td>
                                    <td><input type="text" step="any" name="ov_rate[]" value="1" style="text-align: center;" required></td>
                                    <td><input type="text" step="any" name="ov_gst_percent[]" value="{{gst}}"
                                            class="ov-gst-percent" oninput="calculateGST(this)"
                                            style="text-align: center;" required></td>

                                    <td><input type="text" step="any" name="ov_amount[]" class="ov-amount"
                                            oninput="calculateGST(this)" style="text-align: center;" required></td>


                                    <td><input type="text" step="any" name="ov_gst_value[]" class="ov-gst-value"
                                            oninput="calculateGST(this)" style="text-align: center;" required></td>

                                    <td><input type="text" step="any" name="ov_total[]" style="text-align: center;"
                                            class="ov-total" oninput="calculateGST(this)" required></td>


                                    <td>
                                        <button type="button" class="btn-delete" style="color: red; background: none; border: none; cursor: pointer;" onclick="ov_deleteRow(this)">
                                            <ion-icon name="trash" class="fa-solid fa-trash"></ion-icon>
                                        </button>
                                    </td>
                                `;

                                tableBody.appendChild(ov_newRow);
                            }
                        });
                    });

                    ov_updateOverallTotal();

                </script>

            </div>

            <div class="adduser" id="adduser" style="display: none;"> <!-- Vehicle-->

                <form class="p-3" id="ve_expenseForm" method="POST" enctype="multipart/form-data"
                    onsubmit="handlevechicleFormSubmit(event)">

                    <div class="table-responsive">

                        <table class="table" id="Vehicle_dynamicTable">

                            <thead>
                                <tr>
                                    <th style=" width: 2%; text-align: center;">S/N</th>
                                    <th style="width: 2%;"></th>
                                    <th style=" width: 8%;">Category</th>
                                    <th style=" width: 10%;">Vehicle NO</th>
                                    <th style=" width: 2%;">Date</th>
                                    <th style=" width: 23%;">Supplier Name</th>
                                    <th style=" width: 15%;">Invoice Number</th>
                                    <th style=" width: 6%;">Currency</th>
                                    <th style=" width: 5%;"> Rate</th>
                                    <th style=" width: 5%;">GST %</th>
                                    <th style=" width: 5%;">Amount</th>
                                    <th style=" width: 5%;">GST Value</th>
                                    <th style=" width: 5%;">Total</th>
                                    <th style=" width: 3%;">Del</th>
                                </tr>
                            </thead>

                            <tbody>

                                {% for i in range(3) %}
                                <tr>

                                    <td>{{i + 1}}</td>
                                    <td style="display: none;">
                                        <input type="hidden" name="ve_row_index[]" value="{{ i + 1 }}">
                                    </td>


                                    <td style="text-align: center;"><input type="checkbox" class="ve_row-check"
                                            style="text-align: center;"></td>

                                    <td>
                                        <select name="ve_category[]" style="padding: 5px; width: 100%;" required>
                                            <option value="">Select</option>
                                            <option value="Rent">Rent</option>
                                            <option value="Fuel">Fuel</option>
                                            <option value="Parking">Parking</option>
                                            <option value="Cashcard">Cashcard</option>
                                            <option value="Maint">Maintenance</option>
                                            <option value="Tax">Tax</option>
                                            <option value="Ins">Insurence</option>


                                        </select>
                                    </td>

                                    <td>
                                        <select name="ve_Vehicle_NO[]" style="padding: 5px; width: 100%;" required>
                                            <option value="">Select</option>
                                            {% for vehicle_number in vehicle_numbers %}
                                            <option value="{{ vehicle_number }}">{{ vehicle_number }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </td>

                                    <td><input type="date" name="ve_purchase_date[]" required></td>
                                    <td><input type="text" name="ve_Supplier_name[]" class="supplier-input" required>
                                    </td>
                                    <td><input type="text" name="ve_invoice_number[]"></td>
                                    <td><input type="text" name="ve_currency[]" value="SGD" style="text-align: center;"
                                            required></td>
                                    <td><input type="text" step="any" name="ve_rate[]" value="{{1}}"
                                            style="text-align: center;" required></td>
                                    <td><input type="text" step="any" name="ve_gst_percent[]" class="ve_gst_percent"
                                            value="{{gst}}" style="text-align: center;" oninput="calculateRow(this)"
                                            required></td>
                                    <td><input type="number" step="any" name="ve_amount[]" class="ve_amount"
                                            style="text-align: center;" oninput="calculateRow(this)" required></td>
                                    <td><input type="number" step="any" name="ve_gst_value[]" class="ve_gst_value"
                                            style="text-align: center;" oninput="calculateRow(this)" required></td>
                                    <td><input type="number" step="any" name="ve_total[]" class="ve_total"
                                            style="text-align: center;" oninput="calculateRow(this)" required></td>


                                    <td style="width: 3%">

                                        <button type="button" class="btn-delete"
                                            style="color: red; background: none;  border: none; cursor: pointer;"
                                            onclick="ve_deleteRow(this)">
                                            <ion-icon name="trash" class="fa-solid fa-trash"></ion-icon>
                                        </button>

                                    </td>

                                </tr>
                                {% endfor %}

                            </tbody>

                            <tfoot>
                                <tr>
                                    <td colspan="10" style="text-align: right; font-weight: bold; color: #FF5733;">
                                        Totals : </td>
                                    <td><input type="text" id="ve_footer_total_amount" value="0.00"
                                            style="text-align: center;" readonly></td>
                                    <td><input type="text" id="ve_footer_total_gst" value="0.00"
                                            style="text-align: center;" readonly></td>
                                    <td><input type="text" id="ve_footer_total_final" value="0.00"
                                            style="text-align: center;" readonly></td>
                                    <td><input type="hidden" name="ve_footer_total_amount"
                                            id="ve_footer_total_amount_hidden" value="0.00"></td>
                                    <td><input type="hidden" name="ve_footer_total_gst" id="ve_footer_total_gst_hidden"
                                            value="0.00"></td>
                                    <td><input type="hidden" name="ve_footer_total_final"
                                            id="ve_footer_total_final_hidden" value="0.00"></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </tfoot>

                        </table>

                    </div>

                    <div class="button-container1">

                        <div class='flex-item'>
                            <button class="new-enquiry-btn" id="VehicleaddRowButton">+</button>
                        </div>

                        <div class='flex-item' style="width: 50%;">
                            <input type="text" class="form-control" name="ve_comments"
                                placeholder="Enter your comments here.............." />
                        </div>

                        <div class='flex-item' style="display: none;">
                            <input type="text" class="form-control" name="existingvechlecalim" id="existingvechlecalim"
                                value="">
                        </div>

                        <div class='flex-item'>

                            <button type="submit" class="new-enquiry-btn" id="generateClaimButtonve">
                                Generate Claim
                            </button>

                        </div>

                    </div>

                </form>

                <script>

                    function vechilevalidateForm() {
                        let isValid = true;
                        let missingFields = [];

                        const rows = document.querySelectorAll('#Vehicle_dynamicTable tbody tr');

                        rows.forEach((row, index) => {
                            const rowNumber = index + 1;

                            const checks = [
                                { field: row.querySelector('select[name="ve_category[]"]'), name: "Category" },
                                { field: row.querySelector('select[name="ve_Vehicle_NO[]"]'), name: "Vehicle No" },
                                { field: row.querySelector('input[name="ve_purchase_date[]"]'), name: "Purchase Date" },
                                { field: row.querySelector('input[name="ve_Supplier_name[]"]'), name: "Supplier Name" },
                                { field: row.querySelector('input[name="ve_invoice_number[]"]'), name: "Invoice Number" },
                                { field: row.querySelector('input[name="ve_currency[]"]'), name: "Currency" },
                                { field: row.querySelector('input[name="ve_rate[]"]'), name: "Rate" },
                                { field: row.querySelector('input[name="ve_gst_percent[]"]'), name: "GST Percent" },
                                { field: row.querySelector('input[name="ve_amount[]"]'), name: "Amount" },
                                { field: row.querySelector('input[name="ve_gst_value[]"]'), name: "GST Value" },
                                { field: row.querySelector('input[name="ve_total[]"]'), name: "Total" },
                            ];

                            checks.forEach(check => {
                                const field = check.field;
                                if (!field || (check.type === "file" ? field.files.length === 0 : !field.value.trim())) {
                                    missingFields.push(`Row ${rowNumber}: ${check.name}`);
                                    isValid = false;
                                }
                            });
                        });

                        if (!isValid) {
                            alert("The following fields are missing or invalid:\n\n" + missingFields.join("\n"));
                        }

                        return isValid;
                    }

                    let isvechicleClaimSubmitting = false;

                    function handlevechicleFormSubmit(event) {
                        event.preventDefault();

                        if (isvechicleClaimSubmitting) return; // Prevent double submission
                        isvechicleClaimSubmitting = true;

                        const form = document.getElementById('ve_expenseForm');
                        const submitButton = form.querySelector('button[type="submit"]');
                        const veoriginalButtonText = submitButton.innerText;

                        submitButton.disabled = true;
                        submitButton.innerText = 'Generating Claim...';

                        // Run validation
                        if (!vechilevalidateForm()) {
                            submitButton.disabled = false;
                            submitButton.innerText = veoriginalButtonText;

                            isvechicleClaimSubmitting = false;

                            return;
                        }

                        const formData = new FormData(form);

                        fetch('/vechicle_claim', {
                            method: 'POST',
                            body: formData,
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.message) {
                                    alert(data.message);
                                    form.reset();

                                    const rows = document.querySelectorAll('#Vehicle_dynamicTable tbody tr');
                                    rows.forEach(row => {
                                        row.querySelectorAll('input').forEach(input => input.value = '');
                                        row.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
                                    });

                                    form.querySelectorAll('input[type="file"]').forEach(input => input.value = '');
                                } else {
                                    alert('Unexpected response. Please try again.');
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('An error occurred. Please try again.');
                            })
                            .finally(() => {
                                submitButton.disabled = false;
                                submitButton.innerText = veoriginalButtonText;
                                isvechicleClaimSubmitting = false;
                            });
                    }

                    function ve_deleteRow(button) {
                        const row = button.closest('tr');
                        row.remove();
                        veupdateRowIndices();
                        ve_updateOverallTotal(); // Recalculate the total sum after deletion
                    }

                    function veupdateRowIndices() {
                        var table = document.getElementById('Vehicle_dynamicTable').getElementsByTagName('tbody')[0];
                        for (var i = 0; i < table.rows.length; i++) {
                            table.rows[i].cells[0].innerHTML = i + 1;
                        }
                    }
                    function calculateRow(input) {
                        const row = input.closest('tr');
                        const amountField = row.querySelector('input[name="ve_amount[]"]');
                        const gstPercentField = row.querySelector('input[name="ve_gst_percent[]"]');
                        const gstValueField = row.querySelector('input[name="ve_gst_value[]"]');
                        const totalField = row.querySelector('input[name="ve_total[]"]');

                        let amount = parseFloat(amountField.value) || 0;
                        let gstPercent = gstPercentField.value.trim() === "" ? 9 : parseFloat(gstPercentField.value);
                        let gstValue = parseFloat(gstValueField.value) || 0;
                        let total = parseFloat(totalField.value) || 0;

                        if (input.name === 've_amount[]') {
                            gstValue = (amount * gstPercent) / 100;
                            gstValueField.value = gstValue.toFixed(2);
                            totalField.value = (amount + gstValue).toFixed(2);
                        } else if (input.name === 've_gst_percent[]') {
                            gstValue = (amount * gstPercent) / 100;
                            gstValueField.value = gstValue.toFixed(2);
                            totalField.value = (amount + gstValue).toFixed(2);
                        } else if (input.name === 've_gst_value[]') {
                            gstValue = parseFloat(input.value) || 0;
                            gstPercent = amount > 0 ? (gstValue / amount) * 100 : 0;
                            gstPercentField.value = gstPercent.toFixed(2);
                            totalField.value = (amount + gstValue).toFixed(2);
                        } else if (input.name === 've_total[]') {
                            total = parseFloat(input.value) || 0;
                            if (gstPercent > 0) {
                                amount = total / (1 + gstPercent / 100);
                                gstValue = total - amount;
                                amountField.value = amount.toFixed(2);
                                gstValueField.value = gstValue.toFixed(2);
                            } else {
                                gstValue = total - amount;
                                gstValueField.value = gstValue.toFixed(2);
                                gstPercentField.value = amount > 0 ? ((gstValue / amount) * 100).toFixed(2) : '0.00';
                            }
                        }

                        ve_updateOverallTotal();
                    }

                    function ve_updateOverallTotal() {

                        let ve_totalAmount = 0;
                        let ve_totalGst = 0;
                        let ve_totalFinal = 0;

                        const rows = document.querySelectorAll('#Vehicle_dynamicTable tbody tr');
                        rows.forEach(row => {
                            const ve_amount = parseFloat(row.querySelector('.ve_amount').value) || 0;
                            const ve_gstValue = parseFloat(row.querySelector('.ve_gst_value').value) || 0;
                            const ve_total = parseFloat(row.querySelector('.ve_total').value) || 0;

                            ve_totalAmount += ve_amount;
                            ve_totalGst += ve_gstValue;
                            ve_totalFinal += ve_total;
                        });

                        // Format numbers in international format (e.g., 1,234.56)
                        document.getElementById('ve_footer_total_amount').value = ve_totalAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        document.getElementById('ve_footer_total_gst').value = ve_totalGst.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        document.getElementById('ve_footer_total_final').value = ve_totalFinal.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                        document.getElementById('ve_footer_total_amount_hidden').value = ve_totalAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        document.getElementById('ve_footer_total_gst_hidden').value = ve_totalGst.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        document.getElementById('ve_footer_total_final_hidden').value = ve_totalFinal.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });



                    }

                    document.addEventListener('DOMContentLoaded', function () {
                        document.getElementById('VehicleaddRowButton').addEventListener('click', function (e) {
                            e.preventDefault();
                            const tableBody = document.querySelector('#Vehicle_dynamicTable tbody');
                            const selectedRows = tableBody.querySelectorAll('tr');
                            let currentRowCount = tableBody.rows.length;
                            let selected = false;

                            selectedRows.forEach((row, index) => {

                                const checkbox = row.querySelector('.ve_row-check');

                                if (checkbox && checkbox.checked) {
                                    selected = true;
                                    const ve_category = row.querySelector('select[name="ve_category[]"]').value;
                                    const ve_Vehicle_NO = row.querySelector('select[name="ve_Vehicle_NO[]"]').value;
                                    // console.log(".......ve_Vehicle_NOve_Vehicle_NO.........", ve_Vehicle_NO)
                                    const ve_purchase_date = row.querySelector('input[name="ve_purchase_date[]"]').value;
                                    const ve_supplier = row.querySelector('input[name="ve_Supplier_name[]"]').value;
                                    const ve_invoice_number = row.querySelector('input[name="ve_invoice_number[]"]').value;
                                    const ve_currency = row.querySelector('input[name="ve_currency[]"]').value;
                                    const ve_rate = row.querySelector('input[name="ve_rate[]"]').value;
                                    const ve_gst_percent = row.querySelector('input[name="ve_gst_percent[]"]').value;
                                    const ve_amount = row.querySelector('input[name="ve_amount[]"]').value;
                                    const ve_gst_value = row.querySelector('input[name="ve_gst_value[]"]').value;
                                    const ve_total = row.querySelector('input[name="ve_total[]"]').value;
                                    const ve_newRow = document.createElement('tr');
                                    const ve_newRowCount = ++currentRowCount;

                                    ve_newRow.innerHTML = `
                                        <td style="width: 2%;">${ve_newRowCount}</td>

                                        <td style="display: none;">
                                            <input type="hidden" name="ve_row_index[]" value="${ve_newRowCount}">

                                        </td>
                                        <td><input type="checkbox" class="ve_row-check"></td>

                                        <td>
                                            <select name="ve_category[]" style="padding: 5px; width: 100%;" required>
                                                <option value="">Select</option>
                                                <option value="Rent" ${ve_category === "Rent" ? "selected" : ""}>Rent</option>
                                                <option value="Fuel" ${ve_category === "Fuel" ? "selected" : ""}>Fuel</option>
                                                <option value="Parking" ${ve_category === "Parking" ? "selected" : ""}>Parking</option>
                                                <option value="Cashcard" ${ve_category === "Cashcard" ? "selected" : ""}>Cashcard</option>
                                                <option value="Maint" ${ve_category === "Maint" ? "selected" : ""}>Maintenance</option>
                                                <option value="Tax" ${ve_category === "Tax" ? "selected" : ""}>Tax</option>
                                                <option value="Ins" ${ve_category === "Ins" ? "selected" : ""}>Insurence</option>

                                            </select>
                                        </td>

                                        <td>
                                            <select name="ve_Vehicle_NO[]" style="padding: 5px; width: 100%;" required>
                                                <option value="">Select</option>
                                                {% for vehicle_number in vehicle_numbers %}
                                                <option value="{{ vehicle_number }}" ${ve_Vehicle_NO === "{{ vehicle_number }}" ? "selected" : ""} >
                                                    {{ vehicle_number }}
                                                </option>
                                                {% endfor %}
                                            </select>
                                        </td>

                                        <td><input type="date" name="ve_purchase_date[]" value="${ve_purchase_date}" required></td>
                                        <td><input type="text" name="ve_Supplier_name[]" value="${ve_supplier}" required></td>
                                        <td><input type="text" name="ve_invoice_number[]" ></td>
                                        <td><input type="text" name="ve_currency[]" value="${ve_currency}" style="text-align: center;" required></td>
                                        <td><input type="text" step="any" name="ve_rate[]" value="${ve_rate}" style="text-align: center;" required></td>
                                        <td><input type="text" step="any" name="ve_gst_percent[]" class="ve_gst_percent" value="{{gst}}" style="text-align: center;" oninput="calculateRow(this)" required></td>
                                        <td><input type="number" step="any" name="ve_amount[]" class="ve_amount"  style="text-align: center;" oninput="calculateRow(this)" required></td>
                                        <td><input type="number" step="any" name="ve_gst_value[]" class="ve_gst_value"  style="text-align: center;" oninput="calculateRow(this)" required></td>
                                        <td><input type="number" step="any" name="ve_total[]" class="ve_total"  style="text-align: center;" oninput="calculateRow(this)" required></td>
                                        

                                        <td>
                                            <button type="button" class="btn-delete" style="color: red; background: none; border: none; cursor: pointer;" onclick="pr_deleteRow(this)">
                                                <ion-icon name="trash" class="fa-solid fa-trash"></ion-icon>
                                            </button>
                                        </td>
                                     `;

                                    tableBody.appendChild(ve_newRow);
                                    ve_updateOverallTotal();
                                }

                            });


                            if (!selected) {
                                const ve_newRow = document.createElement('tr');
                                const ve_newRowCount = currentRowCount + 1;

                                ve_newRow.innerHTML = `
                                        <td style="width: 2%;">${ve_newRowCount}</td>

                                        <td style="display: none;">
                                            <input type="hidden" name="ve_row_index[]" value="${ve_newRowCount}">

                                        </td>
                                        <td><input type="checkbox" class="ve_row-check"></td>

                                        <td>
                                            <select name="ve_category[]" style="padding: 5px; width: 100%;" required>
                                                <option value="">Select</option>
                                                <option value="Rent" >Rent</option>
                                                <option value="Fuel" >Fuel</option>
                                                <option value="Parking" >Parking</option>
                                                <option value="Cashcard" >Cashcard</option>
                                                <option value="Maint">Maintenance</option>
                                                <option value="Tax">Tax</option>
                                                <option value="Ins">Insurence</option>
                                            </select>
                                        </td>

                                    <td>
                                        <select name="ve_Vehicle_NO[]" style="padding: 5px; width: 100%;" required>
                                            <option value="">Select</option>
                                            {% for vehicle_number in vehicle_numbers %}
                                            <option value="{{ vehicle_number }}">{{ vehicle_number }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </td>

                                    <td><input type="date" name="ve_purchase_date[]" required></td>
                                    <td><input type="text" name="ve_Supplier_name[]" class="supplier-input" required>
                                    </td>
                                    <td><input type="text" name="ve_invoice_number[]"></td>
                                    <td><input type="text" name="ve_currency[]" value="SGD" style="text-align: center;"
                                            required></td>
                                    <td><input type="text" step="any" name="ve_rate[]" value="{{1}}"
                                            style="text-align: center;" required></td>
                                    <td><input type="text" step="any" name="ve_gst_percent[]" class="ve_gst_percent" value="{{gst}}" style="text-align: center;" oninput="calculateRow(this)" required></td>
                                    <td><input type="number" step="any" name="ve_amount[]" class="ve_amount"  style="text-align: center;" oninput="calculateRow(this)" required></td>
                                    <td><input type="number" step="any" name="ve_gst_value[]" class="ve_gst_value"  style="text-align: center;" oninput="calculateRow(this)" required></td>
                                    <td><input type="number" step="any" name="ve_total[]" class="ve_total"  style="text-align: center;" oninput="calculateRow(this)" required></td>
                                    

                                    <td style="width: 3%">

                                        <button type="button" class="btn-delete"
                                            style="color: red; background: none;  border: none; cursor: pointer;"
                                            onclick="ve_deleteRow(this)">
                                            <ion-icon name="trash" class="fa-solid fa-trash"></ion-icon>
                                        </button>

                                    </td>
                                     `;

                                tableBody.appendChild(ve_newRow);
                            }
                        });
                    });


                </script>

            </div>

            <div class="PublicHoliday" id="PublicHoliday" style="display: none;"> <!-- total list -->

                <div class="search_container1">
                    <h3 style="color: #004274;">Claim's (<span id="requestCount">0</span>) </h3>

                    <span class="span_tag" style="margin-left: 10px;">Pending :
                        <span id="Pendingpay" style="color: brown;">0</span>
                    </span>

                    <span class="span_tag">Partial :
                        <span id="Partialpay" style="color: #007bff;">0</span>
                    </span>

                    <span class="span_tag">Approved :
                        <span id="Paidpay" style="color: #007bff;">0</span>
                    </span>

                    <input type="text" id="searchInput" placeholder="Search... ..." onkeyup="filterTable()">
                    <span class="span_tag">Amount : <span id="totalAmount">$ 0.00</span></span>
                    <span class="span_tag">GST : <span id="totalGST">$ 0.00</span></span>
                    <span class="span_tag">Total : <span id="overallTotal">$ 0.00</span></span>
                    <span class="span_tag">Balance : <span id="balanceTotal" style="color: orangered;">$
                            0.00</span></span>
                </div>

                <script>
                    function filterTable() {
                        let input = document.getElementById("searchInput").value.toLowerCase().trim();
                        let keywords = input.split(",").map(k => k.trim()).filter(k => k !== "");
                        let rows = document.querySelectorAll(".mainRow");

                        rows.forEach(row => {
                            let approved_date = row.querySelector(".approved_date") ? row.querySelector(".approved_date").textContent.trim().toLowerCase() : '';
                            let claim_id = row.querySelector(".claim_id") ? row.querySelector(".claim_id").textContent.trim().toLowerCase() : '';
                            let claim_type = row.querySelector(".claim_type") ? row.querySelector(".claim_type").textContent.trim().toLowerCase() : '';
                            let claim_by = row.querySelector(".claim_by") ? row.querySelector(".claim_by").textContent.trim().toLowerCase() : '';
                            let claim_date = row.querySelector(".claim_date") ? row.querySelector(".claim_date").textContent.trim().toLowerCase() : '';
                            let approved_by = row.querySelector(".approved_by") ? row.querySelector(".approved_by").textContent.trim().toLowerCase() : '';
                            let status = row.querySelector(".status") ? row.querySelector(".status").textContent.trim().toLowerCase() : '';

                            // Combine all searchable fields
                            let combinedText = [
                                approved_date,
                                claim_id,
                                claim_type,
                                claim_by,
                                claim_date,
                                approved_by,
                                status
                            ].join(" ");

                            // Check if all keywords are present
                            let isMatch = keywords.every(keyword => combinedText.includes(keyword));

                            row.style.display = isMatch ? "" : "none";
                        });

                        updateTotals();        // Update filtered totals
                        updateStatusCounts();  // Update filtered status counts
                    }


                    function updateTotals() {
                        let requestCount = 0;
                        let totalAmount = 0;
                        let totalGST = 0;
                        let totalSum = 0;
                        let balamceSum = 0;
                        const rows = document.querySelectorAll("#projectTable tbody tr.mainRow");
                        rows.forEach(row => {
                            if (row.style.display !== "none") {
                                requestCount++;
                                let amount = parseFloat(row.querySelector(".amount-col")?.textContent.replace(/[^0-9.-]+/g, '') || 0);
                                let gstValue = parseFloat(row.querySelector(".gst-col")?.textContent.replace(/[^0-9.-]+/g, '') || 0);
                                let total = parseFloat(row.querySelector(".total-col")?.textContent.replace(/[^0-9.-]+/g, '') || 0);
                                let balamce = parseFloat(row.querySelector(".balamceSum")?.textContent.replace(/[^0-9.-]+/g, '') || 0);
                                totalAmount += amount;
                                totalGST += gstValue;
                                totalSum += total;
                                balamceSum += balamce;
                            }
                        });

                        let formattedAmount = totalAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        let formattedGST = totalGST.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        let formattedTotal = totalSum.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        let formattedbalance = balamceSum.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                        document.getElementById("requestCount").textContent = requestCount;
                        document.getElementById("totalAmount").textContent = "$ " + formattedAmount;
                        document.getElementById("totalGST").textContent = "$ " + formattedGST;
                        document.getElementById("overallTotal").textContent = "$ " + formattedTotal;
                        document.getElementById("balanceTotal").textContent = "$ " + formattedbalance;
                    }

                    function updateStatusCounts() {
                        let pendingCount = 0;
                        let partialCount = 0;
                        let paidCount = 0;

                        const rows = document.querySelectorAll("#projectTable tbody tr.mainRow");

                        rows.forEach(row => {
                            if (row.style.display !== "none") {
                                let status = row.querySelector(".status")?.textContent.trim().toLowerCase();

                                if (status === "pending") {
                                    pendingCount++;
                                } else if (status === "partial") {
                                    partialCount++;
                                } else if (status === "paid") {
                                    paidCount++;
                                }
                            }
                        });

                        // Format the totals without decimals
                        let formattedPending = pendingCount.toLocaleString('en-US', { maximumFractionDigits: 0 });
                        let formattedPartial = partialCount.toLocaleString('en-US', { maximumFractionDigits: 0 });

                        let formattedPaid = paidCount.toLocaleString('en-US', { maximumFractionDigits: 0 });

                        // Update the correct spans
                        document.getElementById("Pendingpay").textContent = formattedPending;
                        document.getElementById("Partialpay").textContent = formattedPartial;
                        document.getElementById("Paidpay").textContent = formattedPaid;
                    }

                    // Call the function when the page loads
                    document.addEventListener("DOMContentLoaded", () => {
                        updateTotals();
                        updateStatusCounts();
                    });

                </script>

                <style>
                    .span_tag {
                        font-size: 14px;
                        font-weight: bold;
                        color: #004b5d;
                        padding: 5px 8px;
                        border: 1px solid #004b5d;
                        border-radius: 5px;
                        background-color: #f1f8ff;
                        color: #004b5d;
                        text-align: center;
                        margin-right: 10px;
                    }

                    #totalAmount {
                        color: #28a745;
                        /* Green for amount */
                    }

                    #totalGST {
                        color: #0c8de2;
                        /* Yellow for GST */
                    }

                    #overallTotal {
                        color: #dc3545;
                        /* Red for overall total */
                    }

                    .search_container1 {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        width: 100%;
                        padding: 10px;
                    }


                    #projectTable {
                        width: 100%;
                        border-collapse: separate;
                        border-spacing: 0;
                        border-radius: 10px;
                    }


                    #searchInput {
                        width: 30%;
                        padding: 2px;
                        margin: auto;
                        display: block;
                        border: 2px solid #ccc;
                        border-radius: 5px;
                        /* Rounded corners */
                        outline: none;
                        transition: all 0.3s ease-in-out;
                        text-align: center;
                        font-size: 16px;
                    }

                    #searchInput:hover {
                        background-color: #f0f0f0;
                    }

                    #searchInput:focus {
                        border-color: #004b5d;
                        box-shadow: 0 0 8px rgba(0, 123, 255, 0.5);
                    }
                </style>

                <div class="table-responsive" style="background-color: white;">

                    <table class="table table-main" width="100%" id="projectTable">

                        <thead>
                            <tr>
                                <th style="text-align: center;">View</th>
                                <th style="text-align: left;">Claim ID</th>
                                <th style="text-align: left;">Type</th>
                                <th style="text-align: left;">Claim By</th>
                                <th style="text-align: center;">Claim Date</th>
                                <th style="text-align: center;">Approved By</th>
                                <th style="text-align: center;">Paid On</th>
                                <th style="text-align: center;">Comments</th>
                                <th style="text-align: right;">Amount ($)</th>
                                <th style="text-align: right;">GST ($)</th>
                                <th style="text-align: right;">Total ($)</th>
                                <th style="text-align: right;">Balance ($)</th>
                                <th style="text-align: center;">Status</th>
                                <th style="text-align: center;">Edit</th>
                                <th style="text-align: center;">Print</th>

                            </tr>
                        </thead>

                        <tbody>
                            {% for claim in claims_data %}
                            <tr class="mainRow">

                                <td style="text-align: center;" class=" view-col">
                                    <span class="icon" onclick="openPaymentDetails('{{ claim.claim_id }}')"
                                        style="cursor: pointer;">
                                        <span class="fa-solid fa-eye"
                                            style="font-size: 1.25em; color: orangered;"></span>
                                    </span>
                                </td>

                                <td style="text-align: left; padding-left: 10px;" class="claim_id">
                                    {% if claim.claim_id.startswith('P') %}
                                    <span style="color: blueviolet; font-weight: bold;">{{ claim.claim_id }}</span>
                                    {% elif claim.claim_id.startswith('O') %}
                                    <span style="color: green; font-weight: bold;">{{ claim.claim_id }}</span>
                                    {% elif claim.claim_id.startswith('V') %}
                                    <span style="color: brown; font-weight: bold;">{{ claim.claim_id }}</span>
                                    {% else %}
                                    <span>{{ claim.claim_id }}</span> <!-- Default color for other claim IDs -->
                                    {% endif %}
                                </td>

                                <td style="text-align: left; padding-left: 10px;" class="claim_type">{{
                                    claim.claim_type }}
                                </td>
                                <td style="text-align: left; padding-left: 10px;" class="claim_by">{{ claim.claim_by }}
                                </td>
                                <td style="text-align: center;" class="start-time claim_date">{{ claim.claim_date }}
                                </td>
                                <td style="text-align: center;" class="approved_by">{{ claim.approved_by if
                                    claim.approved_by is
                                    not none else '' }}
                                </td>
                                <td style="text-align: center;" class="start-time approved_date"> {{ claim.approved_date
                                    if
                                    claim.approved_date is not none else '' }} </td>

                                <td style="text-align: left; padding-left: 10px;">
                                    {{ claim.comments[:20] + '...' if claim.comments and claim.comments|length > 20 else
                                    claim.comments or '' }}
                                </td>

                                <td class="amount-col" style="text-align: right; padding-right: 10px;">
                                    {{ "{:,.2f}".format(claim.amount|replace(',', '')|float) if claim.amount else "0.00"
                                    }}
                                </td>

                                <td class="gst-col" style="text-align: right; padding-right: 10px;">
                                    {{ "{:,.2f}".format(claim.gst_value|replace(',', '')|float) if claim.gst_value else
                                    "0.00" }}
                                </td>

                                <td class="total-col" style="text-align: right; padding-right: 10px;">
                                    {{ "{:,.2f}".format(claim.claim_Total|replace(',', '')|float) if claim.claim_Total
                                    else "0.00" }}
                                </td>

                                <td class="balamceSum" style="text-align: right; padding-right: 10px;">
                                    {{ "{:,.2f}".format(claim.balance|replace(',', '')|float) if claim.balance else
                                    "0.00" }}
                                </td>


                                <td class="status" style="font-weight: bold; text-align: center;">
                                    <span style="color: 
                                     {% if claim.status == 'Pending' %}
                                         brown;
                                     {% elif claim.status == 'Partial' %}
                                         blue;
                                     {% elif claim.status == 'Paid' %}
                                         green;
                                     {% elif claim.status == 'Canceled' %}
                                         red;
                                     {% endif %};
                                     background-color: 
                                     {% if claim.status == 'Pending' %}
                                         #f2e1d7; /* Light brown background */
                                     {% elif claim.status == 'Partial' %}
                                         #a4acee; /* Light orange background */
                                     {% elif claim.status == 'Paid' %}
                                         #d0f8e3; /* Light green background */
                                     {% elif claim.status == 'Canceled' %}
                                         #f8d7da; /* Light red background */
                                     {% endif %};
                                     padding: 2px 8px; 
                                     border-radius: 8px; 
                                     display: inline-block; /* Ensures the span takes up only as much space as needed */
                                 ">
                                        {{ claim.status }}
                                    </span>
                                </td>

                                {% if claim.status == 'Pending' %}
                                <td class="text-center">
                                    <a href="#" onclick="editClaim('{{ claim.claim_id }}'); return false;">
                                        <span class="icon">
                                            <span class="fa-solid fa-pen-to-square fa-fade"></span>
                                        </span>
                                    </a>

                                </td>
                                {% else %}

                                <td></td>

                                {% endif %}

                                <td class="text-center delete-col">
                                    <form method="POST" action="{{ url_for('print_claim', claim_id=claim.claim_id) }}">
                                        <button type="submit" class="btn"
                                            style="background-color: transparent; border: none; cursor: pointer;">
                                            <ion-icon name="print"
                                                style="color: rgb(21, 33, 37); font-size: 1.5em;"></ion-icon>
                                        </button>
                                    </form>
                                </td>

                            </tr>
                            {% endfor %}
                        </tbody>

                    </table>

                </div>

                <script>
                    const allProjects = {{ projects | tojson | safe }};
                    const vehicle_numbers = {{ vehicle_numbers | tojson | safe }};
                    function editClaim(claimId) {


                        fetch(`/get_claim_to_edit/${claimId}`)
                            .then(response => response.json())
                            .then(data => {

                                if (claimId.startsWith('P')) {
                                    document.getElementById('subContractRadio').checked = true;
                                    showSection('Sub_contract');
                                    toggleContainer('Sub_contract');

                                    const tbody = document.querySelector('#project_dynamicTable tbody');
                                    tbody.innerHTML = '';  // Clear existing rows


                                    document.getElementById('existingprjcalim').value = data.claim_id;
                                    document.getElementById('generateClaimButton').textContent = "Update Claim";



                                    data.items.forEach((item, index) => {
                                        const row = document.createElement('tr');
                                        row.innerHTML = `
                                            <td>${index + 1}</td>
                                            <td style="display:none;">
                                                <input type="hidden" name="row_index[]" value="${index + 1}">
                                            </td>
                                            <td style="text-align: center;">
                                                <input type="checkbox" class="row-check" style="text-align: center;">
                                            </td>
                                            <td>
                                                <select name="project_id[]" class="project_filed" style="width: 100%; padding: 5px;" required>
                                                    <option value="">Proj ID</option>
                                                    ${allProjects.map(project => {
                                            const isSelected = project[0] === item.projectid ? 'selected' : '';
                                            return `<option value="${project[0]}" ${isSelected}>${project[0]} - ${project[1]}</option>`;
                                        }).join('')}
                                                </select>
                                            </td>

                                            <td style="width: 8%;">
                                                <select name="category_subcategory[]" style="padding: 5px; width: 100%;" required>
                                                    <option value="">Select Category</option>
                                                    <option value="2001" ${item.Category_code == '2001' ? 'selected' : ''}>Mechanical</option>
                                                    <option value="2002" ${item.Category_code == '2002' ? 'selected' : ''}>Electrical</option>
                                                    <option value="2003" ${item.Category_code == '2003' ? 'selected' : ''}>Instruments</option>
                                                    <option value="2004" ${item.Category_code == '2004' ? 'selected' : ''}>PLC, Software, Hardware</option>
                                                    <option value="2005" ${item.Category_code == '2005' ? 'selected' : ''}>Panel Hardware</option>
                                                    <option value="2006" ${item.Category_code == '2006' ? 'selected' : ''}>Consumables</option>
                                                    <option value="2007" ${item.Category_code == '2007' ? 'selected' : ''}>Tools</option>
                                                    <option value="2008" ${item.Category_code == '2008' ? 'selected' : ''}>Civil</option>
                                                    <option value="2009" ${item.Category_code == '2009' ? 'selected' : ''}>Computer</option>
                                                </select>
                                            </td>

                                            
                                            <td><input type="date" name="purcahse_date[]" value="${item.date}" required></td>
                                            <td><input type="text" name="Supplier_name[]" value="${item.vendor}" required></td>
                                            <td><input type="text" name="item_name[]" value="${item.itemname}" required></td>
                                            <td><input type="text" name="invoice_number[]" value="${item.invoice_number}" required></td>
                                            <td><input type="text" name="currency[]" value="${item.Currency}" style="text-align: center;" required></td>
                                            <td><input type="number" step="any" name="rate[]" value="${item.Rate}" style="text-align: center;" required></td>
                                            <td><input type="number" step="any" name="gst_percent[]" class="gst_percent" value="${item.gst_percent}" style="text-align: center;" oninput="pr_calculateRow(this)" required></td>
                                            <td><input type="number" step="any" name="amount[]" class="amount" value="${item.amount}" style="text-align: center;" oninput="pr_calculateRow(this)" required></td>
                                            <td><input type="number" step="any" name="gst_value[]" class="gst_value" value="${item.gst_value}" style="text-align: center;" oninput="pr_calculateRow(this)" required></td>
                                            <td><input type="number" step="any" name="total[]" class="total" value="${item.total}" style="text-align: center;" oninput="pr_calculateRow(this)" required></td>

               
                                            <td>
                                                <button type="button" class="btn-delete" onclick="pr_deleteRow(this)" style="color: red; background: none; border: none; cursor: pointer;">
                                                    <ion-icon name="trash" class="fa-solid fa-trash"></ion-icon>
                                                </button>
                                            </td>
                                        `;
                                        tbody.appendChild(row);
                                    });

                                    pr_updateTotalSum();





                                } else if (claimId.startsWith('O')) {
                                    document.getElementById('addprojectRadio').checked = true;
                                    showSection('addproject');
                                    toggleContainer('addproject');


                                    document.getElementById('existingovercalim').value = data.claim_id;
                                    document.getElementById('generateClaimButtonover').textContent = "Update Claim";

                                    const tbody = document.querySelector('#overhead_dynamicTable tbody');
                                    tbody.innerHTML = '';  // Clear existing rows

                                    data.items.forEach((item, index) => {
                                        const row = document.createElement('tr');
                                        row.innerHTML = `
                                            <td>${index + 1}</td>
                                            <td style="display:none;">
                                                <input type="hidden" name="ov_row_index[]" value="${index + 1}">
                                            </td>
                                            <td style="text-align: center;">
                                                <input type="checkbox" class="ov-row-check" style="text-align: center;">
                                            </td>


                                            <td style="width: 8%;">
                                                <select name="ov_category_subcategory[]" style="padding: 5px; width: 100%;" required>
                                                    <option value="">Select Category</option>

                                                    <optgroup label="500 - Admin">
                                                        <option value="500 - Admin-Pantry" ${(item.Category_code + ' - ' + item.Category) === '500 - Admin-Pantry' ? 'selected' : ''}>Pantry</option>
                                                        <option value="500 - Admin-PPE" ${(item.Category_code + ' - ' + item.Category) === '500 - Admin-PPE' ? 'selected' : ''}>PPE</option>
                                                        <option value="500 - Admin-Food" ${(item.Category_code + ' - ' + item.Category) === '500 - Admin-Food' ? 'selected' : ''}>Food</option>
                                                        <option value="500 - Admin-Entertainment" ${(item.Category_code + ' - ' + item.Category) === '500 - Admin-Entertainment' ? 'selected' : ''}>Entertainment</option>
                                                        <option value="500 - Admin-Travel" ${(item.Category_code + ' - ' + item.Category) === '500 - Admin-Travel' ? 'selected' : ''}>Travel</option>
                                                        <option value="500 - Admin-Book Keeping" ${(item.Category_code + ' - ' + item.Category) === '500 - Admin-Book Keeping' ? 'selected' : ''}>Book Keeping</option>
                                                        <option value="500 - Admin-Accounts" ${(item.Category_code + ' - ' + item.Category) === '500 - Admin-Accounts' ? 'selected' : ''}>Accounts</option>
                                                        <option value="500 - Admin-Others" ${(item.Category_code + ' - ' + item.Category) === '500 - Admin-Others' ? 'selected' : ''}>Others</option>
                                                    </optgroup>

                                                    <optgroup label="501 - Asset">
                                                        <option value="501 - Asset-Computer" ${(item.Category_code + ' - ' + item.Category) === '501 - Asset-Computer' ? 'selected' : ''}>Computer</option>
                                                        <option value="501 - Asset-Monitor" ${(item.Category_code + ' - ' + item.Category) === '501 - Asset-Monitor' ? 'selected' : ''}>Monitor</option>
                                                        <option value="501 - Asset-Printer" ${(item.Category_code + ' - ' + item.Category) === '501 - Asset-Printer' ? 'selected' : ''}>Printer</option>
                                                        <option value="501 - Asset-Aircon" ${(item.Category_code + ' - ' + item.Category) === '501 - Asset-Aircon' ? 'selected' : ''}>Aircon</option>
                                                        <option value="501 - Asset-Tools" ${(item.Category_code + ' - ' + item.Category) === '501 - Asset-Tools' ? 'selected' : ''}>Tools</option>
                                                        <option value="501 - Asset-Furniture" ${(item.Category_code + ' - ' + item.Category) === '501 - Asset-Furniture' ? 'selected' : ''}>Furniture</option>
                                                        <option value="501 - Asset-Equipment" ${(item.Category_code + ' - ' + item.Category) === '501 - Asset-Equipment' ? 'selected' : ''}>Equipment</option>
                                                        <option value="501 - Asset-Instrument" ${(item.Category_code + ' - ' + item.Category) === '501 - Asset-Instrument' ? 'selected' : ''}>Instrument</option>
                                                        <option value="501 - Asset-Refrigerator" ${(item.Category_code + ' - ' + item.Category) === '501 - Asset-Refrigerator' ? 'selected' : ''}>Refrigerator</option>
                                                    </optgroup>

                                                    <optgroup label="502 - Property">
                                                        <option value="502 - Property-Tax" ${(item.Category_code + ' - ' + item.Category) === '502 - Property-Tax' ? 'selected' : ''}>Tax</option>
                                                        <option value="502 - Property-Loan" ${(item.Category_code + ' - ' + item.Category) === '502 - Property-Loan' ? 'selected' : ''}>Loan</option>
                                                    </optgroup>

                                                    <optgroup label="503 - Insurance">
                                                        <option value="503 - Insurance-FWMI" ${(item.Category_code + ' - ' + item.Category) === '503 - Insurance-FWMI' ? 'selected' : ''}>FWMI</option>
                                                        <option value="503 - Insurance-Public Liab" ${(item.Category_code + ' - ' + item.Category) === '503 - Insurance-Public Liab' ? 'selected' : ''}>Public Liab</option>
                                                        <option value="503 - Insurance-Bond" ${(item.Category_code + ' - ' + item.Category) === '503 - Insurance-Bond' ? 'selected' : ''}>Bond</option>
                                                        <option value="503 - Insurance-Permits" ${(item.Category_code + ' - ' + item.Category) === '503 - Insurance-Permits' ? 'selected' : ''}>Permits</option>
                                                        <option value="503 - Insurance-Medical" ${(item.Category_code + ' - ' + item.Category) === '503 - Insurance-Medical' ? 'selected' : ''}>Medical</option>
                                                    </optgroup>

                                                    <optgroup label="504 - Subscription">
                                                        <option value="504 - Subscription-MS Office" ${(item.Category_code + ' - ' + item.Category) === '504 - Subscription-MS Office' ? 'selected' : ''}>MS Office</option>
                                                        <option value="504 - Subscription-MS Project" ${(item.Category_code + ' - ' + item.Category) === '504 - Subscription-MS Project' ? 'selected' : ''}>MS Project</option>
                                                        <option value="504 - Subscription-Avetta" ${(item.Category_code + ' - ' + item.Category) === '504 - Subscription-Avetta' ? 'selected' : ''}>Avetta</option>
                                                        <option value="504 - Subscription-Adobe" ${(item.Category_code + ' - ' + item.Category) === '504 - Subscription-Adobe' ? 'selected' : ''}>Adobe</option>
                                                        <option value="504 - Subscription-Website" ${(item.Category_code + ' - ' + item.Category) === '504 - Subscription-Website' ? 'selected' : ''}>Website</option>
                                                        <option value="504 - Subscription-Anydesk" ${(item.Category_code + ' - ' + item.Category) === '504 - Subscription-Anydesk' ? 'selected' : ''}>Anydesk</option>
                                                    </optgroup>

                                                    <optgroup label="505 - Training">
                                                        <option value="505 - Training-General" ${(item.Category_code + ' - ' + item.Category) === '505 - Training-General' ? 'selected' : ''}>General</option>
                                                    </optgroup>

                                                    <optgroup label="506 - Medical">
                                                        <option value="506 - Medical-Regular" ${(item.Category_code + ' - ' + item.Category) === '506 - Medical-Regular' ? 'selected' : ''}>Regular</option>
                                                    </optgroup>

                                                    <optgroup label="507 - Vehicle">
                                                        <option value="507 - Vehicle-Rent" ${(item.Category_code + ' - ' + item.Category) === '507 - Vehicle-Rent' ? 'selected' : ''}>Rent</option>
                                                        <option value="507 - Vehicle-Fuel" ${(item.Category_code + ' - ' + item.Category) === '507 - Vehicle-Fuel' ? 'selected' : ''}>Fuel</option>
                                                        <option value="507 - Vehicle-Parking" ${(item.Category_code + ' - ' + item.Category) === '507 - Vehicle-Parking' ? 'selected' : ''}>Parking</option>
                                                        <option value="507 - Vehicle-Cashcard" ${(item.Category_code + ' - ' + item.Category) === '507 - Vehicle-Cashcard' ? 'selected' : ''}>Cashcard</option>
                                                        <option value="507 - Vehicle-Tax" ${(item.Category_code + ' - ' + item.Category) === '507 - Vehicle-Tax' ? 'selected' : ''}>Tax</option>
                                                        <option value="507 - Vehicle-Maint" ${(item.Category_code + ' - ' + item.Category) === '507 - Vehicle-Maint' ? 'selected' : ''}>Maint</option>
                                                        <option value="507 - Vehicle-Ins" ${(item.Category_code + ' - ' + item.Category) === '507 - Vehicle-Ins' ? 'selected' : ''}>Ins</option>
                                                    </optgroup>

                                                    <optgroup label="508 - Housing">
                                                        <option value="508 - Housing-Rent" ${(item.Category_code + ' - ' + item.Category) === '508 - Housing-Rent' ? 'selected' : ''}>Rent</option>
                                                        <option value="508 - Housing-Internet" ${(item.Category_code + ' - ' + item.Category) === '508 - Housing-Internet' ? 'selected' : ''}>Internet</option>
                                                        <option value="508 - Housing-Phone" ${(item.Category_code + ' - ' + item.Category) === '508 - Housing-Phone' ? 'selected' : ''}>Phone</option>
                                                        <option value="508 - Housing-SP Power" ${(item.Category_code + ' - ' + item.Category) === '508 - Housing-SP Power' ? 'selected' : ''}>SP Power</option>
                                                        <option value="508 - Housing-Gas" ${(item.Category_code + ' - ' + item.Category) === '508 - Housing-Gas' ? 'selected' : ''}>Gas</option>
                                                        <option value="508 - Housing-Printer" ${(item.Category_code + ' - ' + item.Category) === '508 - Housing-Printer' ? 'selected' : ''}>Printer</option>
                                                        <option value="508 - Housing-Others" ${(item.Category_code + ' - ' + item.Category) === '508 - Housing-Others' ? 'selected' : ''}>Others</option>
                                                    </optgroup>

                                                    <optgroup label="509 - Certification">
                                                        <option value="509 - Certification-ISO" ${(item.Category_code + ' - ' + item.Category) === '509 - Certification-ISO' ? 'selected' : ''}>ISO</option>
                                                        <option value="509 - Certification-Calibration" ${(item.Category_code + ' - ' + item.Category) === '509 - Certification-Calibration' ? 'selected' : ''}>Calibration</option>
                                                        <option value="509 - Certification-Aspri" ${(item.Category_code + ' - ' + item.Category) === '509 - Certification-Aspri' ? 'selected' : ''}>Aspri</option>
                                                        <option value="509 - Certification-BCA" ${(item.Category_code + ' - ' + item.Category) === '509 - Certification-BCA' ? 'selected' : ''}>BCA</option>
                                                        <option value="509 - Certification-Others" ${(item.Category_code + ' - ' + item.Category) === '509 - Certification-Others' ? 'selected' : ''}>Others</option>
                                                    </optgroup>
                                                </select>
                                            </td>

                                    
                                            <td><input type="date" name="ov_purchase_date[]" value="${item.date}" required></td>
                                            <td><input type="text" name="ov_Supplier_name[]" value="${item.vendor}" required></td>
                                            <td><input type="text" name="ov_item_name[]" value="${item.itemname}" required></td>
                                            <td><input type="text" name="ov_invoice_number[]" value="${item.invoice_number}" required></td>
                                            <td><input type="text" name="ov_currency[]" value="${item.Currency}" style="text-align: center;" required></td>
                                            <td><input type="number" step="any" name="ov_rate[]" value="${item.Rate}" style="text-align: center;" required></td>
                                            <td><input type="number" step="any" name="ov_gst_percent[]" class="ov-gst-percent" value="${item.gst_percent}" style="text-align: center;" oninput="calculateGST(this)" required></td>
                                            <td><input type="number" step="any" name="ov_amount[]" class="ov-amount" value="${item.amount}" style="text-align: center;" oninput="calculateGST(this)" required></td>
                                            <td><input type="number" step="any" name="ov_gst_value[]"class="ov-gst-value" value="${item.gst_value}" style="text-align: center;" oninput="calculateGST(this)" required></td>
                                            <td><input type="number" step="any" name="ov_total[]" class="ov-total" value="${item.total}" style="text-align: center;" oninput="calculateGST(this)" required></td>

         
                                            <td>
                                                <button type="button" class="btn-delete" onclick="ov_deleteRow(this)" style="color: red; background: none; border: none; cursor: pointer;">
                                                    <ion-icon name="trash" class="fa-solid fa-trash"></ion-icon>
                                                </button>
                                            </td>
                                        `;
                                        tbody.appendChild(row);
                                    });

                                    ov_updateOverallTotal();



                                } else if (claimId.startsWith('V')) {
                                    document.getElementById('adduserRadio').checked = true;
                                    showSection('adduser');
                                    toggleContainer('adduser');



                                    document.getElementById('existingvechlecalim').value = data.claim_id;
                                    document.getElementById('generateClaimButtonve').textContent = "Update Claim";

                                    const tbody = document.querySelector('#Vehicle_dynamicTable tbody');
                                    tbody.innerHTML = '';  // Clear existing rows



                                    data.items.forEach((item, index) => {
                                        const row = document.createElement('tr');
                                        row.innerHTML = `
                                            <td>${index + 1}</td>
                                            <td style="display:none;">
                                                <input type="hidden" name="ve_row_index[]" value="${index + 1}">
                                            </td>
                                            <td style="text-align: center;">
                                                <input type="checkbox" class="ve_row-check" style="text-align: center;">
                                            </td>
         

                                            <td>
                                                <select name="ve_category[]" style="padding: 5px; width: 100%;" required>
                                                    <option value="">Select</option>
                                                    <option value="Rent" ${(item.Category_code + '-' + item.Category) === 'Rent' ? 'selected' : ''}>Rent</option>
                                                    <option value="Fuel" ${(item.Category_code + '-' + item.Category) === 'Fuel' ? 'selected' : ''}>Fuel</option>
                                                    <option value="Parking" ${(item.Category_code + '-' + item.Category) === 'Parking' ? 'selected' : ''}>Parking</option>
                                                    <option value="Cashcard" ${(item.Category_code + '-' + item.Category) === 'Cashcard' ? 'selected' : ''}>Cashcard</option>
                                                    <option value="Maint" ${(item.Category_code + '-' + item.Category) === 'Maint' ? 'selected' : ''}>Maintenance</option>
                                                    <option value="Tax" ${(item.Category_code + '-' + item.Category) === 'Tax' ? 'selected' : ''}>Tax</option>
                                                    <option value="Ins" ${(item.Category_code + '-' + item.Category) === 'Ins' ? 'selected' : ''}>Insurence</option>
                                                </select>
                                            </td>


                                            <td>
                                                <select name="ve_Vehicle_NO[]" class="project_filed" style="width: 100%; padding: 5px;" required>
                                                    <option value="">Proj ID</option>
                                                ${vehicle_numbers.map(vehicle_number => {
                                            const isSelected = vehicle_number.trim().toLowerCase() === item.itemname.trim().toLowerCase() ? 'selected' : '';
                                            return `<option value="${vehicle_number}" ${isSelected}>${vehicle_number}</option>`;
                                        }).join('')}

                                                </select>
                                            </td>
                                            
                                            <td><input type="date" name="ve_purchase_date[]" value="${item.date}" required></td>
                                            <td><input type="text" name="ve_Supplier_name[]" value="${item.vendor}" required></td>
                                            <td><input type="text" name="ve_invoice_number[]" value="${item.invoice_number}" required></td>
                                            <td><input type="text" name="ve_currency[]" value="${item.Currency}" style="text-align: center;" required></td>
                                            <td><input type="number" step="any" name="ve_rate[]" value="${item.Rate}" style="text-align: center;" required></td>
                                            <td><input type="number" step="any" name="ve_gst_percent[]" class="ve_gst_percent" value="${item.gst_percent}" style="text-align: center;" oninput="calculateRow(this)" required></td>
                                            <td><input type="number" step="any" name="ve_amount[]" class="ve_amount" value="${item.amount}" style="text-align: center;" oninput="calculateRow(this)" required></td>
                                            <td><input type="number" step="any" name="ve_gst_value[]" class="ve_gst_value" value="${item.gst_value}" style="text-align: center;" oninput="calculateRow(this)" required></td>
                                            <td><input type="number" step="any" name="ve_total[]" class="ve_total" value="${item.total}" style="text-align: center;" oninput="calculateRow(this)" required></td>
                                            <td>
                                                <button type="button" class="btn-delete" onclick="ve_deleteRow(this)" style="color: red; background: none; border: none; cursor: pointer;">
                                                    <ion-icon name="trash" class="fa-solid fa-trash"></ion-icon>
                                                </button>
                                            </td>
                                        `;
                                        tbody.appendChild(row);
                                    });

                                    ve_updateOverallTotal();

                                }



                            })
                            .catch(error => {
                                console.error('Error fetching claim data:', error);
                            });
                    }
                </script>

            </div>

            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    // Function to format a date as DD/MM/YY
                    function formatDateAsDDMMYY(dateString) {
                        const options = { day: '2-digit', month: '2-digit', year: '2-digit' };
                        const date = new Date(dateString);
                        if (isNaN(date.getTime())) {
                            // console.error('Invalid date string:', dateString);
                            return dateString; // Return original if date is invalid
                        }
                        return date.toLocaleDateString('en-GB', options);
                    }

                    // Format date elements
                    const start_time_elements = document.querySelectorAll(".start-time");
                    start_time_elements.forEach(function (element) {
                        if (element.textContent.trim()) {
                            element.textContent = formatDateAsDDMMYY(element.textContent.trim());
                        }
                    });

                    const end_time_elements = document.querySelectorAll(".end-time");
                    end_time_elements.forEach(function (element) {
                        if (element.textContent.trim()) {
                            element.textContent = formatDateAsDDMMYY(element.textContent.trim());
                        }
                    });
                });
            </script>

            <div id="paymentModal" class="modal">

                <div class="modal-content">

                    <div class="button-container1">

                        <h2>Claim Details </h2>
                        <span class="close" onclick="closeModal()">&times;</span>

                    </div>

                    <div class="container" style="background-color: #f5f5f7;">

                        <div class="invoice-header">
                            <div class="invoice-row">
                                <p><strong>Claim ID</strong></p>
                                <span id="Claim_ID_to_view"></span>
                            </div>
                            <div class="invoice-row">
                                <p><strong>Claim By</strong></p>
                                <span id="Claim_By"></span>
                            </div>
                            <div class="invoice-row">
                                <p><strong>Claim Date</strong></p>
                                <span id="Claim_Date"></span>
                            </div>


                            <div class="invoice-row">
                                <p><strong>Claim Type</strong></p>
                                <span id="Claim_Type"></span>
                            </div>

                        </div>

                        <div class="invoice-header">


                            <div class="invoice-row">
                                <p><strong>Approved By</strong></p>
                                <span id="Approved_By"></span>
                            </div>

                            <div class="invoice-row">
                                <p><strong>Approved Date</strong></p>
                                <span id="Approved_Date"></span>
                            </div>


                            <div class="invoice-row">
                                <p><strong>Status</strong></p>
                                <span id="calim_Status"></span>
                            </div>

                        </div>

                        <div class="invoice-header">


                            <div class="invoice-row">
                                <p><strong>Amount</strong></p>
                                <span id="view_amount"></span>
                            </div>


                            <div class="invoice-row">
                                <p><strong>GST</strong></p>
                                <span id="view_gst"></span>
                            </div>



                            <div class="invoice-row">
                                <p><strong>Total</strong></p>
                                <span id="view_total"></span>
                            </div>

                        </div>

                        <div class="invoice-header">


                            <div class="invoice-row">
                                <p><strong>Comments</strong></p>
                                <span id="Comments"></span>
                            </div>
                        </div>

                    </div>

                    <div class="container">

                        <div class="table-responsive1">

                            <table class="table table-main" width="100%">

                                <thead>
                                    <tr>
                                        <th style="text-align: center; width: 2%;">S/N</th>
                                        <th style="text-align: center; width: 5%;">Proj ID</th>
                                        <th style="text-align: left; width: 10%;">Category</th>
                                        <th style="text-align: left; width: 50%;">Item</th>
                                        <th style="text-align: right; width: 7%;">Amount($)</th>
                                        <th style="text-align: right; width: 7%;">GST($)</th>
                                        <th style="text-align: right; width: 7%;">Total($)</th>
                                    </tr>
                                </thead>
                                <tbody id="modalItemsTable">
                                    <!-- Items will be inserted here -->
                                </tbody>

                            </table>

                        </div>

                    </div>

                </div>

            </div>

            <style>
                .table-responsive1 {
                    width: 100%;
                    overflow: auto;
                    max-height: 450px;
                    border-radius: 10px;
                    border: 1px solid #ddd;
                }


                .table-main {
                    width: 100%;
                    border-collapse: collapse;
                }

                .table-main thead {
                    position: sticky;
                    top: 0;
                    background: white;
                    z-index: 10;
                }

                .container {
                    background-color: white;
                    /* Light Gray - Similar to Apple's typical background */
                    padding: 10px;
                    border-radius: 10px;
                    display: flex;
                    flex: 1;
                    gap: 20px;
                    border: 2px solid #d3d3d3;
                    /* Slightly darker light gray for border */
                    margin-bottom: 15px;
                }

                .invoice-header {
                    flex: 1;
                    background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
                    padding: 20px;
                    border-radius: 12px;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    color: #004d40;
                    transition: transform 0.2s ease-in-out;
                }

                .invoice-header:hover {
                    transform: scale(1.02);
                }

                .invoice-row {
                    display: grid;
                    grid-template-columns: 140px auto;
                    /* First column for labels, second for values */
                    gap: 10px;
                    align-items: center;
                    padding: 5px 0;
                }

                .invoice-row p {
                    margin: 0;
                    font-weight: bold;
                    text-align: left;
                }

                .invoice-row span {
                    text-align: left;
                }


                .invice_header {
                    width: 100%;
                    padding: 10px;

                }

                .button-container1 {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 15px;
                }

                .button-container1 h2 {
                    margin: 0;
                    font-size: 1.5em;
                    color: #333;
                }



                .title-box {
                    display: flex;
                    padding: 5px;
                    background-color: white;
                    border-radius: 8px;
                    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                    margin-bottom: 10px;
                    justify-content: space-between;

                }

                .title-item {
                    display: flex;
                    align-items: center;

                    /* Align title and value on the same row */
                }

                .title-item span {
                    font-size: 18px;
                    font-weight: bold;
                    color: #004b5d;
                }


                @keyframes open {
                    from {
                        width: 20px;
                        /* Start with 0 width */
                    }

                    to {
                        width: 573px;
                        /* Animate to 473px width */
                    }
                }

                /* Responsive styling for smaller screens */
                @media (max-width: 768px) {
                    .title-box {
                        flex-direction: column;
                        /* Stack items vertically on smaller screens */
                        align-items: flex-start;
                    }

                    .title-item {
                        margin-bottom: 15px;
                        /* Space between stacked items */
                    }
                }
            </style>

            <style>
                .modal-content {
                    background-color: #fefefe;
                    margin: 15% auto;
                    /* 15% from the top and centered */
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                    /* Could be more or less, depending on screen size */
                    border-radius: 8px;
                    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                    position: relative;
                    animation: slideDown 0.5s ease-in-out forwards;
                }

                .form-label {
                    display: block;
                    margin-bottom: 5px;
                    margin-top: 5px;
                }

                .form-control {
                    width: 60%;
                    padding: 6px;
                    margin-bottom: 0px;
                    box-sizing: border-box;
                }

                .flex-item-full-width {
                    flex: 1;
                }

                .flex-row {
                    display: flex;
                    flex-direction: row;
                    gap: 15px;
                    /* Optional: add spacing between flex items within .flex-row */
                }

                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0, 0, 0, 0.5);
                }

                .modal-content {
                    background-color: white;
                    margin: 1% auto;
                    padding: 20px;
                    border-radius: 10px;
                    width: 80%;
                    border: 2px solid black;

                }

                .close {
                    color: #aaa;
                    font-size: 28px;
                    font-weight: bold;
                    cursor: pointer;
                }

                .close:hover,
                .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }

                .table-main th,
                .table-main td {
                    border: 0.5px solid #f3f1f1;
                    padding: 5px;
                    text-align: left;
                }

                .table-main thead th {
                    background-color: #f2f2f2;
                    font-weight: bold;
                }
            </style>

            <script>

                function formatNumber(number) {
                    return new Intl.NumberFormat('en-US', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    }).format(number);
                }

                function formatDate(dateString) {
                    const date = new Date(dateString);
                    const day = String(date.getDate()).padStart(2, '0');  // Pad with zero if single digit
                    const month = String(date.getMonth() + 1).padStart(2, '0');  // Months are 0-indexed, so add 1
                    const year = String(date.getFullYear()).slice(-2);  // Get last two digits of the year
                    return `${day}/${month}/${year}`;
                }

                function openPaymentDetails(PO_no) {
                    fetch(`/fetch_claim_details/${PO_no}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                console.log()

                                document.getElementById('Claim_ID_to_view').textContent = data.claim_details.claim_id;
                                document.getElementById('Claim_By').textContent = data.claim_details.claim_by;


                                if (data.claim_details.claim_date) {
                                    document.getElementById('Claim_Date').textContent = formatDate(data.claim_details.claim_date);
                                } else {
                                    document.getElementById('Claim_Date').textContent = '';
                                }

                                document.getElementById('Claim_Type').textContent = data.claim_details.claim_type;
                                document.getElementById('Approved_By').textContent = data.claim_details.approved_by;

                                if (data.claim_details.approved_date) {
                                    document.getElementById('Approved_Date').textContent = formatDate(data.claim_details.approved_date);
                                } else {
                                    document.getElementById('Approved_Date').textContent = '';
                                }

                                document.getElementById('calim_Status').textContent = data.claim_details.status;
                                document.getElementById('view_total').textContent = `$ ${formatNumber((data.claim_details.claim_Total ?? 0).toFixed(2))}`;
                                document.getElementById('view_amount').textContent = `$ ${formatNumber((data.claim_details.amount ?? 0).toFixed(2))}`;
                                document.getElementById('view_gst').textContent = `$ ${formatNumber((data.claim_details.gst_value ?? 0).toFixed(2))}`;
                                document.getElementById('Comments').textContent = data.claim_details.comments;
                                // Populate items list
                                let itemsTable = document.getElementById('modalItemsTable');
                                itemsTable.innerHTML = "";

                                data.items.forEach((item, index) => {
                                    let projectID = item.projectid || '';  // Project ID
                                    let category = item.Category || '';  // Category
                                    let subCategory = item.Sub_Category || '';  // Sub Category
                                    let itemName = item.itemname || '';  // Item name
                                    let amount = parseFloat(item.amount) || 0;  // Amount
                                    let gst = parseFloat(item.gst_value) || 0;  // GST
                                    let total = parseFloat(item.total) || 0;  // Total

                                    // Format total as currency if necessary
                                    let formattedAmount = formatNumber(amount.toFixed(2));
                                    let formattedGST = formatNumber(gst.toFixed(2));
                                    let formattedTotal = formatNumber(total.toFixed(2));

                                    let row = `<tr>
                                        <td style="width: 2%; text-align: center;">${index + 1}</td>
                                        <td style="width: 5%; text-align: center;">${projectID}</td>
                                        <td style="width: 10%; text-align: left; padding-left: 10px;">${category}</td>
                                        <td style="width: 50%; text-align: left; padding-left: 10px;">${itemName}</td>
                                        <td style="width: 7%; text-align: right; padding-right: 10px;"> ${formattedAmount}</td>
                                        <td style="width: 7%; text-align: right; padding-right: 10px;"> ${formattedGST}</td>
                                        <td style="width: 7%; text-align: right; padding-right: 10px;"> ${formattedTotal}</td>
                                    </tr>`;

                                    document.getElementById('modalItemsTable').innerHTML += row;
                                });

                                document.getElementById('paymentModal').style.display = 'block';
                            } else {
                                alert('Payment details not found!');
                            }
                        })
                        .catch(error => console.error('Error fetching payment details:', error));
                }

                function closeModal() {
                    document.getElementById('paymentModal').style.display = 'none';
                }

            </script>

        </div>

    </div>

    <style>
        input:focus,
        select:focus {
            outline: 2px solid #4CAF50;
            /* Customize this color */
        }


        /* Styling for the table */
        .table {
            width: 100%;
            border-collapse: collapse;
        }

        /* Fix the header */
        .table thead {
            position: sticky;
            top: 0;
            background-color: #f4f4f4;
            z-index: 1;
        }

        /* Basic styling for table headers and cells */
        .table th,
        .table td {
            padding: 5px;
            text-align: center;
        }

        /* Fix the footer */
        tfoot {
            position: sticky;
            bottom: 0;
            background-color: #f4f4f4;
            z-index: 1;
        }

        /* Style input fields */
        input {
            width: 100%;
            box-sizing: border-box;
            font-size: 14px;
            height: 30px;
        }

        /* Button styling */
        .add-row-btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }

        .add-row-btn:hover {
            background-color: #45a049;
        }

        /* Remove padding from table elements */
        .table td {
            margin: 0;
            padding: 0;
        }

        .button-container1 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-top: 10px;
            gap: 10px;
        }
    </style>

    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    <style>
        td input[type="checkbox"] {
            transform: scale(0.5);
            display: block;
        }

        /* Base Select Styling */
        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding: 6px 30px 6px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #fff;
            font-size: 14px;
            transition: all 0.3s ease;
            background-image: url("data:image/svg+xml;utf8,<svg fill='gray' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px 16px;
            cursor: pointer;
        }

        /* On Focus */
        select:focus {
            border-color: #005bbb;
            box-shadow: 0 0 6px rgba(0, 91, 187, 0.3);
            outline: none;
            transform: scale(1.02);
        }

        /* On Hover */
        select:hover {
            background-color: #f0f8ff;
        }

        /* Option Styling (Optional) */
        select option {
            padding: 10px;
            font-size: 14px;
            transition: background-color 0.2s ease;
        }

        /* Optional animation for dropdown opening (Webkit only) */
        select {
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
    </style>

    <style>
        #project_dynamicTable th,
        #project_dynamicTable td {
            text-align: center;
            border-bottom: 1px solid #ccc;
            vertical-align: middle;
        }

        #project_dynamicTable tbody tr:hover {
            background-color: #f1f8ff;
            transition: background-color 0.3s ease;
        }

        /* Input & Select Field Styling */
        #project_dynamicTable input[type="text"],
        #project_dynamicTable input[type="number"],
        #project_dynamicTable input[type="date"],
        #project_dynamicTable select {
            width: 100%;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 13px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        #project_dynamicTable input:focus,
        #project_dynamicTable select:focus {
            border-color: #005bbb;
            box-shadow: 0 0 5px rgba(0, 91, 187, 0.3);
            outline: none;
        }

        /* Delete Button Styling */
        .btn-delete {
            transition: transform 0.2s ease, color 0.2s ease;
        }

        .btn-delete:hover {
            color: darkred;
            transform: scale(1.2);
        }


        /* Optional: Zebra striping */
        #project_dynamicTable tbody tr:nth-child(even) {
            background-color: #f6f6f6;
        }

        /* Responsive select text */
        select.project_filed option {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>

</body>

</html>