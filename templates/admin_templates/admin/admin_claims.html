<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
   <title>Centroid Engineering Solutions</title>
   <link rel="icon" type="image/jpeg" href="static/ces_logo.png">
   <link rel="stylesheet" href="../static/res_style.css">
   <link rel="stylesheet"
      href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
   <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
   <!-- <script src="https://kit.fontawesome.com/f8e1a90484.js" crossorigin="anonymous"></script> -->
   <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
   <link href="https://cdn.jsdelivr.net/npm/font-awesome@6.5.0/css/all.min.css" rel="stylesheet">

   <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
   <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>

<body>

   <input type="checkbox" id="menu-toggle">

   <div class="sidebar">

      <div class="side-header">
         <h3>C<span>entroid</span></h3>
      </div>

      <div class="side-content">

         <div class="profile">
            <div class="profile-img bg-img" style="background-image: url(../static/1.png)"></div>
            <h4>{{user['name']}}</h4>
            <small>{{department_code}}</small>
         </div>

         <div class="side-menu">
            <ul>

               {% if department_code == 1000 %}
               <li>
                  <a href="/admin" class="active">
                     <span class="fa-solid fa-user-tie"></span>
                     <small>Admin</small>
                  </a>
               </li>
               {% endif %}

               {% if user_access['Accounts'] == 'On' %}
               <li>
                  <a href="/accounts">
                     <span class="fa-solid fa-file-invoice-dollar"></span>
                     <small>Accounts</small>
                  </a>
               </li>
               {% endif %}
               {% if user_access['toggleEnquiry'] == 'On' %}
               <li>
                  <a href="/admin_enquiry">
                     <span class="fa-solid fa-handshake"></span>
                     <small>Leads</small>
                  </a>
               </li>
               {% endif %}
               {% if user_access['toggleHR'] == 'On' %}
               <li>
                  <a href="/hr">
                     <span class="fa-solid fa-user-plus"></span>
                     <small>HR</small>
                  </a>
               </li>
               {% endif %}
               {% if user_access['togglePlanner'] == 'On' %}
               <li>
                  <a href="/planner">
                     <span class="fa-solid fa-calendar-check"></span>
                     <small>Planner</small>
                  </a>
               </li>
               {% endif %}
               {% if user_access['toggleProfile'] == 'On' %}
               <li>
                  <a href="/profile">
                     <span class="fa-solid fa-user"></span>
                     <small>Profile</small>
                  </a>
               </li>
               {% endif %}
               {% if user_access['toggleProjects'] == 'On' %}
               <li>
                  <a href="/projects">
                     <span class="fa-solid fa-chart-simple"></span>
                     <small>Project</small>
                  </a>
               </li>
               {% endif %}
               {% if user_access['togglePurchase'] == 'On' %}
               <li>
                  <a href="/purchase">
                     <span class="fa-solid fa-cart-shopping"></span>
                     <small>Purchase</small>
                  </a>
               </li>
               {% endif %}

               {% if user_access['toggleResources'] == 'On' %}
               <li>
                  <a href="/resources">
                     <span class="fa-solid fa-recycle"></span>
                     <small>Resources</small>
                  </a>
               </li>
               {% endif %}

               {% if department_code == 1000 %}
               <li>
                  <a href="/settings">
                     <span class="fa-solid fa-gears"></span>
                     <small>Settings</small>
                  </a>
               </li>
               {% endif %}

               <li>
                  <a href="{{ url_for('logout') }}">
                     <span class="fa-solid fa-right-from-bracket"></span>
                     <small>Log Out</small>
                  </a>
               </li>
            </ul>
         </div>

      </div>

   </div>

   <div class="main-content">

      <div class="page-content" style="background-color: white;">

         <div class="page-header" style="background-color: white;">

            <nav class="navbar1">

               <ul id="menuList1" class="navitems1">

                  <li class="dropdown">

                     <a href="#" class="dropbtn1 " onclick="toggleDropdown1(event)" class="link">
                        <i class="fas fa-eye" style="margin-right: 5px;"></i> Overview
                     </a>

                     <ul class="dropdown-content" id="dropdownMenu1" style="display: none;">
                        <li><a href="{{ url_for('ac_add') }}"><i class="fas fa-plus-circle"
                                 style="margin-right: 5px;"></i>
                              Add</a></li>
                        <li><a href="#"><i class="fas fa-coins" style="margin-right: 5px;"></i>
                              Cash FLow</a></li>

                        <li><a href="{{ url_for('proj_budget') }}"><i class="fas fa-file-invoice-dollar"
                                 style="margin-right: 5px;"></i>
                              Budget</a></li>
                        <li><a href="{{ url_for('proj_status') }}"><i class="fas fa-tasks"
                                 style="margin-right: 5px;"></i>
                              Hours</a></li>
                        <li><a href="{{ url_for('po_status') }}"><i class="fas fa-file-invoice"
                                 style="margin-right: 5px;"></i>
                              PO
                              Status</a></li>
                     </ul>

                  </li>

                  <li><a href="{{ url_for('admin_add_project') }}" class="link"><i class="fas fa-plus-circle"></i>
                        Add</a>
                  </li>
                  <li><a href="{{ url_for('employees_view') }}" class="link"><i class="fa-solid fa-users"></i>
                        Employees</a></li>

                  <li class="dropdown">
                     <a href="#" class="dropbtn" onclick="toggleDropdown(event)" class="link">
                        <i class="fa-solid fa-check-circle" style="margin-right: 5px;"></i> Approvals
                     </a>
                     <ul class="dropdown-content" id="dropdownMenu" style="display: none;">
                        <li><a href="{{ url_for('admin_claims') }}" class="active"><i class="fas fa-hand-holding-dollar"
                                 style="margin-right: 0px;"></i>
                              Claims</a></li>
                        <li><a href="{{ url_for('admin_expenses') }}"><i class="fas fa-receipt"
                                 style="margin-right: 5px;"></i>
                              Expenses</a></li>
                        <li><a href="{{ url_for('leave_approvals') }}"><i class="fas fa-calendar-check"
                                 style="margin-right: 5px;"></i> Leaves</a>
                        </li>
                        <li><a href="{{ url_for('pay_req') }}"><i class="fas fa-money-check-alt"
                                 style="margin-right: 1px;"></i>
                              Payment</a></li>
                        <li><a href="{{ url_for('create_prj') }}"><i class="fas fa-calendar-check"
                                 style="margin-right: 5px;"></i> Projects</a>
                        </li>
                        <li><a href="{{ url_for('pur_purchase') }}"><i class="fas fa-file-signature"
                                 style="margin-right: 0px;"></i> PR</a></li>
                        <li><a href="{{ url_for('pur_po') }}"><i class="fas fa-file-contract"
                                 style="margin-right: 5px;"></i>
                              PO</a></li>
                     </ul>

                  </li>

                  <li><a href="{{ url_for('client_details') }}" class="link"><i
                           class="fa-solid fa-handshake-simple"></i>
                        Clients</a></li>
                  <li><a href="{{ url_for('vendor') }}" class="link"><i class="fa-sharp fa-solid fa-store"
                           style="margin-right: 5px;"></i>Suppliers</a></li>

               </ul>

               <script>
                  document.addEventListener("DOMContentLoaded", function () {
                     let dropdown = document.getElementById("dropdownMenu1");
                     let dropdownTrigger = document.querySelector(".dropbtn1");

                     // Ensure dropdown is initially hidden
                     dropdown.style.display = "none";

                     function toggleDropdown(event) {
                        event.preventDefault();
                        event.stopPropagation(); // Prevent event bubbling
                        dropdown.style.display = (dropdown.style.display === "block") ? "none" : "block";
                     }

                     function closeDropdown(event) {
                        if (!dropdown.contains(event.target) && !dropdownTrigger.contains(event.target)) {
                           dropdown.style.display = "none";
                        }
                     }

                     // Toggle dropdown when clicking on "Approvals"
                     dropdownTrigger.addEventListener("click", toggleDropdown);

                     // Close dropdown when clicking outside
                     document.addEventListener("click", closeDropdown);

                     // Prevent closing when clicking inside the dropdown itself
                     dropdown.addEventListener("click", function (event) {
                        event.stopPropagation();
                     });
                  });
                  document.addEventListener("DOMContentLoaded", function () {
                     let dropdown = document.getElementById("dropdownMenu");
                     let dropdownTrigger = document.querySelector(".dropbtn");

                     // Ensure dropdown is initially hidden
                     dropdown.style.display = "none";

                     function toggleDropdown(event) {
                        event.preventDefault();
                        event.stopPropagation(); // Prevent event bubbling
                        dropdown.style.display = (dropdown.style.display === "block") ? "none" : "block";
                     }

                     function closeDropdown(event) {
                        if (!dropdown.contains(event.target) && !dropdownTrigger.contains(event.target)) {
                           dropdown.style.display = "none";
                        }
                     }

                     // Toggle dropdown when clicking on "Approvals"
                     dropdownTrigger.addEventListener("click", toggleDropdown);

                     // Close dropdown when clicking outside
                     document.addEventListener("click", closeDropdown);

                     // Prevent closing when clicking inside the dropdown itself
                     dropdown.addEventListener("click", function (event) {
                        event.stopPropagation();
                     });
                  });

               </script>

               <div class="menu-icon">
                  <i class="fa-solid fa-bars" onclick="toggleMenu()"></i>
               </div>

               <script>
                  let menuList1 = document.getElementById("menuList1");
                  menuList1.style.maxHeight = "0px";

                  function toggleMenu1() {
                     if (menuList1.style.maxHeight == "0px") {
                        menuList1.style.maxHeight = "300px";
                     } else {
                        menuList1.style.maxHeight = "0px";
                     }
                  }
               </script>

            </nav>

            <div class="line"></div>

         </div>

         <div class="search_container1">

            <h3 style="color: #004274;">Claim's (<span id="requestCount">0</span>) </h3>

            <span class="span_tag" style="margin-left: 10px;">Pending :
               <span id="Pendingpay" style="color: brown;">0</span>
            </span>

            <span class="span_tag">Partial :
               <span id="Partialpay" style="color: #007bff;">0</span>
            </span>

            <span class="span_tag">Approved :
               <span id="Paidpay" style="color: #007bff;">0</span>
            </span>

            <input type="text" id="searchInput" placeholder="Search......." onkeyup="filterTable()">
            <span class="span_tag">Amount : <span id="totalAmount">$ 0.00</span></span>
            <span class="span_tag">GST : <span id="totalGST">$ 0.00</span></span>
            <span class="span_tag">Total : <span id="overallTotal">$ 0.00</span></span>
            <span class="span_tag">Balance : <span id="balanceTotal" style="color: orangered;">$
                  0.00</span></span>

         </div>

         <script>
            function filterTable() {
               let input = document.getElementById("searchInput").value.toLowerCase().trim();
               let keywords = input.split(",").map(k => k.trim()).filter(k => k !== "");

               let rows = document.querySelectorAll(".mainRow");

               rows.forEach(row => {
                  let approved_date = row.querySelector(".approved_date") ? row.querySelector(".approved_date").textContent.trim().toLowerCase() : '';
                  let claim_id = row.querySelector(".claim_id") ? row.querySelector(".claim_id").textContent.trim().toLowerCase() : '';
                  let claim_type = row.querySelector(".claim_type") ? row.querySelector(".claim_type").textContent.trim().toLowerCase() : '';
                  let claim_by = row.querySelector(".claim_by") ? row.querySelector(".claim_by").textContent.trim().toLowerCase() : '';
                  let claim_date = row.querySelector(".claim_date") ? row.querySelector(".claim_date").textContent.trim().toLowerCase() : '';
                  let approved_by = row.querySelector(".approved_by") ? row.querySelector(".approved_by").textContent.trim().toLowerCase() : '';
                  let status = row.querySelector(".status") ? row.querySelector(".status").textContent.trim().toLowerCase() : '';

                  // Combine all searchable fields into one string
                  let combinedText = [approved_date, claim_id, claim_type, claim_by, claim_date, approved_by, status].join(" ");

                  // Show row only if ALL keywords are found
                  let isMatch = keywords.every(keyword => combinedText.includes(keyword));
                  row.style.display = isMatch ? "" : "none";
               });

               updateTotals();         // Update totals after filtering
               updateStatusCounts();   // Update status counts
            }


            function updateTotals() {
               let requestCount = 0;
               let totalAmount = 0;
               let totalGST = 0;
               let totalSum = 0;
               let balamceSum = 0;
               const rows = document.querySelectorAll("#projectTable tbody tr.mainRow");
               rows.forEach(row => {
                  if (row.style.display !== "none") {
                     requestCount++;
                     let amount = parseFloat(row.querySelector(".amount-col")?.textContent.replace(/[^0-9.-]+/g, '') || 0);
                     let gstValue = parseFloat(row.querySelector(".gst-col")?.textContent.replace(/[^0-9.-]+/g, '') || 0);
                     let total = parseFloat(row.querySelector(".total-col")?.textContent.replace(/[^0-9.-]+/g, '') || 0);
                     let balamce = parseFloat(row.querySelector(".balamceSum")?.textContent.replace(/[^0-9.-]+/g, '') || 0);
                     totalAmount += amount;
                     totalGST += gstValue;
                     totalSum += total;
                     balamceSum += balamce;
                  }
               });

               let formattedAmount = totalAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
               let formattedGST = totalGST.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
               let formattedTotal = totalSum.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
               let formattedbalance = balamceSum.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

               document.getElementById("requestCount").textContent = requestCount;
               document.getElementById("totalAmount").textContent = "$ " + formattedAmount;
               document.getElementById("totalGST").textContent = "$ " + formattedGST;
               document.getElementById("overallTotal").textContent = "$ " + formattedTotal;
               document.getElementById("balanceTotal").textContent = "$ " + formattedbalance;
            }

            function updateStatusCounts() {
               let pendingCount = 0;
               let partialCount = 0;
               let paidCount = 0;

               const rows = document.querySelectorAll("#projectTable tbody tr.mainRow");

               rows.forEach(row => {
                  if (row.style.display !== "none") {
                     let status = row.querySelector(".status")?.textContent.trim().toLowerCase();

                     if (status === "pending") {
                        pendingCount++;
                     } else if (status === "partial") {
                        partialCount++;
                     } else if (status === "paid") {
                        paidCount++;
                     }
                  }
               });

               // Format the totals without decimals
               let formattedPending = pendingCount.toLocaleString('en-US', { maximumFractionDigits: 0 });
               let formattedPartial = partialCount.toLocaleString('en-US', { maximumFractionDigits: 0 });

               let formattedPaid = paidCount.toLocaleString('en-US', { maximumFractionDigits: 0 });

               // Update the correct spans
               document.getElementById("Pendingpay").textContent = formattedPending;
               document.getElementById("Partialpay").textContent = formattedPartial;
               document.getElementById("Paidpay").textContent = formattedPaid;
            }

            // Call the function when the page loads
            document.addEventListener("DOMContentLoaded", () => {
               updateTotals();
               updateStatusCounts();
            });

         </script>

         <style>
            .span_tag {
               font-size: 14px;
               font-weight: bold;
               color: #004b5d;
               padding: 5px 8px;
               border: 1px solid #004b5d;
               border-radius: 5px;
               background-color: #f1f8ff;
               color: #004b5d;
               text-align: center;
               margin-right: 10px;
            }

            #totalAmount {
               color: #28a745;
               /* Green for amount */
            }

            #totalGST {
               color: #0c8de2;
               /* Yellow for GST */
            }

            #overallTotal {
               color: #dc3545;
               /* Red for overall total */
            }

            .search_container1 {
               display: flex;
               justify-content: space-between;
               align-items: center;
               width: 100%;
               padding: 10px;
            }


            #projectTable {
               width: 100%;
               border-collapse: separate;
               border-spacing: 0;
               border-radius: 10px;
            }


            #searchInput {
               width: 20%;
               padding: 2px;
               margin: auto;
               display: block;
               border: 2px solid #ccc;
               border-radius: 5px;
               /* Rounded corners */
               outline: none;
               transition: all 0.3s ease-in-out;
               text-align: center;
               font-size: 16px;
            }

            #searchInput:hover {
               background-color: #f0f0f0;
            }

            #searchInput:focus {
               border-color: #004b5d;
               box-shadow: 0 0 8px rgba(0, 123, 255, 0.5);
            }
         </style>

         <div>

            <div class="table-responsive">

               <table class="table table-main" width="100%" id="projectTable">

                  <thead>
                     <tr>
                        <th style="text-align: center;">View</th>
                        <th style="text-align: left;">Claim ID</th>
                        <th style="text-align: left;">Type</th>
                        <th style="text-align: left;">Claim By</th>
                        <th style="text-align: center;">Claim Date</th>
                        <th style="text-align: center;">Approved By</th>
                        <th style="text-align: center;">Paid On</th>
                        <th style="text-align: right;">Amount ($)</th>
                        <th style="text-align: right;">GST ($)</th>
                        <th style="text-align: right;">Total ($)</th>
                        <th style="text-align: right;">Balance ($)</th>
                        <th style="text-align: center;">Status</th>
                        <th style="text-align: center;">Del</th>

                     </tr>
                  </thead>

                  <tbody>
                     {% for claim in all_claims %}
                     <tr class="mainRow">

                        <td style="text-align: center;" class=" view-col">
                           <span class="icon" onclick="openPaymentDetails('{{ claim.claim_id }}')"
                              style="cursor: pointer;">
                              <span class="fa-solid fa-eye" style="font-size: 1.25em; color: orangered;"></span>
                           </span>
                        </td>

                        <td style="text-align: left; padding-right: 10px;" class="claim_id">
                           {% if claim.claim_id.startswith('P') %}
                           <span style="color: blueviolet; font-weight: bold;">{{ claim.claim_id }}</span>
                           {% elif claim.claim_id.startswith('O') %}
                           <span style="color: green; font-weight: bold;">{{ claim.claim_id }}</span>
                           {% elif claim.claim_id.startswith('V') %}
                           <span style="color: brown; font-weight: bold;">{{ claim.claim_id }}</span>
                           {% elif claim.claim_id.startswith('E') %}
                           <span style="color: rgb(28, 125, 236); font-weight: bold;">{{ claim.claim_id }}</span>
                           {% else %}
                           <span>{{ claim.claim_id }}</span> <!-- Default color for other claim IDs -->
                           {% endif %}
                        </td>


                        <td style="text-align: left; padding-right: 10px;" class="claim_type">{{ claim.claim_type }}
                        </td>
                        <td style="text-align: left; padding-right: 10px;" class="claim_by">{{ claim.claim_by }}</td>
                        <td style="text-align: center;" class="start-time claim_date">{{ claim.claim_date }}</td>
                        <td style="text-align: center;" class="approved_by">{{ claim.approved_by if claim.approved_by is
                           not none else '' }}
                        </td>
                        <td style="text-align: center;" class="start-time approved_date"> {{ claim.approved_date if
                           claim.approved_date is not none else '' }} </td>



                        <td class="amount-col" style="text-align: right; padding-right: 10px;">
                           {{ "{:,.2f}".format(claim.amount|replace(',', '')|float) if claim.amount else "0.00"
                           }}
                        </td>

                        <td class="gst-col" style="text-align: right; padding-right: 10px;">
                           {{ "{:,.2f}".format(claim.gst_value|replace(',', '')|float) if claim.gst_value else
                           "0.00" }}
                        </td>

                        <td class="total-col" style="text-align: right; padding-right: 10px;">
                           {{ "{:,.2f}".format(claim.claim_Total|replace(',', '')|float) if claim.claim_Total
                           else "0.00" }}
                        </td>

                        <td class="balamceSum" style="text-align: right; padding-right: 10px;">
                           {{ "{:,.2f}".format(claim.balance|replace(',', '')|float) if claim.balance else
                           "0.00" }}
                        </td>

                        <td class="status" style="font-weight: bold; text-align: center;">
                           <span style="color: 
                               {% if claim.status == 'Pending' %}
                                   brown;
                               {% elif claim.status == 'Partial' %}
                                   blue;
                               {% elif claim.status == 'Paid' %}
                                   green;
                               {% elif claim.status == 'Canceled' %}
                                   red;
                               {% endif %};
                               background-color: 
                               {% if claim.status == 'Pending' %}
                                   #f2e1d7; /* Light brown background */
                               {% elif claim.status == 'Partial' %}
                                   #a4acee; /* Light orange background */
                               {% elif claim.status == 'Paid' %}
                                   #d0f8e3; /* Light green background */
                               {% elif claim.status == 'Canceled' %}
                                   #f8d7da; /* Light red background */
                               {% endif %};
                               padding: 2px 8px; 
                               border-radius: 8px; 
                               display: inline-block; /* Ensures the span takes up only as much space as needed */
                           ">
                              {{ claim.status }}
                           </span>
                        </td>


                        <form method="POST" action="/delete_claim" onsubmit="return confirmAndDisable(this);">
                           <td style="text-align: center;">
                              <input type="hidden" name="claim_id" value="{{ claim.claim_id }}">
                              <input type="hidden" name="from_where" value="admin">
                              <button type="submit" style="background: none; border: none;" class="delete-btn">
                                 <span class="icon">
                                    <span class="fa-solid fa-trash"
                                       style="color: red; font-size: 1.2em; cursor: pointer;"></span>
                                 </span>
                              </button>
                           </td>
                        </form>



                     </tr>
                     {% endfor %}
                  </tbody>

               </table>

            </div>

            <script>
               let isDeleting = false;

               function confirmAndDisable(form) {
                  if (isDeleting) return false;           // guard against double submit
                  if (!confirm("Are you sure you want to delete this claim?")) {
                     return false;                         // user cancelled
                  }
                  isDeleting = true;                      // prevent any further submits
                  // disable all submit buttons in this form
                  form.querySelectorAll('button[type="submit"]').forEach(btn => btn.disabled = true);
                  return true;                            // allow form submission
               }
            </script>

            <div id="paymentModal" class="modal">

               <div class="modal-content">

                  <div class="button-container1">

                     <h2>Claim Details </h2>
                     <span class="close" onclick="closeModal()">&times;</span>

                  </div>

                  <div class="container" style="background-color: #f5f5f7;">

                     <div class="invoice-header">

                        <div class="invoice-row">
                           <p><strong>Claim ID</strong></p>
                           <span id="Claim_ID_to_view"></span>
                        </div>

                        <div class="invoice-row">
                           <p><strong>Claim By</strong></p>
                           <span id="Claim_By"></span>
                        </div>

                        <div class="invoice-row">
                           <p><strong>Claim Date</strong></p>
                           <span id="Claim_Date"></span>
                        </div>

                        <div class="invoice-row">
                           <p><strong>Claim Type</strong></p>
                           <span id="Claim_Type"></span>
                        </div>

                     </div>

                     <div class="invoice-header">

                        <div class="invoice-row">
                           <p><strong>Approved By</strong></p>
                           <span id="Approved_By"></span>
                        </div>

                        <div class="invoice-row">
                           <p><strong>Approved Date</strong></p>
                           <span id="Approved_Date"></span>
                        </div>


                        <div class="invoice-row">
                           <p><strong>Status</strong></p>
                           <span id="calim_Status"></span>
                        </div>

                     </div>

                     <div class="invoice-header">

                        <div class="invoice-row">
                           <p><strong>Amount</strong></p>
                           <span id="view_amount"></span>
                        </div>


                        <div class="invoice-row">
                           <p><strong>GST</strong></p>
                           <span id="view_gst"></span>
                        </div>



                        <div class="invoice-row">
                           <p><strong>Total</strong></p>
                           <span id="view_total"></span>
                        </div>

                     </div>

                     <div class="invoice-header">

                        <input type="text" style="display: none;" class="form-control" id="claim_id_to_update"
                           name="claim_id_to_update" required>

                        <input style="display: none;" type="number" class="form-control" id="actual_req_amt"
                           name="actual_req_amt" required step="0.01">

                        <div class="flex-row">
                           <label for="paid_amount" class="form-label"> <strong>Payable
                              </strong>
                           </label>
                           <input type="number" class="form-control" id="paid_amount" name="paid_amount" required
                              step="0.01" onchange="validateAmountPaid()">
                           <button type="submit" class="new-enquiry-btn" id="update_button">
                              Update
                           </button>
                        </div>

                        <script>
                           function validateAmountPaid() {
                              const actualReqAmt = parseFloat(document.getElementById('actual_req_amt').value);
                              const paidAmtInput = document.getElementById('paid_amount');
                              const paidAmt = parseFloat(paidAmtInput.value);

                              if (isNaN(actualReqAmt) || isNaN(paidAmt)) return;

                              if (paidAmt <= 0 || paidAmt > actualReqAmt) {
                                 alert("Payable amount must be greater than 0 and less than or equal to the Actual Requested Amount.");
                                 paidAmtInput.value = ""; // Clear invalid input
                                 paidAmtInput.focus();
                              }
                           }
                        </script>


                        <div class="flex-item">
                           <label for="comments" class="form-label">Comments</label>
                           <textarea class="form-control" id="comments" name="comments" rows="4"
                              style="width: 100%;"></textarea>
                        </div>

                     </div>

                     <script>
                        document.getElementById('update_button').addEventListener('click', function (event) {
                           event.preventDefault(); // Prevent default form submission

                           // Disable the button to prevent multiple clicks
                           const updateButton = document.getElementById('update_button');
                           updateButton.disabled = true;
                           updateButton.innerHTML = "Processing...";  // Optional: Change button text to indicate action

                           const claimId = document.getElementById('claim_id_to_update').value;
                           const actualReqAmt = parseFloat(document.getElementById('actual_req_amt').value);
                           const paidAmt = parseFloat(document.getElementById('paid_amount').value);
                           const comments = document.getElementById('comments').value;

                           if (!claimId || isNaN(actualReqAmt) || isNaN(paidAmt)) {
                              alert("Please fill all required fields correctly.");
                              updateButton.disabled = false;  // Re-enable the button if there's an error
                              updateButton.innerHTML = "Update";  // Reset button text
                              return;
                           }



                           fetch('/admin_update_claim', {
                              method: 'POST',
                              headers: {
                                 'Content-Type': 'application/json'
                              },
                              body: JSON.stringify({
                                 claim_id: claimId,
                                 actual_req_amt: actualReqAmt,
                                 paid_amt: paidAmt,
                                 comments: comments,

                              })
                           })
                              .then(res => res.json())
                              .then(response => {
                                 if (response.success) {
                                    alert("Manual entries inserted and claims updated successfully.");
                                    location.reload(); // Optional: refresh page
                                 } else {
                                    alert("Failed to insert manual entries: " + response.error);
                                 }
                                 // Re-enable the button after the operation is complete
                                 updateButton.disabled = false;
                                 updateButton.innerHTML = "Update";  // Reset button text
                              })
                              .catch(error => {
                                 console.error('Insert error:', error);
                                 alert("Error occurred while inserting manual entries.");
                                 // Re-enable the button after the operation is complete
                                 updateButton.disabled = false;
                                 updateButton.innerHTML = "Update";  // Reset button text
                              });
                        });
                     </script>

                  </div>

                  <div class="container">

                     <div class="table-responsive1">

                        <table class="table table-main" width="100%">

                           <thead>
                              <tr>
                                 <th style="text-align: center; width: 2%;">S/N</th>
                                 <th style="text-align: center; width: 5%;">Proj ID</th>
                                 <th style="text-align: left; width: 10%;">Category</th>
                                 <th style="text-align: left; width: 50%;">Item</th>
                                 <th style="text-align: right; width: 7%;">Amount($)</th>
                                 <th style="text-align: right; width: 7%;">GST($)</th>
                                 <th style="text-align: right; width: 7%;">Total($)</th>
                              </tr>
                           </thead>
                           <tbody id="modalItemsTable">
                              <!-- Items will be inserted here -->
                           </tbody>

                        </table>

                     </div>

                  </div>

               </div>

            </div>

         </div>


      </div>

   </div>

   <script>

      function formatNumber(number) {
         return new Intl.NumberFormat('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
         }).format(number);
      }

      function formatDate(dateString) {
         const date = new Date(dateString);
         const day = String(date.getDate()).padStart(2, '0');  // Pad with zero if single digit
         const month = String(date.getMonth() + 1).padStart(2, '0');  // Months are 0-indexed, so add 1
         const year = String(date.getFullYear()).slice(-2);  // Get last two digits of the year
         return `${day}/${month}/${year}`;
      }

      function openPaymentDetails(PO_no) {
         fetch(`/fetch_claim_details/${PO_no}`)
            .then(response => response.json())
            .then(data => {
               if (data.success) {
                  console.log("..........data...........", data);

                  document.getElementById('Claim_ID_to_view').textContent = data.claim_details.claim_id;
                  document.getElementById('Claim_By').textContent = data.claim_details.claim_by;


                  if (data.claim_details.claim_date) {
                     document.getElementById('Claim_Date').textContent = formatDate(data.claim_details.claim_date);
                  } else {
                     document.getElementById('Claim_Date').textContent = '';
                  }

                  document.getElementById('Claim_Type').textContent = data.claim_details.claim_type;
                  document.getElementById('Approved_By').textContent = data.claim_details.approved_by;

                  if (data.claim_details.approved_date) {
                     document.getElementById('Approved_Date').textContent = formatDate(data.claim_details.approved_date);
                  } else {
                     document.getElementById('Approved_Date').textContent = '';
                  }



                  document.getElementById('calim_Status').textContent = data.claim_details.status;

                  if (data.claim_details.status === "Paid") {
                     // Disable and hide claim ID
                     const claimIdInput = document.getElementById('claim_id_to_update');
                     claimIdInput.disabled = true;
                     claimIdInput.style.display = "none";

                     // Disable and hide actual requested amount
                     const actualAmtInput = document.getElementById('actual_req_amt');
                     actualAmtInput.disabled = true;
                     actualAmtInput.style.display = "none";

                     // Disable and hide paid amount
                     const paidAmtInput = document.getElementById('paid_amount');
                     paidAmtInput.disabled = true;

                     // Disable and hide the update button
                     const updateBtn = document.querySelector('.new-enquiry-btn');
                     updateBtn.disabled = true;
                     updateBtn.style.display = "none";
                  }


                  document.getElementById('view_total').textContent = `$ ${formatNumber((data.claim_details.claim_Total ?? 0).toFixed(2))}`;
                  document.getElementById('view_amount').textContent = `$ ${formatNumber((data.claim_details.amount ?? 0).toFixed(2))}`;
                  document.getElementById('view_gst').textContent = `$ ${formatNumber((data.claim_details.gst_value ?? 0).toFixed(2))}`;
                  // document.getElementById('Comments').textContent = data.claim_details.comments;
                  document.getElementById('comments').value = data.claim_details.comments;
                  document.getElementById('paid_amount').value = data.claim_details.balance;
                  document.getElementById('actual_req_amt').value = data.claim_details.balance;
                  document.getElementById('claim_id_to_update').value = data.claim_details.claim_id;

                  // Populate items list
                  let itemsTable = document.getElementById('modalItemsTable');
                  itemsTable.innerHTML = "";

                  data.items.forEach((item, index) => {
                     let projectID = item.projectid || '';  // Project ID
                     let category = item.Category || '';  // Category
                     let subCategory = item.Sub_Category || '';  // Sub Category
                     let itemName = item.itemname || '';  // Item name
                     let amount = parseFloat(item.amount) || 0;  // Amount
                     let gst = parseFloat(item.gst_value) || 0;  // GST
                     let total = parseFloat(item.total) || 0;  // Total

                     // Format total as currency if necessary
                     let formattedAmount = formatNumber(amount.toFixed(2));
                     let formattedGST = formatNumber(gst.toFixed(2));
                     let formattedTotal = formatNumber(total.toFixed(2));

                     let row = `<tr>
                              <td style="width: 2%; text-align: center;">${index + 1}</td>
                              <td style="width: 5%; text-align: center;">${projectID}</td>
                              <td style="width: 10%; text-align: left; padding-left: 10px;">${category}</td>
                              <td style="width: 50%; text-align: left; padding-left: 10px;">${itemName}</td>
                              <td style="width: 7%; text-align: right; padding-right: 10px;"> ${formattedAmount}</td>
                              <td style="width: 7%; text-align: right; padding-right: 10px;"> ${formattedGST}</td>
                              <td style="width: 7%; text-align: right; padding-right: 10px;"> ${formattedTotal}</td>
                          </tr>`;

                     document.getElementById('modalItemsTable').innerHTML += row;
                  });

                  document.getElementById('paymentModal').style.display = 'block';
               } else {
                  alert('Payment details not found!');
               }
            })
            .catch(error => console.error('Error fetching payment details:', error));
      }

      function closeModal() {
         document.getElementById('paymentModal').style.display = 'none';
         location.reload(); // Reloads the current page

      }

   </script>

   <style>
      .hide-if-old {
         display: none;
      }
   </style>

   <style>
      .form-label {
         display: block;
         margin-bottom: 5px;
         margin-top: 5px;
      }

      .form-control {
         width: 60%;
         padding: 6px;
         margin-bottom: 0px;
         box-sizing: border-box;
      }

      .flex-item-full-width {
         flex: 1;
      }

      .flex-row {
         display: flex;
         flex-direction: row;
         gap: 15px;
         /* Optional: add spacing between flex items within .flex-row */
      }

      .flex-item {
         flex: 1;
         /* Ensure flex items grow equally */
      }

      .modal {
         display: none;
         position: fixed;
         z-index: 1000;
         left: 0;
         top: 0;
         width: 100%;
         height: 100%;
         background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6));
         backdrop-filter: blur(4px);
         animation: fadeIn 0.3s ease-in-out;
      }

      /* Optional animation for smoother appearance */
      @keyframes fadeIn {
         from {
            opacity: 0;
         }

         to {
            opacity: 1;
         }
      }


      .modal-content {
         background-color: white;
         margin: 1% auto;
         padding: 20px;
         border-radius: 10px;
         width: 80%;
         border: 2px solid #ccc;
         /* Adding border with 2px width and light gray color */

      }

      .close {
         float: right;
         font-size: 24px;
         cursor: pointer;
      }
   </style>

   <style>
      .table-responsive1 {
         width: 100%;
         overflow: auto;
         max-height: 450px;
         border-radius: 10px;
         border: 1px solid #ddd;
      }

      .table-responsive2 {
         width: 100%;
         overflow: auto;
         max-height: 120px;
         border-radius: 10px;
         border: 1px solid #ddd;
      }

      .table-main {
         width: 100%;
         border-collapse: collapse;
      }

      .table-main thead {
         position: sticky;
         top: 0;
         background: white;
         z-index: 10;
      }

      .container {
         background-color: white;
         padding: 10px;
         border-radius: 10px;
         display: flex;
         flex: 1;
         gap: 20px;
         border: 2px solid #ccc;
         /* Adding border with 2px width and light gray color */

      }

      .invoice-header {
         flex: 1;
         background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
         padding: 20px;
         border-radius: 12px;
         box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
         font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
         color: #004d40;
         transition: transform 0.2s ease-in-out;
      }

      .invoice-header:hover {
         transform: scale(1.02);
      }


      .invoice-row {
         display: grid;
         grid-template-columns: 140px auto;
         /* First column for labels, second for values */
         gap: 10px;
         align-items: center;
         padding: 5px 0;
      }

      .invoice-row p {
         margin: 0;
         font-weight: bold;
         text-align: left;
      }

      .invoice-row span {
         text-align: left;
      }


      .invice_header {
         width: 100%;
         padding: 10px;

      }

      .button-container1 {
         display: flex;
         flex: 1;
         justify-content: space-between;
         align-items: center;
         width: 100%;
         margin-top: 10px;
         gap: 10px;
      }

      .button-container2 {
         display: flex;
         flex: 1;
         justify-content: center;
         align-items: center;
         width: 100%;
         margin-top: 10px;
         gap: 10px;
      }


      .title-box {
         display: flex;
         padding: 5px;
         background-color: white;
         border-radius: 8px;
         box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
         margin-bottom: 10px;
         justify-content: space-between;

      }

      .title-item {
         display: flex;
         align-items: center;

         /* Align title and value on the same row */
      }

      .title-item span {
         font-size: 18px;
         font-weight: bold;
         color: #004b5d;
      }


      @keyframes open {
         from {
            width: 20px;
            /* Start with 0 width */
         }

         to {
            width: 573px;
            /* Animate to 473px width */
         }
      }

      /* Responsive styling for smaller screens */
      @media (max-width: 768px) {
         .title-box {
            flex-direction: column;
            /* Stack items vertically on smaller screens */
            align-items: flex-start;
         }

         .title-item {
            margin-bottom: 15px;
            /* Space between stacked items */
         }
      }
   </style>

   <script>
      document.addEventListener("DOMContentLoaded", function () {
         // Function to format a date as DD/MM/YY
         function formatDateAsDDMMYY(dateString) {
            const options = { day: '2-digit', month: '2-digit', year: '2-digit' };
            const date = new Date(dateString);
            if (isNaN(date.getTime())) {
               console.error('Invalid date string:', dateString);
               return dateString; // Return original if date is invalid
            }
            return date.toLocaleDateString('en-GB', options);
         }

         // Format date elements
         const start_time_elements = document.querySelectorAll(".start-time");
         start_time_elements.forEach(function (element) {
            if (element.textContent.trim()) {
               element.textContent = formatDateAsDDMMYY(element.textContent.trim());
            }
         });

         const end_time_elements = document.querySelectorAll(".end-time");
         end_time_elements.forEach(function (element) {
            if (element.textContent.trim()) {
               element.textContent = formatDateAsDDMMYY(element.textContent.trim());
            }
         });
      });
   </script>

   <style>
      .new-enquiry-btn {
         background: linear-gradient(45deg, #007AFF, #34AADC, #5856D6, #FF2D55);
         background-size: 200% 200%;
         color: white;
         font-weight: bold;
         border: none;
         padding: 8px 12px;
         border-radius: 5px;
         cursor: pointer;
         font-size: 14px;
         display: flex;
         align-items: center;
         transition: all 0.4s ease-in-out;
         box-shadow: 10px 10px 10px rgba(0, 122, 255, 0.3);
         /* Soft shadow */
      }

      /* Hover effect: Darker Gradient + Glow */
      .new-enquiry-btn:hover {
         background: linear-gradient(45deg, #0056A3, #2598C1, #4741C1, #D91D48);
         background-size: 200% 200%;
         box-shadow: 0px 6px 12px rgba(0, 86, 179, 0.5);
         /* Stronger shadow on hover */
         transform: scale(1.05);
      }
   </style>

   <style>
      input:focus,
      select:focus {
         outline: 2px solid #4CAF50;
         /* Customize this color */
      }


      /* Styling for the table */
      .table {
         width: 100%;
         border-collapse: collapse;
      }

      /* Fix the header */
      .table thead {
         position: sticky;
         top: 0;
         background-color: #f4f4f4;
         z-index: 1;
      }

      /* Basic styling for table headers and cells */
      .table th,
      .table td {
         padding: 5px;
         text-align: center;
      }

      /* Fix the footer */
      tfoot {
         position: sticky;
         bottom: 0;
         background-color: #f4f4f4;
         z-index: 1;
      }

      /* Style input fields */
      input {
         width: 100%;
         box-sizing: border-box;
         font-size: 14px;
         height: 30px;
      }

      /* Button styling */
      .add-row-btn {
         display: inline-block;
         padding: 10px 20px;
         background-color: #4CAF50;
         color: white;
         border: none;
         cursor: pointer;
         margin-top: 10px;
      }

      .add-row-btn:hover {
         background-color: #45a049;
      }

      /* Remove padding from table elements */
      .table td {
         margin: 0;
         padding: 10;
      }

      .button-container1 {
         display: flex;
         justify-content: space-between;
         align-items: center;
         width: 100%;
         margin-top: 10px;
         gap: 10px;
      }
   </style>


</body>

</html>